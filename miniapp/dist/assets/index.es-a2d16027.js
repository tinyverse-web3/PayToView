import{am as Eo,an as ne,ao as P0,ap as Zl,aq as ef,ar as jc,as as Io,at as O0,au as Lr,a5 as tf,av as Ii,aw as A0,ax as R0,ay as Z,az as C0,aA as yc,aB as T0,aC as N0,aD as D0,aE as Kh,aF as j0,aG as $0,aH as F0,aI as Vh,aJ as L0,aK as M0,aL as Qn,aM as Gh,aN as q0,aO as U0,aP as rf,aQ as $r,aR as z0,aS as k0,aT as dn,aU as Dt,aV as tr,aW as Ei,aX as hr,aY as H0,aZ as gn,a_ as nf,a$ as B0,b0 as K0,b1 as V0,b2 as sf,b3 as G0,b4 as of,b5 as af,b6 as yn,b7 as vc,b8 as po,b9 as mn,ba as W0,bb as go,bc as J0,bd as Q0,be as Y0,bf as ao,bg as X0,bh as Z0,bi as Za,bj as Wh,bk as e_,bl as t_,bm as r_,bn as Jh,bo as i_,bp as n_,bq as s_,br as o_,bs as a_,bt as c_,bu as u_,bv as Vn,bw as cf,bx as ec,by as h_,bz as l_,a9 as f_}from"./index-e040e5d6.js";import{e as Or,$ as $c}from"./events-a33f4ee5.js";const p_=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,d_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,g_=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function y_(a,t){if(a==="__proto__"||a==="constructor"&&t&&typeof t=="object"&&"prototype"in t){v_(a);return}return t}function v_(a){console.warn(`[destr] Dropping "${a}" key to prevent prototype pollution.`)}function co(a,t={}){if(typeof a!="string")return a;const r=a.trim();if(a[0]==='"'&&a.at(-1)==='"'&&!a.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!g_.test(a)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return a}try{if(p_.test(a)||d_.test(a)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(a,y_)}return JSON.parse(a)}catch(n){if(t.strict)throw n;return a}}function m_(a){return!a||typeof a.then!="function"?Promise.resolve(a):a}function Ut(a,...t){try{return m_(a(...t))}catch(r){return Promise.reject(r)}}function __(a){const t=typeof a;return a===null||t!=="object"&&t!=="function"}function w_(a){const t=Object.getPrototypeOf(a);return!t||t.isPrototypeOf(Object)}function yo(a){if(__(a))return String(a);if(w_(a)||Array.isArray(a))return JSON.stringify(a);if(typeof a.toJSON=="function")return yo(a.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function uf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const mc="base64:";function b_(a){if(typeof a=="string")return a;uf();const t=Buffer.from(a).toString("base64");return mc+t}function E_(a){return typeof a!="string"||!a.startsWith(mc)?a:(uf(),Buffer.from(a.slice(mc.length),"base64"))}function ur(a){return a?a.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function I_(...a){return ur(a.join(":"))}function uo(a){return a=ur(a),a?a+":":""}const x_="memory",S_=()=>{const a=new Map;return{name:x_,options:{},hasItem(t){return a.has(t)},getItem(t){return a.get(t)??null},getItemRaw(t){return a.get(t)??null},setItem(t,r){a.set(t,r)},setItemRaw(t,r){a.set(t,r)},removeItem(t){a.delete(t)},getKeys(){return Array.from(a.keys())},clear(){a.clear()},dispose(){a.clear()}}};function P_(a={}){const t={mounts:{"":a.driver||S_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=p=>{for(const b of t.mountpoints)if(p.startsWith(b))return{base:b,relativeKey:p.slice(b.length),driver:t.mounts[b]};return{base:"",relativeKey:p,driver:t.mounts[""]}},n=(p,b)=>t.mountpoints.filter(R=>R.startsWith(p)||b&&p.startsWith(R)).map(R=>({relativeBase:p.length>R.length?p.slice(R.length):void 0,mountpoint:R,driver:t.mounts[R]})),s=(p,b)=>{if(t.watching){b=ur(b);for(const R of t.watchListeners)R(p,b)}},c=async()=>{if(!t.watching){t.watching=!0;for(const p in t.mounts)t.unwatch[p]=await Qh(t.mounts[p],s,p)}},f=async()=>{if(t.watching){for(const p in t.unwatch)await t.unwatch[p]();t.unwatch={},t.watching=!1}},g=(p,b,R)=>{const x=new Map,j=T=>{let K=x.get(T.base);return K||(K={driver:T.driver,base:T.base,items:[]},x.set(T.base,K)),K};for(const T of p){const K=typeof T=="string",re=ur(K?T:T.key),he=K?void 0:T.value,le=K||!T.options?b:{...b,...T.options},fe=r(re);j(fe).items.push({key:re,value:he,relativeKey:fe.relativeKey,options:le})}return Promise.all([...x.values()].map(T=>R(T))).then(T=>T.flat())},_={hasItem(p,b={}){p=ur(p);const{relativeKey:R,driver:x}=r(p);return Ut(x.hasItem,R,b)},getItem(p,b={}){p=ur(p);const{relativeKey:R,driver:x}=r(p);return Ut(x.getItem,R,b).then(j=>co(j))},getItems(p,b){return g(p,b,R=>R.driver.getItems?Ut(R.driver.getItems,R.items.map(x=>({key:x.relativeKey,options:x.options})),b).then(x=>x.map(j=>({key:I_(R.base,j.key),value:co(j.value)}))):Promise.all(R.items.map(x=>Ut(R.driver.getItem,x.relativeKey,x.options).then(j=>({key:x.key,value:co(j)})))))},getItemRaw(p,b={}){p=ur(p);const{relativeKey:R,driver:x}=r(p);return x.getItemRaw?Ut(x.getItemRaw,R,b):Ut(x.getItem,R,b).then(j=>E_(j))},async setItem(p,b,R={}){if(b===void 0)return _.removeItem(p);p=ur(p);const{relativeKey:x,driver:j}=r(p);j.setItem&&(await Ut(j.setItem,x,yo(b),R),j.watch||s("update",p))},async setItems(p,b){await g(p,b,async R=>{R.driver.setItems&&await Ut(R.driver.setItems,R.items.map(x=>({key:x.relativeKey,value:yo(x.value),options:x.options})),b),R.driver.setItem&&await Promise.all(R.items.map(x=>Ut(R.driver.setItem,x.relativeKey,yo(x.value),x.options)))})},async setItemRaw(p,b,R={}){if(b===void 0)return _.removeItem(p,R);p=ur(p);const{relativeKey:x,driver:j}=r(p);if(j.setItemRaw)await Ut(j.setItemRaw,x,b,R);else if(j.setItem)await Ut(j.setItem,x,b_(b),R);else return;j.watch||s("update",p)},async removeItem(p,b={}){typeof b=="boolean"&&(b={removeMeta:b}),p=ur(p);const{relativeKey:R,driver:x}=r(p);x.removeItem&&(await Ut(x.removeItem,R,b),(b.removeMeta||b.removeMata)&&await Ut(x.removeItem,R+"$",b),x.watch||s("remove",p))},async getMeta(p,b={}){typeof b=="boolean"&&(b={nativeOnly:b}),p=ur(p);const{relativeKey:R,driver:x}=r(p),j=Object.create(null);if(x.getMeta&&Object.assign(j,await Ut(x.getMeta,R,b)),!b.nativeOnly){const T=await Ut(x.getItem,R+"$",b).then(K=>co(K));T&&typeof T=="object"&&(typeof T.atime=="string"&&(T.atime=new Date(T.atime)),typeof T.mtime=="string"&&(T.mtime=new Date(T.mtime)),Object.assign(j,T))}return j},setMeta(p,b,R={}){return this.setItem(p+"$",b,R)},removeMeta(p,b={}){return this.removeItem(p+"$",b)},async getKeys(p,b={}){p=uo(p);const R=n(p,!0);let x=[];const j=[];for(const T of R){const re=(await Ut(T.driver.getKeys,T.relativeBase,b)).map(he=>T.mountpoint+ur(he)).filter(he=>!x.some(le=>he.startsWith(le)));j.push(...re),x=[T.mountpoint,...x.filter(he=>!he.startsWith(T.mountpoint))]}return p?j.filter(T=>T.startsWith(p)&&!T.endsWith("$")):j.filter(T=>!T.endsWith("$"))},async clear(p,b={}){p=uo(p),await Promise.all(n(p,!1).map(async R=>{if(R.driver.clear)return Ut(R.driver.clear,R.relativeBase,b);if(R.driver.removeItem){const x=await R.driver.getKeys(R.relativeBase||"",b);return Promise.all(x.map(j=>R.driver.removeItem(j,b)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(p=>Yh(p)))},async watch(p){return await c(),t.watchListeners.push(p),async()=>{t.watchListeners=t.watchListeners.filter(b=>b!==p),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(p,b){if(p=uo(p),p&&t.mounts[p])throw new Error(`already mounted at ${p}`);return p&&(t.mountpoints.push(p),t.mountpoints.sort((R,x)=>x.length-R.length)),t.mounts[p]=b,t.watching&&Promise.resolve(Qh(b,s,p)).then(R=>{t.unwatch[p]=R}).catch(console.error),_},async unmount(p,b=!0){p=uo(p),!(!p||!t.mounts[p])&&(t.watching&&p in t.unwatch&&(t.unwatch[p](),delete t.unwatch[p]),b&&await Yh(t.mounts[p]),t.mountpoints=t.mountpoints.filter(R=>R!==p),delete t.mounts[p])},getMount(p=""){p=ur(p)+":";const b=r(p);return{driver:b.driver,base:b.base}},getMounts(p="",b={}){return p=ur(p),n(p,b.parents).map(x=>({driver:x.driver,base:x.mountpoint}))}};return _}function Qh(a,t,r){return a.watch?a.watch((n,s)=>t(n,r+s)):()=>{}}async function Yh(a){typeof a.dispose=="function"&&await Ut(a.dispose)}function Bi(a){return new Promise((t,r)=>{a.oncomplete=a.onsuccess=()=>t(a.result),a.onabort=a.onerror=()=>r(a.error)})}function hf(a,t){const r=indexedDB.open(a);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Bi(r);return(s,c)=>n.then(f=>c(f.transaction(t,s).objectStore(t)))}let tc;function es(){return tc||(tc=hf("keyval-store","keyval")),tc}function Xh(a,t=es()){return t("readonly",r=>Bi(r.get(a)))}function O_(a,t,r=es()){return r("readwrite",n=>(n.put(t,a),Bi(n.transaction)))}function A_(a,t=es()){return t("readwrite",r=>(r.delete(a),Bi(r.transaction)))}function R_(a=es()){return a("readwrite",t=>(t.clear(),Bi(t.transaction)))}function C_(a,t){return a.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Bi(a.transaction)}function T_(a=es()){return a("readonly",t=>{if(t.getAllKeys)return Bi(t.getAllKeys());const r=[];return C_(t,n=>r.push(n.key)).then(()=>r)})}const N_=a=>JSON.stringify(a,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),D_=a=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=a.replace(t,'$1"$2n"$3');return JSON.parse(r,(n,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ts(a){if(typeof a!="string")throw new Error(`Cannot safe json parse value of type ${typeof a}`);try{return D_(a)}catch{return a}}function Hi(a){return typeof a=="string"?a:N_(a)||""}const j_="idb-keyval";var $_=(a={})=>{const t=a.base&&a.base.length>0?`${a.base}:`:"",r=s=>t+s;let n;return a.dbName&&a.storeName&&(n=hf(a.dbName,a.storeName)),{name:j_,options:a,async hasItem(s){return!(typeof await Xh(r(s),n)>"u")},async getItem(s){return await Xh(r(s),n)??null},setItem(s,c){return O_(r(s),c,n)},removeItem(s){return A_(r(s),n)},getKeys(){return T_(n)},clear(){return R_(n)}}};const F_="WALLET_CONNECT_V2_INDEXED_DB",L_="keyvaluestorage";let M_=class{constructor(){this.indexedDb=P_({driver:$_({dbName:F_,storeName:L_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Hi(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var rc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vo={exports:{}};(function(){let a;function t(){}a=t,a.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},a.prototype.setItem=function(r,n){this[r]=String(n)},a.prototype.removeItem=function(r){delete this[r]},a.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},a.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},a.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof rc<"u"&&rc.localStorage?vo.exports=rc.localStorage:typeof window<"u"&&window.localStorage?vo.exports=window.localStorage:vo.exports=new t})();function q_(a){var t;return[a[0],ts((t=a[1])!=null?t:"")]}let U_=class{constructor(){this.localStorage=vo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(q_)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return ts(r)}async setItem(t,r){this.localStorage.setItem(t,Hi(r))}async removeItem(t){this.localStorage.removeItem(t)}};const z_="wc_storage_version",Zh=1,k_=async(a,t,r)=>{const n=z_,s=await t.getItem(n);if(s&&s>=Zh){r(t);return}const c=await a.getKeys();if(!c.length){r(t);return}const f=[];for(;c.length;){const g=c.shift();if(!g)continue;const _=g.toLowerCase();if(_.includes("wc@")||_.includes("walletconnect")||_.includes("wc_")||_.includes("wallet_connect")){const p=await a.getItem(g);await t.setItem(g,p),f.push(g)}}await t.setItem(n,Zh),r(t),H_(a,f)},H_=async(a,t)=>{t.length&&t.forEach(async r=>{await a.removeItem(r)})};let B_=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new U_;this.storage=t;try{const r=new M_;k_(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var _n={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _c=function(a,t){return _c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},_c(a,t)};function K_(a,t){_c(a,t);function r(){this.constructor=a}a.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var wc=function(){return wc=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},wc.apply(this,arguments)};function V_(a,t){var r={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&t.indexOf(n)<0&&(r[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(a);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(a,n[s])&&(r[n[s]]=a[n[s]]);return r}function G_(a,t,r,n){var s=arguments.length,c=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,t,r,n);else for(var g=a.length-1;g>=0;g--)(f=a[g])&&(c=(s<3?f(c):s>3?f(t,r,c):f(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c}function W_(a,t){return function(r,n){t(r,n,a)}}function J_(a,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,t)}function Q_(a,t,r,n){function s(c){return c instanceof r?c:new r(function(f){f(c)})}return new(r||(r=Promise))(function(c,f){function g(b){try{p(n.next(b))}catch(R){f(R)}}function _(b){try{p(n.throw(b))}catch(R){f(R)}}function p(b){b.done?c(b.value):s(b.value).then(g,_)}p((n=n.apply(a,t||[])).next())})}function Y_(a,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(p){return function(b){return _([p,b])}}function _(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,s=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(a,r)}catch(b){p=[6,b],s=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function X_(a,t,r,n){n===void 0&&(n=r),a[n]=t[r]}function Z_(a,t){for(var r in a)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=a[r])}function bc(a){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&a[t],n=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&n>=a.length&&(a=void 0),{value:a&&a[n++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function lf(a,t){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var n=r.call(a),s,c=[],f;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(g){f={error:g}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return c}function e1(){for(var a=[],t=0;t<arguments.length;t++)a=a.concat(lf(arguments[t]));return a}function t1(){for(var a=0,t=0,r=arguments.length;t<r;t++)a+=arguments[t].length;for(var n=Array(a),s=0,t=0;t<r;t++)for(var c=arguments[t],f=0,g=c.length;f<g;f++,s++)n[s]=c[f];return n}function Yn(a){return this instanceof Yn?(this.v=a,this):new Yn(a)}function r1(a,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(a,t||[]),s,c=[];return s={},f("next"),f("throw"),f("return"),s[Symbol.asyncIterator]=function(){return this},s;function f(x){n[x]&&(s[x]=function(j){return new Promise(function(T,K){c.push([x,j,T,K])>1||g(x,j)})})}function g(x,j){try{_(n[x](j))}catch(T){R(c[0][3],T)}}function _(x){x.value instanceof Yn?Promise.resolve(x.value.v).then(p,b):R(c[0][2],x)}function p(x){g("next",x)}function b(x){g("throw",x)}function R(x,j){x(j),c.shift(),c.length&&g(c[0][0],c[0][1])}}function i1(a){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,c){t[s]=a[s]?function(f){return(r=!r)?{value:Yn(a[s](f)),done:s==="return"}:c?c(f):f}:c}}function n1(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=a[Symbol.asyncIterator],r;return t?t.call(a):(a=typeof bc=="function"?bc(a):a[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=a[c]&&function(f){return new Promise(function(g,_){f=a[c](f),s(g,_,f.done,f.value)})}}function s(c,f,g,_){Promise.resolve(_).then(function(p){c({value:p,done:g})},f)}}function s1(a,t){return Object.defineProperty?Object.defineProperty(a,"raw",{value:t}):a.raw=t,a}function o1(a){if(a&&a.__esModule)return a;var t={};if(a!=null)for(var r in a)Object.hasOwnProperty.call(a,r)&&(t[r]=a[r]);return t.default=a,t}function a1(a){return a&&a.__esModule?a:{default:a}}function c1(a,t){if(!t.has(a))throw new TypeError("attempted to get private field on non-instance");return t.get(a)}function u1(a,t,r){if(!t.has(a))throw new TypeError("attempted to set private field on non-instance");return t.set(a,r),r}const h1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return wc},__asyncDelegator:i1,__asyncGenerator:r1,__asyncValues:n1,__await:Yn,__awaiter:Q_,__classPrivateFieldGet:c1,__classPrivateFieldSet:u1,__createBinding:X_,__decorate:G_,__exportStar:Z_,__extends:K_,__generator:Y_,__importDefault:a1,__importStar:o1,__makeTemplateObject:s1,__metadata:J_,__param:W_,__read:lf,__rest:V_,__spread:e1,__spreadArrays:t1,__values:bc},Symbol.toStringTag,{value:"Module"})),xo=Eo(h1);var qn={},ic={},Un={};let Ki=class{};const l1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ki},Symbol.toStringTag,{value:"Module"})),f1=Eo(l1);var el;function p1(){if(el)return Un;el=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.IHeartBeat=void 0;const a=f1;class t extends a.IEvents{constructor(n){super()}}return Un.IHeartBeat=t,Un}var tl;function ff(){return tl||(tl=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),xo.__exportStar(p1(),a)}(ic)),ic}var nc={},zi={},rl;function d1(){if(rl)return zi;rl=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.HEARTBEAT_EVENTS=zi.HEARTBEAT_INTERVAL=void 0;const a=ne;return zi.HEARTBEAT_INTERVAL=a.FIVE_SECONDS,zi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},zi}var il;function pf(){return il||(il=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),xo.__exportStar(d1(),a)}(nc)),nc}var nl;function g1(){if(nl)return qn;nl=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.HeartBeat=void 0;const a=xo,t=Or,r=ne,n=ff(),s=pf();class c extends n.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||s.HEARTBEAT_INTERVAL}static init(g){return a.__awaiter(this,void 0,void 0,function*(){const _=new c(g);return yield _.init(),_})}init(){return a.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,_){this.events.on(g,_)}once(g,_){this.events.once(g,_)}off(g,_){this.events.off(g,_)}removeListener(g,_){this.events.removeListener(g,_)}initialize(){return a.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return qn.HeartBeat=c,qn}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const t=xo;t.__exportStar(g1(),a),t.__exportStar(ff(),a),t.__exportStar(pf(),a)})(_n);var Ce={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ec=function(a,t){return Ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Ec(a,t)};function y1(a,t){Ec(a,t);function r(){this.constructor=a}a.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Ic=function(){return Ic=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Ic.apply(this,arguments)};function v1(a,t){var r={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&t.indexOf(n)<0&&(r[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(a);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(a,n[s])&&(r[n[s]]=a[n[s]]);return r}function m1(a,t,r,n){var s=arguments.length,c=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,t,r,n);else for(var g=a.length-1;g>=0;g--)(f=a[g])&&(c=(s<3?f(c):s>3?f(t,r,c):f(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c}function _1(a,t){return function(r,n){t(r,n,a)}}function w1(a,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,t)}function b1(a,t,r,n){function s(c){return c instanceof r?c:new r(function(f){f(c)})}return new(r||(r=Promise))(function(c,f){function g(b){try{p(n.next(b))}catch(R){f(R)}}function _(b){try{p(n.throw(b))}catch(R){f(R)}}function p(b){b.done?c(b.value):s(b.value).then(g,_)}p((n=n.apply(a,t||[])).next())})}function E1(a,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(p){return function(b){return _([p,b])}}function _(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,s=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(a,r)}catch(b){p=[6,b],s=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function I1(a,t,r,n){n===void 0&&(n=r),a[n]=t[r]}function x1(a,t){for(var r in a)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=a[r])}function xc(a){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&a[t],n=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&n>=a.length&&(a=void 0),{value:a&&a[n++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function df(a,t){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var n=r.call(a),s,c=[],f;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(g){f={error:g}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return c}function S1(){for(var a=[],t=0;t<arguments.length;t++)a=a.concat(df(arguments[t]));return a}function P1(){for(var a=0,t=0,r=arguments.length;t<r;t++)a+=arguments[t].length;for(var n=Array(a),s=0,t=0;t<r;t++)for(var c=arguments[t],f=0,g=c.length;f<g;f++,s++)n[s]=c[f];return n}function Xn(a){return this instanceof Xn?(this.v=a,this):new Xn(a)}function O1(a,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(a,t||[]),s,c=[];return s={},f("next"),f("throw"),f("return"),s[Symbol.asyncIterator]=function(){return this},s;function f(x){n[x]&&(s[x]=function(j){return new Promise(function(T,K){c.push([x,j,T,K])>1||g(x,j)})})}function g(x,j){try{_(n[x](j))}catch(T){R(c[0][3],T)}}function _(x){x.value instanceof Xn?Promise.resolve(x.value.v).then(p,b):R(c[0][2],x)}function p(x){g("next",x)}function b(x){g("throw",x)}function R(x,j){x(j),c.shift(),c.length&&g(c[0][0],c[0][1])}}function A1(a){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,c){t[s]=a[s]?function(f){return(r=!r)?{value:Xn(a[s](f)),done:s==="return"}:c?c(f):f}:c}}function R1(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=a[Symbol.asyncIterator],r;return t?t.call(a):(a=typeof xc=="function"?xc(a):a[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=a[c]&&function(f){return new Promise(function(g,_){f=a[c](f),s(g,_,f.done,f.value)})}}function s(c,f,g,_){Promise.resolve(_).then(function(p){c({value:p,done:g})},f)}}function C1(a,t){return Object.defineProperty?Object.defineProperty(a,"raw",{value:t}):a.raw=t,a}function T1(a){if(a&&a.__esModule)return a;var t={};if(a!=null)for(var r in a)Object.hasOwnProperty.call(a,r)&&(t[r]=a[r]);return t.default=a,t}function N1(a){return a&&a.__esModule?a:{default:a}}function D1(a,t){if(!t.has(a))throw new TypeError("attempted to get private field on non-instance");return t.get(a)}function j1(a,t,r){if(!t.has(a))throw new TypeError("attempted to set private field on non-instance");return t.set(a,r),r}const $1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ic},__asyncDelegator:A1,__asyncGenerator:O1,__asyncValues:R1,__await:Xn,__awaiter:b1,__classPrivateFieldGet:D1,__classPrivateFieldSet:j1,__createBinding:I1,__decorate:m1,__exportStar:x1,__extends:y1,__generator:E1,__importDefault:N1,__importStar:T1,__makeTemplateObject:C1,__metadata:w1,__param:_1,__read:df,__rest:v1,__spread:S1,__spreadArrays:P1,__values:xc},Symbol.toStringTag,{value:"Module"})),F1=Eo($1);var sc,sl;function L1(){if(sl)return sc;sl=1;function a(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}sc=t;function t(r,n,s){var c=s&&s.stringify||a,f=1;if(typeof r=="object"&&r!==null){var g=n.length+f;if(g===1)return r;var _=new Array(g);_[0]=c(r);for(var p=1;p<g;p++)_[p]=c(n[p]);return _.join(" ")}if(typeof r!="string")return r;var b=n.length;if(b===0)return r;for(var R="",x=1-f,j=-1,T=r&&r.length||0,K=0;K<T;){if(r.charCodeAt(K)===37&&K+1<T){switch(j=j>-1?j:0,r.charCodeAt(K+1)){case 100:case 102:if(x>=b||n[x]==null)break;j<K&&(R+=r.slice(j,K)),R+=Number(n[x]),j=K+2,K++;break;case 105:if(x>=b||n[x]==null)break;j<K&&(R+=r.slice(j,K)),R+=Math.floor(Number(n[x])),j=K+2,K++;break;case 79:case 111:case 106:if(x>=b||n[x]===void 0)break;j<K&&(R+=r.slice(j,K));var re=typeof n[x];if(re==="string"){R+="'"+n[x]+"'",j=K+2,K++;break}if(re==="function"){R+=n[x].name||"<anonymous>",j=K+2,K++;break}R+=c(n[x]),j=K+2,K++;break;case 115:if(x>=b)break;j<K&&(R+=r.slice(j,K)),R+=String(n[x]),j=K+2,K++;break;case 37:j<K&&(R+=r.slice(j,K)),R+="%",j=K+2,K++,x--;break}++x}++K}return j===-1?r:(j<T&&(R+=r.slice(j)),R)}return sc}var oc,ol;function M1(){if(ol)return oc;ol=1;const a=L1();oc=s;const t=de().console||{},r={mapHttpRequest:T,mapHttpResponse:T,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:T,res:T,err:x};function n(F,z){return Array.isArray(F)?F.filter(function(ve){return ve!=="!stdSerializers.err"}):F===!0?Object.keys(z):!1}function s(F){F=F||{},F.browser=F.browser||{};const z=F.browser.transmit;if(z&&typeof z.send!="function")throw Error("pino: transmit option must have a send function");const W=F.browser.write||t;F.browser.write&&(F.browser.asObject=!0);const ve=F.serializers||{},ie=n(F.browser.serialize,ve);let ue=F.browser.serialize;Array.isArray(F.browser.serialize)&&F.browser.serialize.indexOf("!stdSerializers.err")>-1&&(ue=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),F.enabled===!1&&(F.level="silent");const Ue=F.level||"info",m=Object.create(W);m.log||(m.log=re),Object.defineProperty(m,"levelVal",{get:Y}),Object.defineProperty(m,"level",{get:ce,set:V});const S={transmit:z,serialize:ie,asObject:F.browser.asObject,levels:Te,timestamp:j(F)};m.levels=s.levels,m.level=Ue,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=re,m.serializers=ve,m._serialize=ie,m._stdErrSerialize=ue,m.child=k,z&&(m._logEvent=R());function Y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function ce(){return this._level}function V(B){if(B!=="silent"&&!this.levels.values[B])throw Error("unknown level "+B);this._level=B,c(S,m,"error","log"),c(S,m,"fatal","error"),c(S,m,"warn","error"),c(S,m,"info","log"),c(S,m,"debug","log"),c(S,m,"trace","log")}function k(B,G){if(!B)throw new Error("missing bindings for child Pino");G=G||{},ie&&B.serializers&&(G.serializers=B.serializers);const Je=G.serializers;if(ie&&Je){var He=Object.assign({},ve,Je),Mr=F.browser.serialize===!0?Object.keys(He):ie;delete B.serializers,_([B],Mr,He,this._stdErrSerialize)}function Ie(It){this._childLevel=(It._childLevel|0)+1,this.error=p(It,B,"error"),this.fatal=p(It,B,"fatal"),this.warn=p(It,B,"warn"),this.info=p(It,B,"info"),this.debug=p(It,B,"debug"),this.trace=p(It,B,"trace"),He&&(this.serializers=He,this._serialize=Mr),z&&(this._logEvent=R([].concat(It._logEvent.bindings,B)))}return Ie.prototype=this,new Ie(this)}return m}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:he,epochTime:le,unixTime:fe,isoTime:pe});function c(F,z,W,ve){const ie=Object.getPrototypeOf(z);z[W]=z.levelVal>z.levels.values[W]?re:ie[W]?ie[W]:t[W]||t[ve]||re,f(F,z,W)}function f(F,z,W){!F.transmit&&z[W]===re||(z[W]=function(ve){return function(){const ue=F.timestamp(),Te=new Array(arguments.length),Ue=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var m=0;m<Te.length;m++)Te[m]=arguments[m];if(F.serialize&&!F.asObject&&_(Te,this._serialize,this.serializers,this._stdErrSerialize),F.asObject?ve.call(Ue,g(this,W,Te,ue)):ve.apply(Ue,Te),F.transmit){const S=F.transmit.level||z.level,Y=s.levels.values[S],ce=s.levels.values[W];if(ce<Y)return;b(this,{ts:ue,methodLevel:W,methodValue:ce,transmitLevel:S,transmitValue:s.levels.values[F.transmit.level||z.level],send:F.transmit.send,val:z.levelVal},Te)}}}(z[W]))}function g(F,z,W,ve){F._serialize&&_(W,F._serialize,F.serializers,F._stdErrSerialize);const ie=W.slice();let ue=ie[0];const Te={};ve&&(Te.time=ve),Te.level=s.levels.values[z];let Ue=(F._childLevel|0)+1;if(Ue<1&&(Ue=1),ue!==null&&typeof ue=="object"){for(;Ue--&&typeof ie[0]=="object";)Object.assign(Te,ie.shift());ue=ie.length?a(ie.shift(),ie):void 0}else typeof ue=="string"&&(ue=a(ie.shift(),ie));return ue!==void 0&&(Te.msg=ue),Te}function _(F,z,W,ve){for(const ie in F)if(ve&&F[ie]instanceof Error)F[ie]=s.stdSerializers.err(F[ie]);else if(typeof F[ie]=="object"&&!Array.isArray(F[ie]))for(const ue in F[ie])z&&z.indexOf(ue)>-1&&ue in W&&(F[ie][ue]=W[ue](F[ie][ue]))}function p(F,z,W){return function(){const ve=new Array(1+arguments.length);ve[0]=z;for(var ie=1;ie<ve.length;ie++)ve[ie]=arguments[ie-1];return F[W].apply(this,ve)}}function b(F,z,W){const ve=z.send,ie=z.ts,ue=z.methodLevel,Te=z.methodValue,Ue=z.val,m=F._logEvent.bindings;_(W,F._serialize||Object.keys(F.serializers),F.serializers,F._stdErrSerialize===void 0?!0:F._stdErrSerialize),F._logEvent.ts=ie,F._logEvent.messages=W.filter(function(S){return m.indexOf(S)===-1}),F._logEvent.level.label=ue,F._logEvent.level.value=Te,ve(ue,F._logEvent,Ue),F._logEvent=R(m)}function R(F){return{ts:0,messages:[],bindings:F||[],level:{label:"",value:0}}}function x(F){const z={type:F.constructor.name,msg:F.message,stack:F.stack};for(const W in F)z[W]===void 0&&(z[W]=F[W]);return z}function j(F){return typeof F.timestamp=="function"?F.timestamp:F.timestamp===!1?he:le}function T(){return{}}function K(F){return F}function re(){}function he(){return!1}function le(){return Date.now()}function fe(){return Math.round(Date.now()/1e3)}function pe(){return new Date(Date.now()).toISOString()}function de(){function F(z){return typeof z<"u"&&z}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return F(self)||F(window)||F(this)||{}}}return oc}var ki={},al;function gf(){return al||(al=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.PINO_CUSTOM_CONTEXT_KEY=ki.PINO_LOGGER_DEFAULTS=void 0,ki.PINO_LOGGER_DEFAULTS={level:"info"},ki.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ki}var er={},cl;function q1(){if(cl)return er;cl=1,Object.defineProperty(er,"__esModule",{value:!0}),er.generateChildLogger=er.formatChildLoggerContext=er.getLoggerContext=er.setBrowserLoggerContext=er.getBrowserLoggerContext=er.getDefaultLoggerOptions=void 0;const a=gf();function t(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||a.PINO_LOGGER_DEFAULTS.level})}er.getDefaultLoggerOptions=t;function r(g,_=a.PINO_CUSTOM_CONTEXT_KEY){return g[_]||""}er.getBrowserLoggerContext=r;function n(g,_,p=a.PINO_CUSTOM_CONTEXT_KEY){return g[p]=_,g}er.setBrowserLoggerContext=n;function s(g,_=a.PINO_CUSTOM_CONTEXT_KEY){let p="";return typeof g.bindings>"u"?p=r(g,_):p=g.bindings().context||"",p}er.getLoggerContext=s;function c(g,_,p=a.PINO_CUSTOM_CONTEXT_KEY){const b=s(g,p);return b.trim()?`${b}/${_}`:_}er.formatChildLoggerContext=c;function f(g,_,p=a.PINO_CUSTOM_CONTEXT_KEY){const b=c(g,_,p),R=g.child({context:b});return n(R,b,p)}return er.generateChildLogger=f,er}(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.pino=void 0;const t=F1,r=t.__importDefault(M1());Object.defineProperty(a,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(gf(),a),t.__exportStar(q1(),a)})(Ce);class U1 extends Ki{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}class z1 extends Ki{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}}class k1{constructor(t,r){this.logger=t,this.core=r}}let H1=class extends Ki{constructor(t,r){super(),this.relayer=t,this.logger=r}},B1=class extends Ki{constructor(t){super()}},K1=class{constructor(t,r,n,s){this.core=t,this.logger=r,this.name=n}};class V1 extends Ki{constructor(t,r){super(),this.relayer=t,this.logger=r}}let G1=class extends Ki{constructor(t,r){super(),this.core=t,this.logger=r}},W1=class{constructor(t,r){this.projectId=t,this.logger=r}},J1=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},Q1=class{constructor(t){this.client=t}};var Fc={},yf={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var t=P0,r=Zl;a.DIGEST_LENGTH=64,a.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=a.DIGEST_LENGTH,this.blockSize=a.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(_,p){if(p===void 0&&(p=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=p,this._bufferLength>0){for(;this._bufferLength<a.BLOCK_SIZE&&p>0;)this._buffer[this._bufferLength++]=_[b++],p--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(p>=this.blockSize&&(b=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,b,p),p%=this.blockSize);p>0;)this._buffer[this._bufferLength++]=_[b++],p--;return this},g.prototype.finish=function(_){if(!this._finished){var p=this._bytesHashed,b=this._bufferLength,R=p/536870912|0,x=p<<3,j=p%128<112?128:256;this._buffer[b]=128;for(var T=b+1;T<j-8;T++)this._buffer[T]=0;t.writeUint32BE(R,this._buffer,j-8),t.writeUint32BE(x,this._buffer,j-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,j),this._finished=!0}for(var T=0;T<this.digestLength/8;T++)t.writeUint32BE(this._stateHi[T],_,T*8),t.writeUint32BE(this._stateLo[T],_,T*8+4);return this},g.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(_){r.wipe(_.stateHi),r.wipe(_.stateLo),_.buffer&&r.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},g}();a.SHA512=n;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(g,_,p,b,R,x,j){for(var T=p[0],K=p[1],re=p[2],he=p[3],le=p[4],fe=p[5],pe=p[6],de=p[7],F=b[0],z=b[1],W=b[2],ve=b[3],ie=b[4],ue=b[5],Te=b[6],Ue=b[7],m,S,Y,ce,V,k,B,G;j>=128;){for(var Je=0;Je<16;Je++){var He=8*Je+x;g[Je]=t.readUint32BE(R,He),_[Je]=t.readUint32BE(R,He+4)}for(var Je=0;Je<80;Je++){var Mr=T,Ie=K,It=re,$=he,D=le,C=fe,h=pe,I=de,ee=F,ge=z,be=W,Ne=ve,je=ie,Pe=ue,xt=Te,mt=Ue;if(m=de,S=Ue,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=(le>>>14|ie<<32-14)^(le>>>18|ie<<32-18)^(ie>>>41-32|le<<32-(41-32)),S=(ie>>>14|le<<32-14)^(ie>>>18|le<<32-18)^(le>>>41-32|ie<<32-(41-32)),V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,m=le&fe^~le&pe,S=ie&ue^~ie&Te,V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,m=s[Je*2],S=s[Je*2+1],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,m=g[Je%16],S=_[Je%16],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,Y=B&65535|G<<16,ce=V&65535|k<<16,m=Y,S=ce,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=(T>>>28|F<<32-28)^(F>>>34-32|T<<32-(34-32))^(F>>>39-32|T<<32-(39-32)),S=(F>>>28|T<<32-28)^(T>>>34-32|F<<32-(34-32))^(T>>>39-32|F<<32-(39-32)),V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,m=T&K^T&re^K&re,S=F&z^F&W^z&W,V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,I=B&65535|G<<16,mt=V&65535|k<<16,m=$,S=Ne,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=Y,S=ce,V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,$=B&65535|G<<16,Ne=V&65535|k<<16,K=Mr,re=Ie,he=It,le=$,fe=D,pe=C,de=h,T=I,z=ee,W=ge,ve=be,ie=Ne,ue=je,Te=Pe,Ue=xt,F=mt,Je%16===15)for(var He=0;He<16;He++)m=g[He],S=_[He],V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=g[(He+9)%16],S=_[(He+9)%16],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,Y=g[(He+1)%16],ce=_[(He+1)%16],m=(Y>>>1|ce<<32-1)^(Y>>>8|ce<<32-8)^Y>>>7,S=(ce>>>1|Y<<32-1)^(ce>>>8|Y<<32-8)^(ce>>>7|Y<<32-7),V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,Y=g[(He+14)%16],ce=_[(He+14)%16],m=(Y>>>19|ce<<32-19)^(ce>>>61-32|Y<<32-(61-32))^Y>>>6,S=(ce>>>19|Y<<32-19)^(Y>>>61-32|ce<<32-(61-32))^(ce>>>6|Y<<32-6),V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,g[He]=B&65535|G<<16,_[He]=V&65535|k<<16}m=T,S=F,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[0],S=b[0],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[0]=T=B&65535|G<<16,b[0]=F=V&65535|k<<16,m=K,S=z,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[1],S=b[1],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[1]=K=B&65535|G<<16,b[1]=z=V&65535|k<<16,m=re,S=W,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[2],S=b[2],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[2]=re=B&65535|G<<16,b[2]=W=V&65535|k<<16,m=he,S=ve,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[3],S=b[3],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[3]=he=B&65535|G<<16,b[3]=ve=V&65535|k<<16,m=le,S=ie,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[4],S=b[4],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[4]=le=B&65535|G<<16,b[4]=ie=V&65535|k<<16,m=fe,S=ue,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[5],S=b[5],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[5]=fe=B&65535|G<<16,b[5]=ue=V&65535|k<<16,m=pe,S=Te,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[6],S=b[6],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[6]=pe=B&65535|G<<16,b[6]=Te=V&65535|k<<16,m=de,S=Ue,V=S&65535,k=S>>>16,B=m&65535,G=m>>>16,m=p[7],S=b[7],V+=S&65535,k+=S>>>16,B+=m&65535,G+=m>>>16,k+=V>>>16,B+=k>>>16,G+=B>>>16,p[7]=de=B&65535|G<<16,b[7]=Ue=V&65535|k<<16,x+=128,j-=128}return x}function f(g){var _=new n;_.update(g);var p=_.digest();return _.clean(),p}a.hash=f})(yf);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.convertSecretKeyToX25519=a.convertPublicKeyToX25519=a.verify=a.sign=a.extractPublicKeyFromSecretKey=a.generateKeyPair=a.generateKeyPairFromSeed=a.SEED_LENGTH=a.SECRET_KEY_LENGTH=a.PUBLIC_KEY_LENGTH=a.SIGNATURE_LENGTH=void 0;const t=ef,r=yf,n=Zl;a.SIGNATURE_LENGTH=64,a.PUBLIC_KEY_LENGTH=32,a.SECRET_KEY_LENGTH=64,a.SEED_LENGTH=32;function s($){const D=new Float64Array(16);if($)for(let C=0;C<$.length;C++)D[C]=$[C];return D}const c=new Uint8Array(32);c[0]=9;const f=s(),g=s([1]),_=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),p=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),R=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),x=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function j($,D){for(let C=0;C<16;C++)$[C]=D[C]|0}function T($){let D=1;for(let C=0;C<16;C++){let h=$[C]+D+65535;D=Math.floor(h/65536),$[C]=h-D*65536}$[0]+=D-1+37*(D-1)}function K($,D,C){const h=~(C-1);for(let I=0;I<16;I++){const ee=h&($[I]^D[I]);$[I]^=ee,D[I]^=ee}}function re($,D){const C=s(),h=s();for(let I=0;I<16;I++)h[I]=D[I];T(h),T(h),T(h);for(let I=0;I<2;I++){C[0]=h[0]-65517;for(let ge=1;ge<15;ge++)C[ge]=h[ge]-65535-(C[ge-1]>>16&1),C[ge-1]&=65535;C[15]=h[15]-32767-(C[14]>>16&1);const ee=C[15]>>16&1;C[14]&=65535,K(h,C,1-ee)}for(let I=0;I<16;I++)$[2*I]=h[I]&255,$[2*I+1]=h[I]>>8}function he($,D){let C=0;for(let h=0;h<32;h++)C|=$[h]^D[h];return(1&C-1>>>8)-1}function le($,D){const C=new Uint8Array(32),h=new Uint8Array(32);return re(C,$),re(h,D),he(C,h)}function fe($){const D=new Uint8Array(32);return re(D,$),D[0]&1}function pe($,D){for(let C=0;C<16;C++)$[C]=D[2*C]+(D[2*C+1]<<8);$[15]&=32767}function de($,D,C){for(let h=0;h<16;h++)$[h]=D[h]+C[h]}function F($,D,C){for(let h=0;h<16;h++)$[h]=D[h]-C[h]}function z($,D,C){let h,I,ee=0,ge=0,be=0,Ne=0,je=0,Pe=0,xt=0,mt=0,ot=0,Fe=0,Ye=0,Xe=0,at=0,ze=0,Ze=0,De=0,Be=0,ht=0,Me=0,St=0,jt=0,zt=0,kt=0,Lt=0,Wt=0,rr=0,qr=0,Jt=0,Vr=0,li=0,Oi=0,lt=C[0],rt=C[1],ft=C[2],pt=C[3],ct=C[4],it=C[5],Pt=C[6],Ot=C[7],dt=C[8],At=C[9],gt=C[10],_t=C[11],yt=C[12],Qe=C[13],Rt=C[14],Ct=C[15];h=D[0],ee+=h*lt,ge+=h*rt,be+=h*ft,Ne+=h*pt,je+=h*ct,Pe+=h*it,xt+=h*Pt,mt+=h*Ot,ot+=h*dt,Fe+=h*At,Ye+=h*gt,Xe+=h*_t,at+=h*yt,ze+=h*Qe,Ze+=h*Rt,De+=h*Ct,h=D[1],ge+=h*lt,be+=h*rt,Ne+=h*ft,je+=h*pt,Pe+=h*ct,xt+=h*it,mt+=h*Pt,ot+=h*Ot,Fe+=h*dt,Ye+=h*At,Xe+=h*gt,at+=h*_t,ze+=h*yt,Ze+=h*Qe,De+=h*Rt,Be+=h*Ct,h=D[2],be+=h*lt,Ne+=h*rt,je+=h*ft,Pe+=h*pt,xt+=h*ct,mt+=h*it,ot+=h*Pt,Fe+=h*Ot,Ye+=h*dt,Xe+=h*At,at+=h*gt,ze+=h*_t,Ze+=h*yt,De+=h*Qe,Be+=h*Rt,ht+=h*Ct,h=D[3],Ne+=h*lt,je+=h*rt,Pe+=h*ft,xt+=h*pt,mt+=h*ct,ot+=h*it,Fe+=h*Pt,Ye+=h*Ot,Xe+=h*dt,at+=h*At,ze+=h*gt,Ze+=h*_t,De+=h*yt,Be+=h*Qe,ht+=h*Rt,Me+=h*Ct,h=D[4],je+=h*lt,Pe+=h*rt,xt+=h*ft,mt+=h*pt,ot+=h*ct,Fe+=h*it,Ye+=h*Pt,Xe+=h*Ot,at+=h*dt,ze+=h*At,Ze+=h*gt,De+=h*_t,Be+=h*yt,ht+=h*Qe,Me+=h*Rt,St+=h*Ct,h=D[5],Pe+=h*lt,xt+=h*rt,mt+=h*ft,ot+=h*pt,Fe+=h*ct,Ye+=h*it,Xe+=h*Pt,at+=h*Ot,ze+=h*dt,Ze+=h*At,De+=h*gt,Be+=h*_t,ht+=h*yt,Me+=h*Qe,St+=h*Rt,jt+=h*Ct,h=D[6],xt+=h*lt,mt+=h*rt,ot+=h*ft,Fe+=h*pt,Ye+=h*ct,Xe+=h*it,at+=h*Pt,ze+=h*Ot,Ze+=h*dt,De+=h*At,Be+=h*gt,ht+=h*_t,Me+=h*yt,St+=h*Qe,jt+=h*Rt,zt+=h*Ct,h=D[7],mt+=h*lt,ot+=h*rt,Fe+=h*ft,Ye+=h*pt,Xe+=h*ct,at+=h*it,ze+=h*Pt,Ze+=h*Ot,De+=h*dt,Be+=h*At,ht+=h*gt,Me+=h*_t,St+=h*yt,jt+=h*Qe,zt+=h*Rt,kt+=h*Ct,h=D[8],ot+=h*lt,Fe+=h*rt,Ye+=h*ft,Xe+=h*pt,at+=h*ct,ze+=h*it,Ze+=h*Pt,De+=h*Ot,Be+=h*dt,ht+=h*At,Me+=h*gt,St+=h*_t,jt+=h*yt,zt+=h*Qe,kt+=h*Rt,Lt+=h*Ct,h=D[9],Fe+=h*lt,Ye+=h*rt,Xe+=h*ft,at+=h*pt,ze+=h*ct,Ze+=h*it,De+=h*Pt,Be+=h*Ot,ht+=h*dt,Me+=h*At,St+=h*gt,jt+=h*_t,zt+=h*yt,kt+=h*Qe,Lt+=h*Rt,Wt+=h*Ct,h=D[10],Ye+=h*lt,Xe+=h*rt,at+=h*ft,ze+=h*pt,Ze+=h*ct,De+=h*it,Be+=h*Pt,ht+=h*Ot,Me+=h*dt,St+=h*At,jt+=h*gt,zt+=h*_t,kt+=h*yt,Lt+=h*Qe,Wt+=h*Rt,rr+=h*Ct,h=D[11],Xe+=h*lt,at+=h*rt,ze+=h*ft,Ze+=h*pt,De+=h*ct,Be+=h*it,ht+=h*Pt,Me+=h*Ot,St+=h*dt,jt+=h*At,zt+=h*gt,kt+=h*_t,Lt+=h*yt,Wt+=h*Qe,rr+=h*Rt,qr+=h*Ct,h=D[12],at+=h*lt,ze+=h*rt,Ze+=h*ft,De+=h*pt,Be+=h*ct,ht+=h*it,Me+=h*Pt,St+=h*Ot,jt+=h*dt,zt+=h*At,kt+=h*gt,Lt+=h*_t,Wt+=h*yt,rr+=h*Qe,qr+=h*Rt,Jt+=h*Ct,h=D[13],ze+=h*lt,Ze+=h*rt,De+=h*ft,Be+=h*pt,ht+=h*ct,Me+=h*it,St+=h*Pt,jt+=h*Ot,zt+=h*dt,kt+=h*At,Lt+=h*gt,Wt+=h*_t,rr+=h*yt,qr+=h*Qe,Jt+=h*Rt,Vr+=h*Ct,h=D[14],Ze+=h*lt,De+=h*rt,Be+=h*ft,ht+=h*pt,Me+=h*ct,St+=h*it,jt+=h*Pt,zt+=h*Ot,kt+=h*dt,Lt+=h*At,Wt+=h*gt,rr+=h*_t,qr+=h*yt,Jt+=h*Qe,Vr+=h*Rt,li+=h*Ct,h=D[15],De+=h*lt,Be+=h*rt,ht+=h*ft,Me+=h*pt,St+=h*ct,jt+=h*it,zt+=h*Pt,kt+=h*Ot,Lt+=h*dt,Wt+=h*At,rr+=h*gt,qr+=h*_t,Jt+=h*yt,Vr+=h*Qe,li+=h*Rt,Oi+=h*Ct,ee+=38*Be,ge+=38*ht,be+=38*Me,Ne+=38*St,je+=38*jt,Pe+=38*zt,xt+=38*kt,mt+=38*Lt,ot+=38*Wt,Fe+=38*rr,Ye+=38*qr,Xe+=38*Jt,at+=38*Vr,ze+=38*li,Ze+=38*Oi,I=1,h=ee+I+65535,I=Math.floor(h/65536),ee=h-I*65536,h=ge+I+65535,I=Math.floor(h/65536),ge=h-I*65536,h=be+I+65535,I=Math.floor(h/65536),be=h-I*65536,h=Ne+I+65535,I=Math.floor(h/65536),Ne=h-I*65536,h=je+I+65535,I=Math.floor(h/65536),je=h-I*65536,h=Pe+I+65535,I=Math.floor(h/65536),Pe=h-I*65536,h=xt+I+65535,I=Math.floor(h/65536),xt=h-I*65536,h=mt+I+65535,I=Math.floor(h/65536),mt=h-I*65536,h=ot+I+65535,I=Math.floor(h/65536),ot=h-I*65536,h=Fe+I+65535,I=Math.floor(h/65536),Fe=h-I*65536,h=Ye+I+65535,I=Math.floor(h/65536),Ye=h-I*65536,h=Xe+I+65535,I=Math.floor(h/65536),Xe=h-I*65536,h=at+I+65535,I=Math.floor(h/65536),at=h-I*65536,h=ze+I+65535,I=Math.floor(h/65536),ze=h-I*65536,h=Ze+I+65535,I=Math.floor(h/65536),Ze=h-I*65536,h=De+I+65535,I=Math.floor(h/65536),De=h-I*65536,ee+=I-1+37*(I-1),I=1,h=ee+I+65535,I=Math.floor(h/65536),ee=h-I*65536,h=ge+I+65535,I=Math.floor(h/65536),ge=h-I*65536,h=be+I+65535,I=Math.floor(h/65536),be=h-I*65536,h=Ne+I+65535,I=Math.floor(h/65536),Ne=h-I*65536,h=je+I+65535,I=Math.floor(h/65536),je=h-I*65536,h=Pe+I+65535,I=Math.floor(h/65536),Pe=h-I*65536,h=xt+I+65535,I=Math.floor(h/65536),xt=h-I*65536,h=mt+I+65535,I=Math.floor(h/65536),mt=h-I*65536,h=ot+I+65535,I=Math.floor(h/65536),ot=h-I*65536,h=Fe+I+65535,I=Math.floor(h/65536),Fe=h-I*65536,h=Ye+I+65535,I=Math.floor(h/65536),Ye=h-I*65536,h=Xe+I+65535,I=Math.floor(h/65536),Xe=h-I*65536,h=at+I+65535,I=Math.floor(h/65536),at=h-I*65536,h=ze+I+65535,I=Math.floor(h/65536),ze=h-I*65536,h=Ze+I+65535,I=Math.floor(h/65536),Ze=h-I*65536,h=De+I+65535,I=Math.floor(h/65536),De=h-I*65536,ee+=I-1+37*(I-1),$[0]=ee,$[1]=ge,$[2]=be,$[3]=Ne,$[4]=je,$[5]=Pe,$[6]=xt,$[7]=mt,$[8]=ot,$[9]=Fe,$[10]=Ye,$[11]=Xe,$[12]=at,$[13]=ze,$[14]=Ze,$[15]=De}function W($,D){z($,D,D)}function ve($,D){const C=s();let h;for(h=0;h<16;h++)C[h]=D[h];for(h=253;h>=0;h--)W(C,C),h!==2&&h!==4&&z(C,C,D);for(h=0;h<16;h++)$[h]=C[h]}function ie($,D){const C=s();let h;for(h=0;h<16;h++)C[h]=D[h];for(h=250;h>=0;h--)W(C,C),h!==1&&z(C,C,D);for(h=0;h<16;h++)$[h]=C[h]}function ue($,D){const C=s(),h=s(),I=s(),ee=s(),ge=s(),be=s(),Ne=s(),je=s(),Pe=s();F(C,$[1],$[0]),F(Pe,D[1],D[0]),z(C,C,Pe),de(h,$[0],$[1]),de(Pe,D[0],D[1]),z(h,h,Pe),z(I,$[3],D[3]),z(I,I,p),z(ee,$[2],D[2]),de(ee,ee,ee),F(ge,h,C),F(be,ee,I),de(Ne,ee,I),de(je,h,C),z($[0],ge,be),z($[1],je,Ne),z($[2],Ne,be),z($[3],ge,je)}function Te($,D,C){for(let h=0;h<4;h++)K($[h],D[h],C)}function Ue($,D){const C=s(),h=s(),I=s();ve(I,D[2]),z(C,D[0],I),z(h,D[1],I),re($,h),$[31]^=fe(C)<<7}function m($,D,C){j($[0],f),j($[1],g),j($[2],g),j($[3],f);for(let h=255;h>=0;--h){const I=C[h/8|0]>>(h&7)&1;Te($,D,I),ue(D,$),ue($,$),Te($,D,I)}}function S($,D){const C=[s(),s(),s(),s()];j(C[0],b),j(C[1],R),j(C[2],g),z(C[3],b,R),m($,C,D)}function Y($){if($.length!==a.SEED_LENGTH)throw new Error(`ed25519: seed must be ${a.SEED_LENGTH} bytes`);const D=(0,r.hash)($);D[0]&=248,D[31]&=127,D[31]|=64;const C=new Uint8Array(32),h=[s(),s(),s(),s()];S(h,D),Ue(C,h);const I=new Uint8Array(64);return I.set($),I.set(C,32),{publicKey:C,secretKey:I}}a.generateKeyPairFromSeed=Y;function ce($){const D=(0,t.randomBytes)(32,$),C=Y(D);return(0,n.wipe)(D),C}a.generateKeyPair=ce;function V($){if($.length!==a.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${a.SECRET_KEY_LENGTH} bytes`);return new Uint8Array($.subarray(32))}a.extractPublicKeyFromSecretKey=V;const k=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function B($,D){let C,h,I,ee;for(h=63;h>=32;--h){for(C=0,I=h-32,ee=h-12;I<ee;++I)D[I]+=C-16*D[h]*k[I-(h-32)],C=Math.floor((D[I]+128)/256),D[I]-=C*256;D[I]+=C,D[h]=0}for(C=0,I=0;I<32;I++)D[I]+=C-(D[31]>>4)*k[I],C=D[I]>>8,D[I]&=255;for(I=0;I<32;I++)D[I]-=C*k[I];for(h=0;h<32;h++)D[h+1]+=D[h]>>8,$[h]=D[h]&255}function G($){const D=new Float64Array(64);for(let C=0;C<64;C++)D[C]=$[C];for(let C=0;C<64;C++)$[C]=0;B($,D)}function Je($,D){const C=new Float64Array(64),h=[s(),s(),s(),s()],I=(0,r.hash)($.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const ee=new Uint8Array(64);ee.set(I.subarray(32),32);const ge=new r.SHA512;ge.update(ee.subarray(32)),ge.update(D);const be=ge.digest();ge.clean(),G(be),S(h,be),Ue(ee,h),ge.reset(),ge.update(ee.subarray(0,32)),ge.update($.subarray(32)),ge.update(D);const Ne=ge.digest();G(Ne);for(let je=0;je<32;je++)C[je]=be[je];for(let je=0;je<32;je++)for(let Pe=0;Pe<32;Pe++)C[je+Pe]+=Ne[je]*I[Pe];return B(ee.subarray(32),C),ee}a.sign=Je;function He($,D){const C=s(),h=s(),I=s(),ee=s(),ge=s(),be=s(),Ne=s();return j($[2],g),pe($[1],D),W(I,$[1]),z(ee,I,_),F(I,I,$[2]),de(ee,$[2],ee),W(ge,ee),W(be,ge),z(Ne,be,ge),z(C,Ne,I),z(C,C,ee),ie(C,C),z(C,C,I),z(C,C,ee),z(C,C,ee),z($[0],C,ee),W(h,$[0]),z(h,h,ee),le(h,I)&&z($[0],$[0],x),W(h,$[0]),z(h,h,ee),le(h,I)?-1:(fe($[0])===D[31]>>7&&F($[0],f,$[0]),z($[3],$[0],$[1]),0)}function Mr($,D,C){const h=new Uint8Array(32),I=[s(),s(),s(),s()],ee=[s(),s(),s(),s()];if(C.length!==a.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${a.SIGNATURE_LENGTH} bytes`);if(He(ee,$))return!1;const ge=new r.SHA512;ge.update(C.subarray(0,32)),ge.update($),ge.update(D);const be=ge.digest();return G(be),m(I,ee,be),S(ee,C.subarray(32)),ue(I,ee),Ue(h,I),!he(C,h)}a.verify=Mr;function Ie($){let D=[s(),s(),s(),s()];if(He(D,$))throw new Error("Ed25519: invalid public key");let C=s(),h=s(),I=D[1];de(C,g,I),F(h,g,I),ve(h,h),z(C,C,h);let ee=new Uint8Array(32);return re(ee,C),ee}a.convertPublicKeyToX25519=Ie;function It($){const D=(0,r.hash)($.subarray(0,32));D[0]&=248,D[31]&=127,D[31]|=64;const C=new Uint8Array(D.subarray(0,32));return(0,n.wipe)(D),C}a.convertSecretKeyToX25519=It})(Fc);const Y1="EdDSA",X1="JWT",vf=".",mf="base64url",Z1="utf8",ew="utf8",tw=":",rw="did",iw="key",ul="base58btc",nw="z",sw="K36",ow=32;function _o(a){return Io(jc(Hi(a),Z1),mf)}function _f(a){const t=jc(sw,ul),r=nw+Io(O0([t,a]),ul);return[rw,iw,r].join(tw)}function aw(a){return Io(a,mf)}function cw(a){return jc([_o(a.header),_o(a.payload)].join(vf),ew)}function uw(a){return[_o(a.header),_o(a.payload),aw(a.signature)].join(vf)}function hl(a=ef.randomBytes(ow)){return Fc.generateKeyPairFromSeed(a)}async function hw(a,t,r,n,s=ne.fromMiliseconds(Date.now())){const c={alg:Y1,typ:X1},f=_f(n.publicKey),g=s+r,_={iss:f,sub:a,aud:t,iat:s,exp:g},p=cw({header:c,payload:_}),b=Fc.sign(n.secretKey,p);return uw({header:c,payload:_,signature:b})}const lw="PARSE_ERROR",fw="INVALID_REQUEST",pw="METHOD_NOT_FOUND",dw="INVALID_PARAMS",wf="INTERNAL_ERROR",Lc="SERVER_ERROR",gw=[-32700,-32600,-32601,-32602,-32603],Jn={[lw]:{code:-32700,message:"Parse error"},[fw]:{code:-32600,message:"Invalid Request"},[pw]:{code:-32601,message:"Method not found"},[dw]:{code:-32602,message:"Invalid params"},[wf]:{code:-32603,message:"Internal error"},[Lc]:{code:-32e3,message:"Server error"}},bf=Lc;function yw(a){return gw.includes(a)}function ll(a){return Object.keys(Jn).includes(a)?Jn[a]:Jn[bf]}function vw(a){const t=Object.values(Jn).find(r=>r.code===a);return t||Jn[bf]}function Ef(a,t,r){return a.message.includes("getaddrinfo ENOTFOUND")||a.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):a}var If={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Sc=function(a,t){return Sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},Sc(a,t)};function mw(a,t){Sc(a,t);function r(){this.constructor=a}a.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Pc=function(){return Pc=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Pc.apply(this,arguments)};function _w(a,t){var r={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&t.indexOf(n)<0&&(r[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(a);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(a,n[s])&&(r[n[s]]=a[n[s]]);return r}function ww(a,t,r,n){var s=arguments.length,c=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(a,t,r,n);else for(var g=a.length-1;g>=0;g--)(f=a[g])&&(c=(s<3?f(c):s>3?f(t,r,c):f(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c}function bw(a,t){return function(r,n){t(r,n,a)}}function Ew(a,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,t)}function Iw(a,t,r,n){function s(c){return c instanceof r?c:new r(function(f){f(c)})}return new(r||(r=Promise))(function(c,f){function g(b){try{p(n.next(b))}catch(R){f(R)}}function _(b){try{p(n.throw(b))}catch(R){f(R)}}function p(b){b.done?c(b.value):s(b.value).then(g,_)}p((n=n.apply(a,t||[])).next())})}function xw(a,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,s,c,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(p){return function(b){return _([p,b])}}function _(p){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return r.label++,{value:p[1],done:!1};case 5:r.label++,s=p[1],p=[0];continue;case 7:p=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){r=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){r.label=p[1];break}if(p[0]===6&&r.label<c[1]){r.label=c[1],c=p;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(p);break}c[2]&&r.ops.pop(),r.trys.pop();continue}p=t.call(a,r)}catch(b){p=[6,b],s=0}finally{n=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function Sw(a,t,r,n){n===void 0&&(n=r),a[n]=t[r]}function Pw(a,t){for(var r in a)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=a[r])}function Oc(a){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&a[t],n=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&n>=a.length&&(a=void 0),{value:a&&a[n++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function xf(a,t){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var n=r.call(a),s,c=[],f;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)c.push(s.value)}catch(g){f={error:g}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return c}function Ow(){for(var a=[],t=0;t<arguments.length;t++)a=a.concat(xf(arguments[t]));return a}function Aw(){for(var a=0,t=0,r=arguments.length;t<r;t++)a+=arguments[t].length;for(var n=Array(a),s=0,t=0;t<r;t++)for(var c=arguments[t],f=0,g=c.length;f<g;f++,s++)n[s]=c[f];return n}function Zn(a){return this instanceof Zn?(this.v=a,this):new Zn(a)}function Rw(a,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(a,t||[]),s,c=[];return s={},f("next"),f("throw"),f("return"),s[Symbol.asyncIterator]=function(){return this},s;function f(x){n[x]&&(s[x]=function(j){return new Promise(function(T,K){c.push([x,j,T,K])>1||g(x,j)})})}function g(x,j){try{_(n[x](j))}catch(T){R(c[0][3],T)}}function _(x){x.value instanceof Zn?Promise.resolve(x.value.v).then(p,b):R(c[0][2],x)}function p(x){g("next",x)}function b(x){g("throw",x)}function R(x,j){x(j),c.shift(),c.length&&g(c[0][0],c[0][1])}}function Cw(a){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,c){t[s]=a[s]?function(f){return(r=!r)?{value:Zn(a[s](f)),done:s==="return"}:c?c(f):f}:c}}function Tw(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=a[Symbol.asyncIterator],r;return t?t.call(a):(a=typeof Oc=="function"?Oc(a):a[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=a[c]&&function(f){return new Promise(function(g,_){f=a[c](f),s(g,_,f.done,f.value)})}}function s(c,f,g,_){Promise.resolve(_).then(function(p){c({value:p,done:g})},f)}}function Nw(a,t){return Object.defineProperty?Object.defineProperty(a,"raw",{value:t}):a.raw=t,a}function Dw(a){if(a&&a.__esModule)return a;var t={};if(a!=null)for(var r in a)Object.hasOwnProperty.call(a,r)&&(t[r]=a[r]);return t.default=a,t}function jw(a){return a&&a.__esModule?a:{default:a}}function $w(a,t){if(!t.has(a))throw new TypeError("attempted to get private field on non-instance");return t.get(a)}function Fw(a,t,r){if(!t.has(a))throw new TypeError("attempted to set private field on non-instance");return t.set(a,r),r}const Lw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Pc},__asyncDelegator:Cw,__asyncGenerator:Rw,__asyncValues:Tw,__await:Zn,__awaiter:Iw,__classPrivateFieldGet:$w,__classPrivateFieldSet:Fw,__createBinding:Sw,__decorate:ww,__exportStar:Pw,__extends:mw,__generator:xw,__importDefault:jw,__importStar:Dw,__makeTemplateObject:Nw,__metadata:Ew,__param:bw,__read:xf,__rest:_w,__spread:Ow,__spreadArrays:Aw,__values:Oc},Symbol.toStringTag,{value:"Module"})),Mw=Eo(Lw);var ni={},fl;function qw(){if(fl)return ni;fl=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.isBrowserCryptoAvailable=ni.getSubtleCrypto=ni.getBrowerCrypto=void 0;function a(){return(Lr===null||Lr===void 0?void 0:Lr.crypto)||(Lr===null||Lr===void 0?void 0:Lr.msCrypto)||{}}ni.getBrowerCrypto=a;function t(){const n=a();return n.subtle||n.webkitSubtle}ni.getSubtleCrypto=t;function r(){return!!a()&&!!t()}return ni.isBrowserCryptoAvailable=r,ni}var si={},pl;function Uw(){if(pl)return si;pl=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowser=si.isNode=si.isReactNative=void 0;function a(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}si.isReactNative=a;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}si.isNode=t;function r(){return!a()&&!t()}return si.isBrowser=r,si}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const t=Mw;t.__exportStar(qw(),a),t.__exportStar(Uw(),a)})(If);function Mc(a=3){const t=Date.now()*Math.pow(10,a),r=Math.floor(Math.random()*Math.pow(10,a));return t+r}function Sf(a=6){return BigInt(Mc(a))}function vn(a,t,r){return{id:r||Mc(),jsonrpc:"2.0",method:a,params:t}}function qc(a,t){return{id:a,jsonrpc:"2.0",result:t}}function So(a,t,r){return{id:a,jsonrpc:"2.0",error:zw(t,r)}}function zw(a,t){return typeof a>"u"?ll(wf):(typeof a=="string"&&(a=Object.assign(Object.assign({},ll(Lc)),{message:a})),typeof t<"u"&&(a.data=t),yw(a.code)&&(a=vw(a.code)),a)}class kw{}class Hw extends kw{constructor(){super()}}class Bw extends Hw{constructor(t){super()}}const Kw="^https?:",Vw="^wss?:";function Gw(a){const t=a.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Pf(a,t){const r=Gw(a);return typeof r>"u"?!1:new RegExp(t).test(r)}function dl(a){return Pf(a,Kw)}function gl(a){return Pf(a,Vw)}function Ww(a){return new RegExp("wss?://localhost(:d{2,5})?").test(a)}function Of(a){return typeof a=="object"&&"id"in a&&"jsonrpc"in a&&a.jsonrpc==="2.0"}function Uc(a){return Of(a)&&"method"in a}function Po(a){return Of(a)&&(ci(a)||Fr(a))}function ci(a){return"result"in a}function Fr(a){return"error"in a}class ui extends Bw{constructor(t){super(t),this.events=new Or.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(vn(t.method,t.params||[],t.id||Sf().toString()),r)}async requestStrict(t,r){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(c){s(c)}this.events.on(`${t.id}`,c=>{Fr(c)?s(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){s(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Po(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Jw=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Qw=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",yl=a=>a.split("?")[0],vl=10,Yw=Jw();class Xw{constructor(t){if(this.url=t,this.events=new Or.EventEmitter,this.registering=!1,!gl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Hi(t))}catch(n){this.onError(t.id,n)}}register(t=this.url){if(!gl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const s=If.isReactNative()?void 0:{rejectUnauthorized:!Ww(t)},c=new Yw(t,[],s);Qw()?c.onerror=f=>{const g=f;n(this.emitError(g.error))}:c.on("error",f=>{n(this.emitError(f))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ts(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),s=n.message||n.toString(),c=So(t,s);this.events.emit("payload",c)}parseError(t,r=this.url){return Ef(t,yl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>vl&&this.events.setMaxListeners(vl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${yl(this.url)}`));return this.events.emit("register_error",r),r}}var wo={exports:{}};wo.exports;(function(a,t){var r=200,n="__lodash_hash_undefined__",s=1,c=2,f=9007199254740991,g="[object Arguments]",_="[object Array]",p="[object AsyncFunction]",b="[object Boolean]",R="[object Date]",x="[object Error]",j="[object Function]",T="[object GeneratorFunction]",K="[object Map]",re="[object Number]",he="[object Null]",le="[object Object]",fe="[object Promise]",pe="[object Proxy]",de="[object RegExp]",F="[object Set]",z="[object String]",W="[object Symbol]",ve="[object Undefined]",ie="[object WeakMap]",ue="[object ArrayBuffer]",Te="[object DataView]",Ue="[object Float32Array]",m="[object Float64Array]",S="[object Int8Array]",Y="[object Int16Array]",ce="[object Int32Array]",V="[object Uint8Array]",k="[object Uint8ClampedArray]",B="[object Uint16Array]",G="[object Uint32Array]",Je=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,Mr=/^(?:0|[1-9]\d*)$/,Ie={};Ie[Ue]=Ie[m]=Ie[S]=Ie[Y]=Ie[ce]=Ie[V]=Ie[k]=Ie[B]=Ie[G]=!0,Ie[g]=Ie[_]=Ie[ue]=Ie[b]=Ie[Te]=Ie[R]=Ie[x]=Ie[j]=Ie[K]=Ie[re]=Ie[le]=Ie[de]=Ie[F]=Ie[z]=Ie[ie]=!1;var It=typeof Lr=="object"&&Lr&&Lr.Object===Object&&Lr,$=typeof self=="object"&&self&&self.Object===Object&&self,D=It||$||Function("return this")(),C=t&&!t.nodeType&&t,h=C&&!0&&a&&!a.nodeType&&a,I=h&&h.exports===C,ee=I&&It.process,ge=function(){try{return ee&&ee.binding&&ee.binding("util")}catch{}}(),be=ge&&ge.isTypedArray;function Ne(v,P){for(var U=-1,Q=v==null?0:v.length,Ve=0,me=[];++U<Q;){var et=v[U];P(et,U,v)&&(me[Ve++]=et)}return me}function je(v,P){for(var U=-1,Q=P.length,Ve=v.length;++U<Q;)v[Ve+U]=P[U];return v}function Pe(v,P){for(var U=-1,Q=v==null?0:v.length;++U<Q;)if(P(v[U],U,v))return!0;return!1}function xt(v,P){for(var U=-1,Q=Array(v);++U<v;)Q[U]=P(U);return Q}function mt(v){return function(P){return v(P)}}function ot(v,P){return v.has(P)}function Fe(v,P){return v==null?void 0:v[P]}function Ye(v){var P=-1,U=Array(v.size);return v.forEach(function(Q,Ve){U[++P]=[Ve,Q]}),U}function Xe(v,P){return function(U){return v(P(U))}}function at(v){var P=-1,U=Array(v.size);return v.forEach(function(Q){U[++P]=Q}),U}var ze=Array.prototype,Ze=Function.prototype,De=Object.prototype,Be=D["__core-js_shared__"],ht=Ze.toString,Me=De.hasOwnProperty,St=function(){var v=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),jt=De.toString,zt=RegExp("^"+ht.call(Me).replace(Je,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=I?D.Buffer:void 0,Lt=D.Symbol,Wt=D.Uint8Array,rr=De.propertyIsEnumerable,qr=ze.splice,Jt=Lt?Lt.toStringTag:void 0,Vr=Object.getOwnPropertySymbols,li=kt?kt.isBuffer:void 0,Oi=Xe(Object.keys,Object),lt=lr(D,"DataView"),rt=lr(D,"Map"),ft=lr(D,"Promise"),pt=lr(D,"Set"),ct=lr(D,"WeakMap"),it=lr(Object,"create"),Pt=Wr(lt),Ot=Wr(rt),dt=Wr(ft),At=Wr(pt),gt=Wr(ct),_t=Lt?Lt.prototype:void 0,yt=_t?_t.valueOf:void 0;function Qe(v){var P=-1,U=v==null?0:v.length;for(this.clear();++P<U;){var Q=v[P];this.set(Q[0],Q[1])}}function Rt(){this.__data__=it?it(null):{},this.size=0}function Ct(v){var P=this.has(v)&&delete this.__data__[v];return this.size-=P?1:0,P}function Ro(v){var P=this.__data__;if(it){var U=P[v];return U===n?void 0:U}return Me.call(P,v)?P[v]:void 0}function Co(v){var P=this.__data__;return it?P[v]!==void 0:Me.call(P,v)}function To(v,P){var U=this.__data__;return this.size+=this.has(v)?0:1,U[v]=it&&P===void 0?n:P,this}Qe.prototype.clear=Rt,Qe.prototype.delete=Ct,Qe.prototype.get=Ro,Qe.prototype.has=Co,Qe.prototype.set=To;function vr(v){var P=-1,U=v==null?0:v.length;for(this.clear();++P<U;){var Q=v[P];this.set(Q[0],Q[1])}}function No(){this.__data__=[],this.size=0}function Do(v){var P=this.__data__,U=Ai(P,v);if(U<0)return!1;var Q=P.length-1;return U==Q?P.pop():qr.call(P,U,1),--this.size,!0}function jo(v){var P=this.__data__,U=Ai(P,v);return U<0?void 0:P[U][1]}function $o(v){return Ai(this.__data__,v)>-1}function Fo(v,P){var U=this.__data__,Q=Ai(U,v);return Q<0?(++this.size,U.push([v,P])):U[Q][1]=P,this}vr.prototype.clear=No,vr.prototype.delete=Do,vr.prototype.get=jo,vr.prototype.has=$o,vr.prototype.set=Fo;function Gr(v){var P=-1,U=v==null?0:v.length;for(this.clear();++P<U;){var Q=v[P];this.set(Q[0],Q[1])}}function Gi(){this.size=0,this.__data__={hash:new Qe,map:new(rt||vr),string:new Qe}}function Lo(v){var P=fi(this,v).delete(v);return this.size-=P?1:0,P}function Wi(v){return fi(this,v).get(v)}function Mo(v){return fi(this,v).has(v)}function qo(v,P){var U=fi(this,v),Q=U.size;return U.set(v,P),this.size+=U.size==Q?0:1,this}Gr.prototype.clear=Gi,Gr.prototype.delete=Lo,Gr.prototype.get=Wi,Gr.prototype.has=Mo,Gr.prototype.set=qo;function Ji(v){var P=-1,U=v==null?0:v.length;for(this.__data__=new Gr;++P<U;)this.add(v[P])}function is(v){return this.__data__.set(v,n),this}function ns(v){return this.__data__.has(v)}Ji.prototype.add=Ji.prototype.push=is,Ji.prototype.has=ns;function Ar(v){var P=this.__data__=new vr(v);this.size=P.size}function Uo(){this.__data__=new vr,this.size=0}function zo(v){var P=this.__data__,U=P.delete(v);return this.size=P.size,U}function ko(v){return this.__data__.get(v)}function Ho(v){return this.__data__.has(v)}function ss(v,P){var U=this.__data__;if(U instanceof vr){var Q=U.__data__;if(!rt||Q.length<r-1)return Q.push([v,P]),this.size=++U.size,this;U=this.__data__=new Gr(Q)}return U.set(v,P),this.size=U.size,this}Ar.prototype.clear=Uo,Ar.prototype.delete=zo,Ar.prototype.get=ko,Ar.prototype.has=Ho,Ar.prototype.set=ss;function os(v,P){var U=Xi(v),Q=!U&&ms(v),Ve=!U&&!Q&&En(v),me=!U&&!Q&&!Ve&&bs(v),et=U||Q||Ve||me,Tt=et?xt(v.length,String):[],Ae=Tt.length;for(var Ge in v)(P||Me.call(v,Ge))&&!(et&&(Ge=="length"||Ve&&(Ge=="offset"||Ge=="parent")||me&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||ps(Ge,Ae)))&&Tt.push(Ge);return Tt}function Ai(v,P){for(var U=v.length;U--;)if(vs(v[U][0],P))return U;return-1}function wn(v,P,U){var Q=P(v);return Xi(v)?Q:je(Q,U(v))}function Ri(v){return v==null?v===void 0?ve:he:Jt&&Jt in Object(v)?ls(v):Vo(v)}function bn(v){return Ti(v)&&Ri(v)==g}function Ci(v,P,U,Q,Ve){return v===P?!0:v==null||P==null||!Ti(v)&&!Ti(P)?v!==v&&P!==P:as(v,P,U,Q,Ci,Ve)}function as(v,P,U,Q,Ve,me){var et=Xi(v),Tt=Xi(P),Ae=et?_:Ur(v),Ge=Tt?_:Ur(P);Ae=Ae==g?le:Ae,Ge=Ge==g?le:Ge;var wt=Ae==le,ir=Ge==le,Nt=Ae==Ge;if(Nt&&En(v)){if(!En(P))return!1;et=!0,wt=!1}if(Nt&&!wt)return me||(me=new Ar),et||bs(v)?Qi(v,P,U,Q,Ve,me):Ko(v,P,Ae,U,Q,Ve,me);if(!(U&s)){var tt=wt&&Me.call(v,"__wrapped__"),Qt=ir&&Me.call(P,"__wrapped__");if(tt||Qt){var Rr=tt?v.value():v,mr=Qt?P.value():P;return me||(me=new Ar),Ve(Rr,mr,U,Q,me)}}return Nt?(me||(me=new Ar),hs(v,P,U,Q,Ve,me)):!1}function Bo(v){if(!ws(v)||gs(v))return!1;var P=Zi(v)?zt:He;return P.test(Wr(v))}function cs(v){return Ti(v)&&_s(v.length)&&!!Ie[Ri(v)]}function us(v){if(!ys(v))return Oi(v);var P=[];for(var U in Object(v))Me.call(v,U)&&U!="constructor"&&P.push(U);return P}function Qi(v,P,U,Q,Ve,me){var et=U&s,Tt=v.length,Ae=P.length;if(Tt!=Ae&&!(et&&Ae>Tt))return!1;var Ge=me.get(v);if(Ge&&me.get(P))return Ge==P;var wt=-1,ir=!0,Nt=U&c?new Ji:void 0;for(me.set(v,P),me.set(P,v);++wt<Tt;){var tt=v[wt],Qt=P[wt];if(Q)var Rr=et?Q(Qt,tt,wt,P,v,me):Q(tt,Qt,wt,v,P,me);if(Rr!==void 0){if(Rr)continue;ir=!1;break}if(Nt){if(!Pe(P,function(mr,zr){if(!ot(Nt,zr)&&(tt===mr||Ve(tt,mr,U,Q,me)))return Nt.push(zr)})){ir=!1;break}}else if(!(tt===Qt||Ve(tt,Qt,U,Q,me))){ir=!1;break}}return me.delete(v),me.delete(P),ir}function Ko(v,P,U,Q,Ve,me,et){switch(U){case Te:if(v.byteLength!=P.byteLength||v.byteOffset!=P.byteOffset)return!1;v=v.buffer,P=P.buffer;case ue:return!(v.byteLength!=P.byteLength||!me(new Wt(v),new Wt(P)));case b:case R:case re:return vs(+v,+P);case x:return v.name==P.name&&v.message==P.message;case de:case z:return v==P+"";case K:var Tt=Ye;case F:var Ae=Q&s;if(Tt||(Tt=at),v.size!=P.size&&!Ae)return!1;var Ge=et.get(v);if(Ge)return Ge==P;Q|=c,et.set(v,P);var wt=Qi(Tt(v),Tt(P),Q,Ve,me,et);return et.delete(v),wt;case W:if(yt)return yt.call(v)==yt.call(P)}return!1}function hs(v,P,U,Q,Ve,me){var et=U&s,Tt=Yi(v),Ae=Tt.length,Ge=Yi(P),wt=Ge.length;if(Ae!=wt&&!et)return!1;for(var ir=Ae;ir--;){var Nt=Tt[ir];if(!(et?Nt in P:Me.call(P,Nt)))return!1}var tt=me.get(v);if(tt&&me.get(P))return tt==P;var Qt=!0;me.set(v,P),me.set(P,v);for(var Rr=et;++ir<Ae;){Nt=Tt[ir];var mr=v[Nt],zr=P[Nt];if(Q)var In=et?Q(zr,mr,Nt,P,v,me):Q(mr,zr,Nt,v,P,me);if(!(In===void 0?mr===zr||Ve(mr,zr,U,Q,me):In)){Qt=!1;break}Rr||(Rr=Nt=="constructor")}if(Qt&&!Rr){var Ni=v.constructor,Mt=P.constructor;Ni!=Mt&&"constructor"in v&&"constructor"in P&&!(typeof Ni=="function"&&Ni instanceof Ni&&typeof Mt=="function"&&Mt instanceof Mt)&&(Qt=!1)}return me.delete(v),me.delete(P),Qt}function Yi(v){return wn(v,Jo,fs)}function fi(v,P){var U=v.__data__;return ds(P)?U[typeof P=="string"?"string":"hash"]:U.map}function lr(v,P){var U=Fe(v,P);return Bo(U)?U:void 0}function ls(v){var P=Me.call(v,Jt),U=v[Jt];try{v[Jt]=void 0;var Q=!0}catch{}var Ve=jt.call(v);return Q&&(P?v[Jt]=U:delete v[Jt]),Ve}var fs=Vr?function(v){return v==null?[]:(v=Object(v),Ne(Vr(v),function(P){return rr.call(v,P)}))}:Ke,Ur=Ri;(lt&&Ur(new lt(new ArrayBuffer(1)))!=Te||rt&&Ur(new rt)!=K||ft&&Ur(ft.resolve())!=fe||pt&&Ur(new pt)!=F||ct&&Ur(new ct)!=ie)&&(Ur=function(v){var P=Ri(v),U=P==le?v.constructor:void 0,Q=U?Wr(U):"";if(Q)switch(Q){case Pt:return Te;case Ot:return K;case dt:return fe;case At:return F;case gt:return ie}return P});function ps(v,P){return P=P??f,!!P&&(typeof v=="number"||Mr.test(v))&&v>-1&&v%1==0&&v<P}function ds(v){var P=typeof v;return P=="string"||P=="number"||P=="symbol"||P=="boolean"?v!=="__proto__":v===null}function gs(v){return!!St&&St in v}function ys(v){var P=v&&v.constructor,U=typeof P=="function"&&P.prototype||De;return v===U}function Vo(v){return jt.call(v)}function Wr(v){if(v!=null){try{return ht.call(v)}catch{}try{return v+""}catch{}}return""}function vs(v,P){return v===P||v!==v&&P!==P}var ms=bn(function(){return arguments}())?bn:function(v){return Ti(v)&&Me.call(v,"callee")&&!rr.call(v,"callee")},Xi=Array.isArray;function Go(v){return v!=null&&_s(v.length)&&!Zi(v)}var En=li||ke;function Wo(v,P){return Ci(v,P)}function Zi(v){if(!ws(v))return!1;var P=Ri(v);return P==j||P==T||P==p||P==pe}function _s(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function ws(v){var P=typeof v;return v!=null&&(P=="object"||P=="function")}function Ti(v){return v!=null&&typeof v=="object"}var bs=be?mt(be):cs;function Jo(v){return Go(v)?os(v):us(v)}function Ke(){return[]}function ke(){return!1}a.exports=Wo})(wo,wo.exports);var Zw=wo.exports;const eb=tf(Zw);function tb(a,t){if(a.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<a.length;s++){var c=a.charAt(s),f=c.charCodeAt(0);if(r[f]!==255)throw new TypeError(c+" is ambiguous");r[f]=s}var g=a.length,_=a.charAt(0),p=Math.log(g)/Math.log(256),b=Math.log(256)/Math.log(g);function R(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var K=0,re=0,he=0,le=T.length;he!==le&&T[he]===0;)he++,K++;for(var fe=(le-he)*b+1>>>0,pe=new Uint8Array(fe);he!==le;){for(var de=T[he],F=0,z=fe-1;(de!==0||F<re)&&z!==-1;z--,F++)de+=256*pe[z]>>>0,pe[z]=de%g>>>0,de=de/g>>>0;if(de!==0)throw new Error("Non-zero carry");re=F,he++}for(var W=fe-re;W!==fe&&pe[W]===0;)W++;for(var ve=_.repeat(K);W<fe;++W)ve+=a.charAt(pe[W]);return ve}function x(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var K=0;if(T[K]!==" "){for(var re=0,he=0;T[K]===_;)re++,K++;for(var le=(T.length-K)*p+1>>>0,fe=new Uint8Array(le);T[K];){var pe=r[T.charCodeAt(K)];if(pe===255)return;for(var de=0,F=le-1;(pe!==0||de<he)&&F!==-1;F--,de++)pe+=g*fe[F]>>>0,fe[F]=pe%256>>>0,pe=pe/256>>>0;if(pe!==0)throw new Error("Non-zero carry");he=de,K++}if(T[K]!==" "){for(var z=le-he;z!==le&&fe[z]===0;)z++;for(var W=new Uint8Array(re+(le-z)),ve=re;z!==le;)W[ve++]=fe[z++];return W}}}function j(T){var K=x(T);if(K)return K;throw new Error(`Non-${t} character`)}return{encode:R,decodeUnsafe:x,decode:j}}var rb=tb,ib=rb;const Af=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},nb=a=>new TextEncoder().encode(a),sb=a=>new TextDecoder().decode(a);class ob{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class ab{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Rf(this,t)}}class cb{constructor(t){this.decoders=t}or(t){return Rf(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Rf=(a,t)=>new cb({...a.decoders||{[a.prefix]:a},...t.decoders||{[t.prefix]:t}});class ub{constructor(t,r,n,s){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new ob(t,r,n),this.decoder=new ab(t,r,s)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Oo=({name:a,prefix:t,encode:r,decode:n})=>new ub(a,t,r,n),rs=({prefix:a,name:t,alphabet:r})=>{const{encode:n,decode:s}=ib(r,t);return Oo({prefix:a,name:t,encode:n,decode:c=>Af(s(c))})},hb=(a,t,r,n)=>{const s={};for(let b=0;b<t.length;++b)s[t[b]]=b;let c=a.length;for(;a[c-1]==="=";)--c;const f=new Uint8Array(c*r/8|0);let g=0,_=0,p=0;for(let b=0;b<c;++b){const R=s[a[b]];if(R===void 0)throw new SyntaxError(`Non-${n} character`);_=_<<r|R,g+=r,g>=8&&(g-=8,f[p++]=255&_>>g)}if(g>=r||255&_<<8-g)throw new SyntaxError("Unexpected end of data");return f},lb=(a,t,r)=>{const n=t[t.length-1]==="=",s=(1<<r)-1;let c="",f=0,g=0;for(let _=0;_<a.length;++_)for(g=g<<8|a[_],f+=8;f>r;)f-=r,c+=t[s&g>>f];if(f&&(c+=t[s&g<<r-f]),n)for(;c.length*r&7;)c+="=";return c},Bt=({name:a,prefix:t,bitsPerChar:r,alphabet:n})=>Oo({prefix:t,name:a,encode(s){return lb(s,n,r)},decode(s){return hb(s,n,r,a)}}),fb=Oo({prefix:"\0",name:"identity",encode:a=>sb(a),decode:a=>nb(a)});var pb=Object.freeze({__proto__:null,identity:fb});const db=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var gb=Object.freeze({__proto__:null,base2:db});const yb=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var vb=Object.freeze({__proto__:null,base8:yb});const mb=rs({prefix:"9",name:"base10",alphabet:"0123456789"});var _b=Object.freeze({__proto__:null,base10:mb});const wb=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bb=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Eb=Object.freeze({__proto__:null,base16:wb,base16upper:bb});const Ib=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xb=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Sb=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Pb=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ob=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ab=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Rb=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Cb=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Tb=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Nb=Object.freeze({__proto__:null,base32:Ib,base32upper:xb,base32pad:Sb,base32padupper:Pb,base32hex:Ob,base32hexupper:Ab,base32hexpad:Rb,base32hexpadupper:Cb,base32z:Tb});const Db=rs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jb=rs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var $b=Object.freeze({__proto__:null,base36:Db,base36upper:jb});const Fb=rs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Lb=rs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Mb=Object.freeze({__proto__:null,base58btc:Fb,base58flickr:Lb});const qb=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ub=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zb=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),kb=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Hb=Object.freeze({__proto__:null,base64:qb,base64pad:Ub,base64url:zb,base64urlpad:kb});const Cf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Bb=Cf.reduce((a,t,r)=>(a[r]=t,a),[]),Kb=Cf.reduce((a,t,r)=>(a[t.codePointAt(0)]=r,a),[]);function Vb(a){return a.reduce((t,r)=>(t+=Bb[r],t),"")}function Gb(a){const t=[];for(const r of a){const n=Kb[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const Wb=Oo({prefix:"🚀",name:"base256emoji",encode:Vb,decode:Gb});var Jb=Object.freeze({__proto__:null,base256emoji:Wb}),Qb=Tf,ml=128,Yb=127,Xb=~Yb,Zb=Math.pow(2,31);function Tf(a,t,r){t=t||[],r=r||0;for(var n=r;a>=Zb;)t[r++]=a&255|ml,a/=128;for(;a&Xb;)t[r++]=a&255|ml,a>>>=7;return t[r]=a|0,Tf.bytes=r-n+1,t}var eE=Ac,tE=128,_l=127;function Ac(a,n){var r=0,n=n||0,s=0,c=n,f,g=a.length;do{if(c>=g)throw Ac.bytes=0,new RangeError("Could not decode varint");f=a[c++],r+=s<28?(f&_l)<<s:(f&_l)*Math.pow(2,s),s+=7}while(f>=tE);return Ac.bytes=c-n,r}var rE=Math.pow(2,7),iE=Math.pow(2,14),nE=Math.pow(2,21),sE=Math.pow(2,28),oE=Math.pow(2,35),aE=Math.pow(2,42),cE=Math.pow(2,49),uE=Math.pow(2,56),hE=Math.pow(2,63),lE=function(a){return a<rE?1:a<iE?2:a<nE?3:a<sE?4:a<oE?5:a<aE?6:a<cE?7:a<uE?8:a<hE?9:10},fE={encode:Qb,decode:eE,encodingLength:lE},Nf=fE;const wl=(a,t,r=0)=>(Nf.encode(a,t,r),t),bl=a=>Nf.encodingLength(a),Rc=(a,t)=>{const r=t.byteLength,n=bl(a),s=n+bl(r),c=new Uint8Array(s+r);return wl(a,c,0),wl(r,c,n),c.set(t,s),new pE(a,r,t,c)};class pE{constructor(t,r,n,s){this.code=t,this.size=r,this.digest=n,this.bytes=s}}const Df=({name:a,code:t,encode:r})=>new dE(a,t,r);class dE{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Rc(this.code,r):r.then(n=>Rc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const jf=a=>async t=>new Uint8Array(await crypto.subtle.digest(a,t)),gE=Df({name:"sha2-256",code:18,encode:jf("SHA-256")}),yE=Df({name:"sha2-512",code:19,encode:jf("SHA-512")});var vE=Object.freeze({__proto__:null,sha256:gE,sha512:yE});const $f=0,mE="identity",Ff=Af,_E=a=>Rc($f,Ff(a)),wE={code:$f,name:mE,encode:Ff,digest:_E};var bE=Object.freeze({__proto__:null,identity:wE});new TextEncoder,new TextDecoder;const El={...pb,...gb,...vb,..._b,...Eb,...Nb,...$b,...Mb,...Hb,...Jb};({...vE,...bE});function Lf(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function EE(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Lf(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function Mf(a,t,r,n){return{name:a,prefix:t,encoder:{name:a,prefix:t,encode:r},decoder:{decode:n}}}const Il=Mf("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),ac=Mf("ascii","a",a=>{let t="a";for(let r=0;r<a.length;r++)t+=String.fromCharCode(a[r]);return t},a=>{a=a.substring(1);const t=EE(a.length);for(let r=0;r<a.length;r++)t[r]=a.charCodeAt(r);return t}),IE={utf8:Il,"utf-8":Il,hex:El.base16,latin1:ac,ascii:ac,binary:ac,...El};function xE(a,t="utf8"){const r=IE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Lf(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}const qf="wc",SE=2,zc="core",xi=`${qf}@2:${zc}:`,PE={name:zc,logger:"error"},OE={database:":memory:"},AE="crypto",xl="client_ed25519_seed",RE=ne.ONE_DAY,CE="keychain",TE="0.3",NE="messages",DE="0.3",jE=ne.SIX_HOURS,$E="publisher",Uf="irn",FE="error",zf="wss://relay.walletconnect.com",Sl="wss://relay.walletconnect.org",LE="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ME="_subscription",oi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},qE=ne.ONE_SECOND,UE="2.10.2",zE=1e4,kE="0.3",HE="WALLETCONNECT_CLIENT_ID",jr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},BE="subscription",KE="0.3",VE=ne.FIVE_SECONDS*1e3,GE="pairing",WE="0.3",zn={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Gn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},JE="history",QE="0.3",YE="expirer",Pr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},XE="0.3",cc="verify-api",mo="https://verify.walletconnect.com",Pl="https://verify.walletconnect.org";class ZE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=CE,this.version=TE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()},this.get=n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:c}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return s},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,of(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?af(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class eI{constructor(t,r,n){this.core=t,this.logger=r,this.name=AE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=hl(s);return _f(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=C0();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),f=hl(c),g=yc();return await hw(g,s,RE,f)},this.generateSharedKey=(s,c,f)=>{this.isInitialized();const g=this.getPrivateKey(s),_=T0(g,c);return this.setSymKey(_,f)},this.setSymKey=async(s,c)=>{this.isInitialized();const f=c||N0(s);return await this.keychain.set(f,s),f},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,f)=>{this.isInitialized();const g=D0(f),_=Hi(c);if(Kh(g)){const x=g.senderPublicKey,j=g.receiverPublicKey;s=await this.generateSharedKey(x,j)}const p=this.getSymKey(s),{type:b,senderPublicKey:R}=g;return j0({type:b,symKey:p,message:_,senderPublicKey:R})},this.decode=async(s,c,f)=>{this.isInitialized();const g=$0(c,f);if(Kh(g)){const _=g.receiverPublicKey,p=g.senderPublicKey;s=await this.generateSharedKey(_,p)}try{const _=this.getSymKey(s),p=F0({symKey:_,encoded:c});return ts(p)}catch(_){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(_)}},this.getPayloadType=s=>{const c=Vh(s);return L0(c.type)},this.getPayloadSenderPublicKey=s=>{const c=Vh(s);return c.senderPublicKey?Io(c.senderPublicKey,M0):void 0},this.core=t,this.logger=Ce.generateChildLogger(r,this.name),this.keychain=n||new ZE(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(xl)}catch{t=yc(),await this.keychain.set(xl,t)}return xE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class tI extends k1{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=NE,this.version=DE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,s)=>{this.isInitialized();const c=yn(s);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[c]<"u"||(f[c]=s,this.messages.set(n,f),await this.persist()),c},this.get=n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s},this.has=(n,s)=>{this.isInitialized();const c=this.get(n),f=yn(s);return typeof c[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(t,this.name),this.core=r}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,of(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?af(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class rI extends H1{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Or.EventEmitter,this.name=$E,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,s,c)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:c}});try{const g=(c==null?void 0:c.ttl)||jE,_=vc(c),p=(c==null?void 0:c.prompt)||!1,b=(c==null?void 0:c.tag)||0,R=(c==null?void 0:c.id)||Sf().toString(),x={topic:n,message:s,opts:{ttl:g,relay:_,prompt:p,tag:b,id:R}},j=setTimeout(()=>this.queue.set(R,x),this.publishTimeout);try{await await Qn(this.rpcPublish(n,s,g,_,p,b,R),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(R),this.relayer.events.emit(Gt.publish,x)}catch(T){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=c==null?void 0:c.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(R),T;return}finally{clearTimeout(j)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:c}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.relayer=t,this.logger=Ce.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(t,r,n,s,c,f,g){var _,p,b,R;const x={method:po(s.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:c,tag:f},id:g};return Ii((_=x.params)==null?void 0:_.prompt)&&((p=x.params)==null||delete p.prompt),Ii((b=x.params)==null?void 0:b.tag)&&((R=x.params)==null||delete R.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:x}),this.relayer.request(x)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:s}=t;await this.publish(r,n,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class iI{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const s=n.filter(c=>c!==r);if(!s.length){this.map.delete(t);return}this.map.set(t,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var nI=Object.defineProperty,sI=Object.defineProperties,oI=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,aI=Object.prototype.hasOwnProperty,cI=Object.prototype.propertyIsEnumerable,Al=(a,t,r)=>t in a?nI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,kn=(a,t)=>{for(var r in t||(t={}))aI.call(t,r)&&Al(a,r,t[r]);if(Ol)for(var r of Ol(t))cI.call(t,r)&&Al(a,r,t[r]);return a},uc=(a,t)=>sI(a,oI(t));class uI extends V1{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new iI,this.events=new Or.EventEmitter,this.name=BE,this.version=KE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const c=vc(s),f={topic:n,relay:c};this.pending.set(n,f);const g=await this.rpcSubscribe(n,c);return this.onSubscribe(g,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}}),g}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((s,c)=>{const f=new ne.Watch;f.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),s(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=VE&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ce.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async s=>await this.unsubscribeById(t,s,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const s=vc(n);await this.rpcUnsubscribe(t,r,s);const c=tr("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(t,r){const n={method:po(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Qn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return yn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:po(r.protocol).batchSubscribe,params:{topics:t.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Qn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(t,r,n){const s={method:po(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(t,r){this.setSubscription(t,uc(kn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,kn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,kn({},r)),this.topicMap.set(r.topic,t),this.events.emit(jr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(jr.deleted,uc(kn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(jr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(jr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);mn(r)&&this.onBatchSubscribe(r.map((n,s)=>uc(kn({},t[s]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(jr.created,async t=>{const r=jr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(jr.deleted,async t=>{const r=jr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var hI=Object.defineProperty,Rl=Object.getOwnPropertySymbols,lI=Object.prototype.hasOwnProperty,fI=Object.prototype.propertyIsEnumerable,Cl=(a,t,r)=>t in a?hI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,pI=(a,t)=>{for(var r in t||(t={}))lI.call(t,r)&&Cl(a,r,t[r]);if(Rl)for(var r of Rl(t))fI.call(t,r)&&Cl(a,r,t[r]);return a};class dI extends B1{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Or.EventEmitter,this.name=LE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Gt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(oi.payload,this.onPayloadHandler),this.provider.on(oi.connect,this.onConnectHandler),this.provider.on(oi.disconnect,this.onDisconnectHandler),this.provider.on(oi.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ce.generateChildLogger(t.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:t.logger||FE})),this.messages=new tI(this.logger,t.core),this.subscriber=new uI(this,this.logger),this.publisher=new rI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||zf,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Sl}...`),await this.restartTransport(Sl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},zE)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let s=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(s)return s;let c;const f=g=>{g.topic===t&&(this.subscriber.off(jr.created,f),c())};return await Promise.all([new Promise(g=>{c=g,this.subscriber.on(jr.created,f)}),new Promise(async g=>{s=await this.subscriber.subscribe(t,r),g()})]),s}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Qn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(jr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Qn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(s){n(s);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(oi.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Gh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ui(new Xw(q0({sdkVersion:UE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const s=this.messages.has(r,n);return s&&this.logger.debug(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Uc(t)){if(!t.method.endsWith(ME))return;const r=t.params,{topic:n,message:s,publishedAt:c}=r.data,f={topic:n,message:s,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pI({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else Po(t)&&this.events.emit(Gt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Gt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=qc(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(oi.payload,this.onPayloadHandler),this.provider.off(oi.connect,this.onConnectHandler),this.provider.off(oi.disconnect,this.onDisconnectHandler),this.provider.off(oi.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Gh();U0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ne.toMiliseconds(qE)))}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var gI=Object.defineProperty,Tl=Object.getOwnPropertySymbols,yI=Object.prototype.hasOwnProperty,vI=Object.prototype.propertyIsEnumerable,Nl=(a,t,r)=>t in a?gI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Dl=(a,t)=>{for(var r in t||(t={}))yI.call(t,r)&&Nl(a,r,t[r]);if(Tl)for(var r of Tl(t))vI.call(t,r)&&Nl(a,r,t[r]);return a};class Ao extends K1{constructor(t,r,n,s=xi,c=void 0){super(t,r,n,s),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=kE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!Ii(f)?this.map.set(this.getKey(f),f):A0(f)?this.map.set(f.id,f):R0(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,g)=>{this.isInitialized(),this.map.has(f)?await this.update(f,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:g}),this.map.set(f,g),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(g=>Object.keys(f).every(_=>eb(g[_],f[_]))):this.values),this.update=async(f,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:g});const _=Dl(Dl({},this.getData(f)),g);this.map.set(f,_),await this.persist()},this.delete=async(f,g)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:g}),this.map.delete(f),await this.persist())},this.logger=Ce.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class mI{constructor(t,r){this.core=t,this.logger=r,this.name=GE,this.version=WE,this.events=new $c,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[rf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=yc(),s=await this.core.crypto.setSymKey(n),c=$r(ne.FIVE_MINUTES),f={protocol:Uf},g={topic:s,expiry:c,relay:f,active:!1},_=z0({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:f});return await this.pairings.set(s,g),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:_}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:s,symKey:c,relay:f}=k0(n.uri);let g;if(this.pairings.keys.includes(s)&&(g=this.pairings.get(s),g.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(s)||(await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:f}));const _=$r(ne.FIVE_MINUTES),p={topic:s,relay:f,expiry:_,active:!1};return await this.pairings.set(s,p),this.core.expirer.set(s,_),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Gn.create,p),p},this.activate=async({topic:n})=>{this.isInitialized();const s=$r(ne.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:s}),this.core.expirer.set(n,s)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:s}=n;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:f,resolve:g,reject:_}=dn();this.events.once(Dt("pairing_ping",c),({error:p})=>{p?_(p):g()}),await f()}},this.updateExpiry=async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})},this.updateMetadata=async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",tr("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(n,s,c)=>{const f=vn(s,c),g=await this.core.crypto.encode(n,f),_=zn[s].req;return this.core.history.set(n,f),this.core.relayer.publish(n,g,_),f.id},this.sendResult=async(n,s,c)=>{const f=qc(n,c),g=await this.core.crypto.encode(s,f),_=await this.core.history.get(s,n),p=zn[_.request.method].res;await this.core.relayer.publish(s,g,p),await this.core.history.resolve(f)},this.sendError=async(n,s,c)=>{const f=So(n,c),g=await this.core.crypto.encode(s,f),_=await this.core.history.get(s,n),p=zn[_.request.method]?zn[_.request.method].res:zn.unregistered_method.res;await this.core.relayer.publish(s,g,p),await this.core.history.resolve(f)},this.deletePairing=async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,tr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(s=>Ei(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=n=>{const{topic:s,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async n=>{const{topic:s,payload:c}=n,f=(await this.core.history.get(s,c.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,s)=>{const{id:c}=s;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Gn.ping,{id:c,topic:n})}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,s)=>{const{id:c}=s;setTimeout(()=>{ci(s)?this.events.emit(Dt("pairing_ping",c),{}):Fr(s)&&this.events.emit(Dt("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(n,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Gn.delete,{id:c,topic:n})}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,s)=>{const{id:c,method:f}=s;try{if(this.registeredMethods.includes(f))return;const g=tr("WC_METHOD_UNSUPPORTED",f);await this.sendError(c,n,g),this.logger.error(g)}catch(g){await this.sendError(c,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(tr("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!hr(n)){const{message:s}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(s)}if(!H0(n.uri)){const{message:s}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(s)}},this.isValidPing=async n=>{if(!hr(n)){const{message:c}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:s}=n;await this.isValidPairingTopic(s)},this.isValidDisconnect=async n=>{if(!hr(n)){const{message:c}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:s}=n;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async n=>{if(!gn(n,!1)){const{message:s}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(Ei(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}},this.core=t,this.logger=Ce.generateChildLogger(r,this.name),this.pairings=new Ao(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const s=await this.core.crypto.decode(r,n);try{Uc(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Po(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Pr.expired,async t=>{const{topic:r}=nf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Gn.expire,{topic:r}))})}}class _I extends z1{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Or.EventEmitter,this.name=JE,this.version=QE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:c}),this.records.has(s.id))return;const f={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:c,expiry:$r(ne.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Kr.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=Fr(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.events.emit(Kr.updated,s))},this.get=async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s)),this.delete=(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===n){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(Kr.deleted,c)}})},this.exists=async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1),this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:vn(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Kr.created,t=>{const r=Kr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.updated,t=>{const r=Kr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.deleted,t=>{const r=Kr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ne.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class wI extends G1{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Or.EventEmitter,this.name=YE,this.version=XE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(n,s)=>{this.isInitialized();const c=this.formatTarget(n),f={target:c,expiry:s};this.expirations.set(c,f),this.checkExpiry(c,f),this.events.emit(Pr.created,{target:c,expiration:f})},this.get=n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)},this.del=n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Pr.deleted,{target:s,expiration:c})}},this.on=(n,s)=>{this.events.on(n,s)},this.once=(n,s)=>{this.events.once(n,s)},this.off=(n,s)=>{this.events.off(n,s)},this.removeListener=(n,s)=>{this.events.removeListener(n,s)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return B0(t);if(typeof t=="number")return K0(t);const{message:r}=Z("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Pr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;ne.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Pr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Pr.created,t=>{const r=Pr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.expired,t=>{const r=Pr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.deleted,t=>{const r=Pr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class bI extends W1{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=cc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||V0()||!sf())return;const n=mo;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Pl;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const s=(n==null?void 0:n.verifyUrl)||mo;let c;try{c=await this.fetchAttestation(n.attestationId,s)}catch(f){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${s}`),this.logger.info(f),c=await this.fetchAttestation(n.attestationId,Pl)}return c},this.fetchAttestation=async(n,s)=>{this.logger.info(`resolving attestation: ${n} from url: ${s}`);const c=this.startAbortTimer(ne.ONE_SECOND*2),f=await fetch(`${s}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),f.status===200?await f.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const s=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",s),n())};await Promise.race([new Promise(c=>{if(document.getElementById(cc))return c();window.addEventListener("message",s);const f=document.createElement("iframe");f.id=cc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=c}),new Promise((c,f)=>setTimeout(()=>{window.removeEventListener("message",s),f("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ce.generateChildLogger(r,this.name),this.verifyUrl=mo,this.abortController=new AbortController,this.isDevEnv=G0()&&{NVM_INC:"/Users/jacky/.nvm/versions/node/v18.16.0/include/node",AUTOJUMP_ERROR_PATH:"/Users/jacky/Library/autojump/errors.log",TERM_PROGRAM:"vscode",NODE:"/Users/jacky/.nvm/versions/node/v18.16.0/bin/node",INIT_CWD:"/Users/jacky/test/paytoview/miniapp",ANDROID_HOME:"/Users/jacky/Library/Android/sdk",NVM_CD_FLAGS:"-q",AUTOJUMP_SOURCED:"1",TERM:"xterm-256color",SHELL:"/bin/zsh",HOMEBREW_BOTTLE_DOMAIN:"https://mirrors.aliyun.com/homebrew/homebrew-bottles",npm_config_metrics_registry:"https://registry.npmjs.org/",TMPDIR:"/var/folders/yy/nlvh8n1n1_l293h6ybr1ksqm0000gn/T/",npm_config_global_prefix:"/Users/jacky/.nvm/versions/node/v18.16.0",GRADLE_HOME:"/Users/jacky/.sdkman/candidates/gradle/current",TERM_PROGRAM_VERSION:"1.84.2",ZDOTDIR:"/Users/jacky",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",SDKMAN_PLATFORM:"darwinx64",npm_config_local_prefix:"/Users/jacky/test/paytoview/miniapp",LC_ALL:"zh_CN.UTF-8",ZSH:"/Users/jacky/.oh-my-zsh",COCOS_CONSOLE_ROOT:"/Users/jacky/cocos2d-x/tools/cocos2d-console/bin",NVM_DIR:"/Users/jacky/.nvm",USER:"jacky",COCOS_TEMPLATES_ROOT:"/Users/jacky/cocos2d-x/templates",LS_COLORS:"di=1;36:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/Users/jacky/.nvm/versions/node/v18.16.0/etc/npmrc",SDKMAN_CANDIDATES_API:"https://api.sdkman.io/2",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.GtyzRDEJjq/Listeners",__CF_USER_TEXT_ENCODING:"0x1F5:0x19:0x34",npm_execpath:"/Users/jacky/.nvm/versions/node/v18.16.0/lib/node_modules/npm/bin/npm-cli.js",PAGER:"less",LSCOLORS:"Gxfxcxdxbxegedabagacad",MAVEN_HOME:"/Users/jacky/.sdkman/candidates/maven/current",PATH:"/Users/jacky/test/paytoview/miniapp/node_modules/.bin:/Users/jacky/test/paytoview/node_modules/.bin:/Users/jacky/test/node_modules/.bin:/Users/jacky/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/jacky/.nvm/versions/node/v18.16.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/jacky/go/bin:/Users/jacky/cocos2d-x/templates:/Users/jacky:/Users/jacky/cocos2d-x/tools/cocos2d-console/bin:/Users/jacky/.nvm/versions/node/v18.16.0/bin:/opt/local/bin:/opt/local/sbin:/Library/Frameworks/Python.framework/Versions/3.8/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/Users/jacky/Library/Python/2.7/bin:/Library/Frameworks/Mono.framework/Versions/Current/Commands:/Users/jacky/go/bin:/Users/jacky/cocos2d-x/templates:/Users/jacky:/Users/jacky/cocos2d-x/tools/cocos2d-console/bin:/Users/jacky/.sdkman/candidates/maven/current/bin:/Users/jacky/.sdkman/candidates/java/current/bin:/Users/jacky/.sdkman/candidates/gradle/current/bin:/Users/jacky/.nvm/versions/node/v18.16.0/bin:/opt/local/bin:/opt/local/sbin:/Library/Frameworks/Python.framework/Versions/3.8/bin:/Users/jacky/.cargo/bin:/usr/local/opt/fzf/bin:/Users/jacky/Library/Android/sdk/ndk/23.1.7779620:/Users/jacky/Library/Android/sdk/emulator:/Users/jacky/Library/Android/sdk/platform-tools:/usr/local/mysql/bin/:/Users/jacky/Library/Android/sdk/tools:/Users/jacky/Library/Android/sdk/platform-tools:/Users/jacky/go/bin:/Users/jacky/Library/Android/sdk/ndk/23.1.7779620:/Users/jacky/Library/Android/sdk/emulator:/Users/jacky/Library/Android/sdk/platform-tools",npm_package_json:"/Users/jacky/test/paytoview/miniapp/package.json",LaunchInstanceID:"CFC81AF8-6420-4F03-9BD9-A78D22B0A356",npm_config_userconfig:"/Users/jacky/.npmrc",npm_config_init_module:"/Users/jacky/.npm-init.js",USER_ZDOTDIR:"/Users/jacky",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run-script",PWD:"/Users/jacky/test/paytoview/miniapp",JAVA_HOME:"/Users/jacky/.sdkman/candidates/java/current/bin/java",npm_lifecycle_event:"build",EDITOR:"mvim",npm_package_name:"miniapp",LANG:"zh_CN.UTF-8",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"--ms-enable-electron-run-as-node",XPC_FLAGS:"0x0",COCOS_X_ROOT:"/Users/jacky",npm_config_node_gyp:"/Users/jacky/.nvm/versions/node/v18.16.0/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"0.0.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/jacky",VSCODE_GIT_ASKPASS_MAIN:"/Applications/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",GOROOT:"/Users/jacky/.go",npm_config_cache:"/Users/jacky/.npm",LESS:"-R",LOGNAME:"jacky",npm_lifecycle_script:"tsc && vite build",SDKMAN_DIR:"/Users/jacky/.sdkman",VSCODE_GIT_IPC_HANDLE:"/var/folders/yy/nlvh8n1n1_l293h6ybr1ksqm0000gn/T/vscode-git-65f50b7c40.sock",GOPATH:"/Users/jacky/go",NVM_BIN:"/Users/jacky/.nvm/versions/node/v18.16.0/bin",npm_config_user_agent:"npm/9.5.1 node/v18.16.0 darwin x64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/Applications/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/Applications/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",ANDROID_NDK_HOME:"/Users/jacky/Library/Android/sdk/ndk/23.1.7779620",SDKMAN_CANDIDATES_DIR:"/Users/jacky/.sdkman/candidates",SECURITYSESSIONID:"186a7",npm_node_execpath:"/Users/jacky/.nvm/versions/node/v18.16.0/bin/node",npm_config_prefix:"/Users/jacky/.nvm/versions/node/v18.16.0",COLORTERM:"truecolor",_:"/Users/jacky/test/paytoview/miniapp/node_modules/.bin/vite",NODE_ENV:"production"}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(t))}}var EI=Object.defineProperty,jl=Object.getOwnPropertySymbols,II=Object.prototype.hasOwnProperty,xI=Object.prototype.propertyIsEnumerable,$l=(a,t,r)=>t in a?EI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Fl=(a,t)=>{for(var r in t||(t={}))II.call(t,r)&&$l(a,r,t[r]);if(jl)for(var r of jl(t))xI.call(t,r)&&$l(a,r,t[r]);return a};class kc extends U1{constructor(t){super(t),this.protocol=qf,this.version=SE,this.name=zc,this.events=new Or.EventEmitter,this.initialized=!1,this.on=(n,s)=>this.events.on(n,s),this.once=(n,s)=>this.events.once(n,s),this.off=(n,s)=>this.events.off(n,s),this.removeListener=(n,s)=>this.events.removeListener(n,s),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||zf,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||PE.logger}));this.logger=Ce.generateChildLogger(r,this.name),this.heartbeat=new _n.HeartBeat,this.crypto=new eI(this,this.logger,t==null?void 0:t.keychain),this.history=new _I(this,this.logger),this.expirer=new wI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new B_(Fl(Fl({},OE),t==null?void 0:t.storageOptions)),this.relayer=new dI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new mI(this,this.logger),this.verify=new bI(this.projectId||"",this.logger)}static async init(t){const r=new kc(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(HE,n),r}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const SI=kc,kf="wc",Hf=2,Bf="client",Hc=`${kf}@${Hf}:${Bf}:`,hc={name:Bf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Ll="WALLETCONNECT_DEEPLINK_CHOICE",PI="proposal",Kf="Proposal expired",OI="session",ho=ne.SEVEN_DAYS,AI="engine",Hn={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},lc={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},ai={idle:"IDLE",active:"ACTIVE"},RI="request",CI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var TI=Object.defineProperty,NI=Object.defineProperties,DI=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,jI=Object.prototype.hasOwnProperty,$I=Object.prototype.propertyIsEnumerable,ql=(a,t,r)=>t in a?TI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,cr=(a,t)=>{for(var r in t||(t={}))jI.call(t,r)&&ql(a,r,t[r]);if(Ml)for(var r of Ml(t))$I.call(t,r)&&ql(a,r,t[r]);return a},Bn=(a,t)=>NI(a,DI(t));class FI extends Q1{constructor(t){super(t),this.name=AI,this.events=new $c,this.initialized=!1,this.ignoredPayloadTypes=[rf],this.requestQueue={state:ai.idle,queue:[]},this.sessionRequestQueue={state:ai.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Hn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Bn(cr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:s,requiredNamespaces:c,optionalNamespaces:f,sessionProperties:g,relays:_}=n;let p=s,b,R=!1;if(p&&(R=this.client.core.pairing.pairings.get(p).active),!p||!R){const{topic:fe,uri:pe}=await this.client.core.pairing.create();p=fe,b=pe}const x=await this.client.core.crypto.generateKeyPair(),j=cr({requiredNamespaces:c,optionalNamespaces:f,relays:_??[{protocol:Uf}],proposer:{publicKey:x,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:T,resolve:K,done:re}=dn(ne.FIVE_MINUTES,Kf);if(this.events.once(Dt("session_connect"),async({error:fe,session:pe})=>{if(fe)T(fe);else if(pe){pe.self.publicKey=x;const de=Bn(cr({},pe),{requiredNamespaces:pe.requiredNamespaces,optionalNamespaces:pe.optionalNamespaces});await this.client.session.set(pe.topic,de),await this.setExpiry(pe.topic,pe.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:pe.peer.metadata}),K(de)}}),!p){const{message:fe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(fe)}const he=await this.sendRequest({topic:p,method:"wc_sessionPropose",params:j}),le=$r(ne.FIVE_MINUTES);return await this.setProposal(he,cr({id:he,expiry:le},j)),{uri:b,approval:re}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:s,namespaces:c,sessionProperties:f}=r,g=this.client.proposal.get(n);let{pairingTopic:_,proposer:p,requiredNamespaces:b,optionalNamespaces:R}=g;_=_||"",go(b)||(b=J0(c,"approve()"));const x=await this.client.core.crypto.generateKeyPair(),j=p.publicKey,T=await this.client.core.crypto.generateSharedKey(x,j);_&&n&&(await this.client.core.pairing.updateMetadata({topic:_,metadata:p.metadata}),await this.sendResult({id:n,topic:_,result:{relay:{protocol:s??"irn"},responderPublicKey:x}}),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}));const K=cr({relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:b,optionalNamespaces:R,pairingTopic:_,controller:{publicKey:x,metadata:this.client.metadata},expiry:$r(ho)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(T),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const re=Bn(cr({},K),{topic:T,pairingTopic:_,acknowledged:!1,self:K.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:x});return await this.client.session.set(T,re),await this.setExpiry(T,$r(ho)),{topic:T,acknowledged:()=>new Promise(he=>setTimeout(()=>he(this.client.session.get(T)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:s}=r,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,s),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:s}=r,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s}}),{done:f,resolve:g,reject:_}=dn();return this.events.once(Dt("session_update",c),({error:p})=>{p?_(p):g()}),await this.client.session.update(n,{namespaces:s}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,s=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:f,reject:g}=dn();return this.events.once(Dt("session_extend",s),({error:_})=>{_?g(_):f()}),await this.setExpiry(n,$r(ho)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:s,topic:c,expiry:f}=r,g=Mc(),{done:_,resolve:p,reject:b}=dn(f,"Request expired. Please try again.");return this.events.once(Dt("session_request",g),({error:R,result:x})=>{R?b(R):p(x)}),await Promise.all([new Promise(async R=>{await this.sendRequest({clientRpcId:g,topic:c,method:"wc_sessionRequest",params:{request:s,chainId:n},expiry:f,throwOnFailedPublish:!0}).catch(x=>b(x)),this.client.events.emit("session_request_sent",{topic:c,request:s,chainId:n,id:g}),R()}),new Promise(async R=>{const x=await this.client.core.storage.getItem(Ll);Q0({id:g,topic:c,wcDeepLink:x}),R()}),_()]).then(R=>R[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:s}=r,{id:c}=s;ci(s)?await this.sendResult({id:c,topic:n,result:s.result,throwOnFailedPublish:!0}):Fr(s)&&await this.sendError(c,n,s.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const s=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:f,reject:g}=dn();this.events.once(Dt("session_ping",s),({error:_})=>{_?g(_):f()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:s,chainId:c}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:tr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>Y0(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(c=>{var f,g;return((f=c.peerMetadata)==null?void 0:f.url)&&((g=c.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,tr("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Ll).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,tr("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),s?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),s&&(this.sessionRequestQueue.state=ai.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Hn.wc_sessionRequest.req.ttl,{id:s,topic:c,params:f,verifyContext:g}=r;await this.client.pendingRequest.set(s,{id:s,topic:c,params:f,verifyContext:g}),n&&this.client.core.expirer.set(s,$r(n))},this.sendRequest=async r=>{const{topic:n,method:s,params:c,expiry:f,relayRpcId:g,clientRpcId:_,throwOnFailedPublish:p}=r,b=vn(s,c,_);if(sf()&&CI.includes(s)){const j=yn(JSON.stringify(b));this.client.core.verify.register({attestationId:j})}const R=await this.client.core.crypto.encode(n,b),x=Hn[s].req;return f&&(x.ttl=f),g&&(x.id=g),this.client.core.history.set(n,b),p?(x.internal=Bn(cr({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,R,x)):this.client.core.relayer.publish(n,R,x).catch(j=>this.client.logger.error(j)),b.id},this.sendResult=async r=>{const{id:n,topic:s,result:c,throwOnFailedPublish:f}=r,g=qc(n,c),_=await this.client.core.crypto.encode(s,g),p=await this.client.core.history.get(s,n),b=Hn[p.request.method].res;f?(b.internal=Bn(cr({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,_,b)):this.client.core.relayer.publish(s,_,b).catch(R=>this.client.logger.error(R)),await this.client.core.history.resolve(g)},this.sendError=async(r,n,s)=>{const c=So(r,s),f=await this.client.core.crypto.encode(n,c),g=await this.client.core.history.get(n,r),_=Hn[g.request.method].res;this.client.core.relayer.publish(n,f,_),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(s=>{Ei(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ei(s.expiry)&&n.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...n.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ai.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ai.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ai.idle},this.processRequest=r=>{const{topic:n,payload:s}=r,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,s);case"wc_sessionSettle":return this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return this.onSessionExtendRequest(n,s);case"wc_sessionPing":return this.onSessionPingRequest(n,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return this.onSessionRequest(n,s);case"wc_sessionEvent":return this.onSessionEventRequest(n,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:s}=r,c=(await this.client.core.history.get(n,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:s}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(r,n)=>{const{params:s,id:c}=n;try{this.isValidConnect(cr({},n.params));const f=$r(ne.FIVE_MINUTES),g=cr({id:c,pairingTopic:r,expiry:f},s);await this.setProposal(c,g);const _=yn(JSON.stringify(n)),p=await this.getVerifyContext(_,g.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:g,verifyContext:p})}catch(f){await this.sendError(c,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,n)=>{const{id:s}=n;if(ci(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const f=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const _=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const p=await this.client.core.crypto.generateSharedKey(g,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:p});const b=await this.client.core.relayer.subscribe(p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:r})}else Fr(n)&&(await this.client.proposal.delete(s,tr("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:s,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:f,controller:g,expiry:_,namespaces:p,requiredNamespaces:b,optionalNamespaces:R,sessionProperties:x,pairingTopic:j}=n.params,T=cr({topic:r,relay:f,expiry:_,namespaces:p,acknowledged:!0,pairingTopic:j,requiredNamespaces:b,optionalNamespaces:R,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},x&&{sessionProperties:x});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Dt("session_connect"),{session:T}),this.cleanupDuplicatePairings(T)}catch(f){await this.sendError(s,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,n)=>{const{id:s}=n;ci(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Dt("session_approve",s),{})):Fr(n)&&(await this.client.session.delete(r,tr("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",s),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:s,id:c}=n;try{const f=`${r}_session_update`,g=ao.get(f);if(g&&this.isRequestOutOfSync(g,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(cr({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:s}),ao.set(f,c)}catch(f){await this.sendError(c,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:s}=n;ci(n)?this.events.emit(Dt("session_update",s),{}):Fr(n)&&this.events.emit(Dt("session_update",s),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:s}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,$r(ho)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,n)=>{const{id:s}=n;ci(n)?this.events.emit(Dt("session_extend",s),{}):Fr(n)&&this.events.emit(Dt("session_extend",s),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,n)=>{const{id:s}=n;setTimeout(()=>{ci(n)?this.events.emit(Dt("session_ping",s),{}):Fr(n)&&this.events.emit(Dt("session_ping",s),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Gt.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:s,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:s,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,n)=>{const{id:s,params:c}=n;try{this.isValidRequest(cr({topic:r},c));const f=yn(JSON.stringify(vn("wc_sessionRequest",c,s))),g=this.client.session.get(r),_=await this.getVerifyContext(f,g.peer.metadata),p={id:s,topic:r,params:c,verifyContext:_};await this.setPendingSessionRequest(p),this.addSessionRequestToSessionRequestQueue(p),this.processSessionRequestQueue()}catch(f){await this.sendError(s,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,n)=>{const{id:s}=n;ci(n)?this.events.emit(Dt("session_request",s),{result:n.result}):Fr(n)&&this.events.emit(Dt("session_request",s),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:s,params:c}=n;try{const f=`${r}_session_event_${c.event.name}`,g=ao.get(f);if(g&&this.isRequestOutOfSync(g,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(cr({topic:r},c)),this.client.events.emit("session_event",{id:s,topic:r,params:c}),ao.set(f,s)}catch(f){await this.sendError(s,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ai.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ai.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ai.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,vn("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async r=>{if(!hr(r)){const{message:_}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(_)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:c,sessionProperties:f,relays:g}=r;if(Ii(n)||await this.isValidPairingTopic(n),!X0(g,!0)){const{message:_}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(_)}!Ii(s)&&go(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!Ii(c)&&go(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),Ii(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,n)=>{const s=Z0(r,"connect()",n);if(s)throw new Error(s.message)},this.isValidApprove=async r=>{if(!hr(r))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:s,relayProtocol:c,sessionProperties:f}=r;await this.isValidProposalId(n);const g=this.client.proposal.get(n),_=Za(s,"approve()");if(_)throw new Error(_.message);const p=Wh(g.requiredNamespaces,s,"approve()");if(p)throw new Error(p.message);if(!gn(c,!0)){const{message:b}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(b)}Ii(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!hr(r)){const{message:c}=Z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:n,reason:s}=r;if(await this.isValidProposalId(n),!e_(s)){const{message:c}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!hr(r)){const{message:p}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(p)}const{relay:n,controller:s,namespaces:c,expiry:f}=r;if(!t_(n)){const{message:p}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(p)}const g=r_(s,"onSessionSettleRequest()");if(g)throw new Error(g.message);const _=Za(c,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(Ei(f)){const{message:p}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(p)}},this.isValidUpdate=async r=>{if(!hr(r)){const{message:_}=Z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(_)}const{topic:n,namespaces:s}=r;await this.isValidSessionTopic(n);const c=this.client.session.get(n),f=Za(s,"update()");if(f)throw new Error(f.message);const g=Wh(c.requiredNamespaces,s,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!hr(r)){const{message:s}=Z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!hr(r)){const{message:_}=Z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(_)}const{topic:n,request:s,chainId:c,expiry:f}=r;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!Jh(g,c)){const{message:_}=Z("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(_)}if(!i_(s)){const{message:_}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(_)}if(!n_(g,c,s.method)){const{message:_}=Z("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(_)}if(f&&!s_(f,lc)){const{message:_}=Z("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${lc.min} and ${lc.max}`);throw new Error(_)}},this.isValidRespond=async r=>{if(!hr(r)){const{message:c}=Z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:n,response:s}=r;if(await this.isValidSessionTopic(n),!o_(s)){const{message:c}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!hr(r)){const{message:s}=Z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!hr(r)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:n,event:s,chainId:c}=r;await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!Jh(f,c)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(g)}if(!a_(s)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(g)}if(!c_(f,c,s.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!hr(r)){const{message:s}=Z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const s={verified:{verifyUrl:n.verifyUrl||mo,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});c&&(s.verified.origin=c.origin,s.verified.isScam=c.isScam,s.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(s=>{if(!gn(s,!1)){const{message:c}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const s=await this.client.core.crypto.decode(r,n);try{Uc(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Po(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.client.core.history.delete(r,s.id)):this.onRelayEventUnknownPayload({topic:r,payload:s})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Pr.expired,async t=>{const{topic:r,id:n}=nf(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Gn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!gn(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=Z("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!gn(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=Z("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(gn(t,!1)){const{message:r}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!u_(t)){const{message:r}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Ei(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=Z("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class LI extends Ao{constructor(t,r){super(t,r,PI,Hc),this.core=t,this.logger=r}}class MI extends Ao{constructor(t,r){super(t,r,OI,Hc),this.core=t,this.logger=r}}class qI extends Ao{constructor(t,r){super(t,r,RI,Hc,n=>n.id),this.core=t,this.logger=r}}let UI=class Vf extends J1{constructor(t){super(t),this.protocol=kf,this.version=Hf,this.name=hc.name,this.events=new Or.EventEmitter,this.on=(n,s)=>this.events.on(n,s),this.once=(n,s)=>this.events.once(n,s),this.off=(n,s)=>this.events.off(n,s),this.removeListener=(n,s)=>this.events.removeListener(n,s),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}},this.update=async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}},this.request=async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}},this.find=n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||hc.name,this.metadata=(t==null?void 0:t.metadata)||W0();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||hc.logger}));this.core=(t==null?void 0:t.core)||new SI(t),this.logger=Ce.generateChildLogger(r,this.name),this.session=new MI(this.core,this.logger),this.proposal=new LI(this.core,this.logger),this.pendingRequest=new qI(this.core,this.logger),this.engine=new FI(this)}static async init(t){const r=new Vf(t);return await r.initialize(),r}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var Cc={exports:{}};(function(a,t){var r=typeof self<"u"?self:Lr,n=function(){function c(){this.fetch=!1,this.DOMException=r.DOMException}return c.prototype=r,new c}();(function(c){(function(f){var g={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function _(m){return m&&DataView.prototype.isPrototypeOf(m)}if(g.arrayBuffer)var p=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=ArrayBuffer.isView||function(m){return m&&p.indexOf(Object.prototype.toString.call(m))>-1};function R(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(m))throw new TypeError("Invalid character in header field name");return m.toLowerCase()}function x(m){return typeof m!="string"&&(m=String(m)),m}function j(m){var S={next:function(){var Y=m.shift();return{done:Y===void 0,value:Y}}};return g.iterable&&(S[Symbol.iterator]=function(){return S}),S}function T(m){this.map={},m instanceof T?m.forEach(function(S,Y){this.append(Y,S)},this):Array.isArray(m)?m.forEach(function(S){this.append(S[0],S[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(S){this.append(S,m[S])},this)}T.prototype.append=function(m,S){m=R(m),S=x(S);var Y=this.map[m];this.map[m]=Y?Y+", "+S:S},T.prototype.delete=function(m){delete this.map[R(m)]},T.prototype.get=function(m){return m=R(m),this.has(m)?this.map[m]:null},T.prototype.has=function(m){return this.map.hasOwnProperty(R(m))},T.prototype.set=function(m,S){this.map[R(m)]=x(S)},T.prototype.forEach=function(m,S){for(var Y in this.map)this.map.hasOwnProperty(Y)&&m.call(S,this.map[Y],Y,this)},T.prototype.keys=function(){var m=[];return this.forEach(function(S,Y){m.push(Y)}),j(m)},T.prototype.values=function(){var m=[];return this.forEach(function(S){m.push(S)}),j(m)},T.prototype.entries=function(){var m=[];return this.forEach(function(S,Y){m.push([Y,S])}),j(m)},g.iterable&&(T.prototype[Symbol.iterator]=T.prototype.entries);function K(m){if(m.bodyUsed)return Promise.reject(new TypeError("Already read"));m.bodyUsed=!0}function re(m){return new Promise(function(S,Y){m.onload=function(){S(m.result)},m.onerror=function(){Y(m.error)}})}function he(m){var S=new FileReader,Y=re(S);return S.readAsArrayBuffer(m),Y}function le(m){var S=new FileReader,Y=re(S);return S.readAsText(m),Y}function fe(m){for(var S=new Uint8Array(m),Y=new Array(S.length),ce=0;ce<S.length;ce++)Y[ce]=String.fromCharCode(S[ce]);return Y.join("")}function pe(m){if(m.slice)return m.slice(0);var S=new Uint8Array(m.byteLength);return S.set(new Uint8Array(m)),S.buffer}function de(){return this.bodyUsed=!1,this._initBody=function(m){this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:g.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:g.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():g.arrayBuffer&&g.blob&&_(m)?(this._bodyArrayBuffer=pe(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||b(m))?this._bodyArrayBuffer=pe(m):this._bodyText=m=Object.prototype.toString.call(m):this._bodyText="",this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var m=K(this);if(m)return m;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?K(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(he)}),this.text=function(){var m=K(this);if(m)return m;if(this._bodyBlob)return le(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(fe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(ve)}),this.json=function(){return this.text().then(JSON.parse)},this}var F=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function z(m){var S=m.toUpperCase();return F.indexOf(S)>-1?S:m}function W(m,S){S=S||{};var Y=S.body;if(m instanceof W){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,S.headers||(this.headers=new T(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!Y&&m._bodyInit!=null&&(Y=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=S.credentials||this.credentials||"same-origin",(S.headers||!this.headers)&&(this.headers=new T(S.headers)),this.method=z(S.method||this.method||"GET"),this.mode=S.mode||this.mode||null,this.signal=S.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Y)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Y)}W.prototype.clone=function(){return new W(this,{body:this._bodyInit})};function ve(m){var S=new FormData;return m.trim().split("&").forEach(function(Y){if(Y){var ce=Y.split("="),V=ce.shift().replace(/\+/g," "),k=ce.join("=").replace(/\+/g," ");S.append(decodeURIComponent(V),decodeURIComponent(k))}}),S}function ie(m){var S=new T,Y=m.replace(/\r?\n[\t ]+/g," ");return Y.split(/\r?\n/).forEach(function(ce){var V=ce.split(":"),k=V.shift().trim();if(k){var B=V.join(":").trim();S.append(k,B)}}),S}de.call(W.prototype);function ue(m,S){S||(S={}),this.type="default",this.status=S.status===void 0?200:S.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in S?S.statusText:"OK",this.headers=new T(S.headers),this.url=S.url||"",this._initBody(m)}de.call(ue.prototype),ue.prototype.clone=function(){return new ue(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new T(this.headers),url:this.url})},ue.error=function(){var m=new ue(null,{status:0,statusText:""});return m.type="error",m};var Te=[301,302,303,307,308];ue.redirect=function(m,S){if(Te.indexOf(S)===-1)throw new RangeError("Invalid status code");return new ue(null,{status:S,headers:{location:m}})},f.DOMException=c.DOMException;try{new f.DOMException}catch{f.DOMException=function(S,Y){this.message=S,this.name=Y;var ce=Error(S);this.stack=ce.stack},f.DOMException.prototype=Object.create(Error.prototype),f.DOMException.prototype.constructor=f.DOMException}function Ue(m,S){return new Promise(function(Y,ce){var V=new W(m,S);if(V.signal&&V.signal.aborted)return ce(new f.DOMException("Aborted","AbortError"));var k=new XMLHttpRequest;function B(){k.abort()}k.onload=function(){var G={status:k.status,statusText:k.statusText,headers:ie(k.getAllResponseHeaders()||"")};G.url="responseURL"in k?k.responseURL:G.headers.get("X-Request-URL");var Je="response"in k?k.response:k.responseText;Y(new ue(Je,G))},k.onerror=function(){ce(new TypeError("Network request failed"))},k.ontimeout=function(){ce(new TypeError("Network request failed"))},k.onabort=function(){ce(new f.DOMException("Aborted","AbortError"))},k.open(V.method,V.url,!0),V.credentials==="include"?k.withCredentials=!0:V.credentials==="omit"&&(k.withCredentials=!1),"responseType"in k&&g.blob&&(k.responseType="blob"),V.headers.forEach(function(G,Je){k.setRequestHeader(Je,G)}),V.signal&&(V.signal.addEventListener("abort",B),k.onreadystatechange=function(){k.readyState===4&&V.signal.removeEventListener("abort",B)}),k.send(typeof V._bodyInit>"u"?null:V._bodyInit)})}return Ue.polyfill=!0,c.fetch||(c.fetch=Ue,c.Headers=T,c.Request=W,c.Response=ue),f.Headers=T,f.Request=W,f.Response=ue,f.fetch=Ue,Object.defineProperty(f,"__esModule",{value:!0}),f})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=n;t=s.fetch,t.default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,a.exports=t})(Cc,Cc.exports);var zI=Cc.exports;const Ul=tf(zI),kI={Accept:"application/json","Content-Type":"application/json"},HI="POST",zl={headers:kI,method:HI},kl=10;class Pi{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new Or.EventEmitter,this.isAvailable=!1,this.registering=!1,!dl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const n=Hi(t),c=await(await Ul(this.url,Object.assign(Object.assign({},zl),{body:n}))).json();this.onPayload({data:c})}catch(n){this.onError(t.id,n)}}async register(t=this.url){if(!dl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=Hi({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ul(t,Object.assign(Object.assign({},zl),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ts(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),s=n.message||n.toString(),c=So(t,s);this.events.emit("payload",c)}parseError(t,r=this.url){return Ef(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>kl&&this.events.setMaxListeners(kl)}}const Hl="error",BI="wss://relay.walletconnect.com",KI="wc",VI="universal_provider",Bl=`${KI}@2:${VI}:`,GI="https://rpc.walletconnect.com/v1/",hi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,t){(function(){var r,n="4.17.21",s=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",g="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",p=500,b="__lodash_placeholder__",R=1,x=2,j=4,T=1,K=2,re=1,he=2,le=4,fe=8,pe=16,de=32,F=64,z=128,W=256,ve=512,ie=30,ue="...",Te=800,Ue=16,m=1,S=2,Y=3,ce=1/0,V=9007199254740991,k=17976931348623157e292,B=0/0,G=4294967295,Je=G-1,He=G>>>1,Mr=[["ary",z],["bind",re],["bindKey",he],["curry",fe],["curryRight",pe],["flip",ve],["partial",de],["partialRight",F],["rearg",W]],Ie="[object Arguments]",It="[object Array]",$="[object AsyncFunction]",D="[object Boolean]",C="[object Date]",h="[object DOMException]",I="[object Error]",ee="[object Function]",ge="[object GeneratorFunction]",be="[object Map]",Ne="[object Number]",je="[object Null]",Pe="[object Object]",xt="[object Promise]",mt="[object Proxy]",ot="[object RegExp]",Fe="[object Set]",Ye="[object String]",Xe="[object Symbol]",at="[object Undefined]",ze="[object WeakMap]",Ze="[object WeakSet]",De="[object ArrayBuffer]",Be="[object DataView]",ht="[object Float32Array]",Me="[object Float64Array]",St="[object Int8Array]",jt="[object Int16Array]",zt="[object Int32Array]",kt="[object Uint8Array]",Lt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",rr="[object Uint32Array]",qr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Vr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,li=/&(?:amp|lt|gt|quot|#39);/g,Oi=/[&<>"']/g,lt=RegExp(li.source),rt=RegExp(Oi.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Ot=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(dt.source),gt=/^\s+/,_t=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,Rt=/,? & /,Ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ro=/[()=,{}\[\]\/\s]/,Co=/\\(\\)?/g,To=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vr=/\w*$/,No=/^[-+]0x[0-9a-f]+$/i,Do=/^0b[01]+$/i,jo=/^\[object .+?Constructor\]$/,$o=/^0o[0-7]+$/i,Fo=/^(?:0|[1-9]\d*)$/,Gr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gi=/($^)/,Lo=/['\n\r\u2028\u2029\\]/g,Wi="\\ud800-\\udfff",Mo="\\u0300-\\u036f",qo="\\ufe20-\\ufe2f",Ji="\\u20d0-\\u20ff",is=Mo+qo+Ji,ns="\\u2700-\\u27bf",Ar="a-z\\xdf-\\xf6\\xf8-\\xff",Uo="\\xac\\xb1\\xd7\\xf7",zo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ko="\\u2000-\\u206f",Ho=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ss="A-Z\\xc0-\\xd6\\xd8-\\xde",os="\\ufe0e\\ufe0f",Ai=Uo+zo+ko+Ho,wn="['’]",Ri="["+Wi+"]",bn="["+Ai+"]",Ci="["+is+"]",as="\\d+",Bo="["+ns+"]",cs="["+Ar+"]",us="[^"+Wi+Ai+as+ns+Ar+ss+"]",Qi="\\ud83c[\\udffb-\\udfff]",Ko="(?:"+Ci+"|"+Qi+")",hs="[^"+Wi+"]",Yi="(?:\\ud83c[\\udde6-\\uddff]){2}",fi="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+ss+"]",ls="\\u200d",fs="(?:"+cs+"|"+us+")",Ur="(?:"+lr+"|"+us+")",ps="(?:"+wn+"(?:d|ll|m|re|s|t|ve))?",ds="(?:"+wn+"(?:D|LL|M|RE|S|T|VE))?",gs=Ko+"?",ys="["+os+"]?",Vo="(?:"+ls+"(?:"+[hs,Yi,fi].join("|")+")"+ys+gs+")*",Wr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ms=ys+gs+Vo,Xi="(?:"+[Bo,Yi,fi].join("|")+")"+ms,Go="(?:"+[hs+Ci+"?",Ci,Yi,fi,Ri].join("|")+")",En=RegExp(wn,"g"),Wo=RegExp(Ci,"g"),Zi=RegExp(Qi+"(?="+Qi+")|"+Go+ms,"g"),_s=RegExp([lr+"?"+cs+"+"+ps+"(?="+[bn,lr,"$"].join("|")+")",Ur+"+"+ds+"(?="+[bn,lr+fs,"$"].join("|")+")",lr+"?"+fs+"+"+ps,lr+"+"+ds,vs,Wr,as,Xi].join("|"),"g"),ws=RegExp("["+ls+Wi+is+os+"]"),Ti=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,bs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Jo=-1,Ke={};Ke[ht]=Ke[Me]=Ke[St]=Ke[jt]=Ke[zt]=Ke[kt]=Ke[Lt]=Ke[Wt]=Ke[rr]=!0,Ke[Ie]=Ke[It]=Ke[De]=Ke[D]=Ke[Be]=Ke[C]=Ke[I]=Ke[ee]=Ke[be]=Ke[Ne]=Ke[Pe]=Ke[ot]=Ke[Fe]=Ke[Ye]=Ke[ze]=!1;var ke={};ke[Ie]=ke[It]=ke[De]=ke[Be]=ke[D]=ke[C]=ke[ht]=ke[Me]=ke[St]=ke[jt]=ke[zt]=ke[be]=ke[Ne]=ke[Pe]=ke[ot]=ke[Fe]=ke[Ye]=ke[Xe]=ke[kt]=ke[Lt]=ke[Wt]=ke[rr]=!0,ke[I]=ke[ee]=ke[ze]=!1;var v={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},U={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,me=parseInt,et=typeof Kn=="object"&&Kn&&Kn.Object===Object&&Kn,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Ae=et||Tt||Function("return this")(),Ge=t&&!t.nodeType&&t,wt=Ge&&!0&&a&&!a.nodeType&&a,ir=wt&&wt.exports===Ge,Nt=ir&&et.process,tt=function(){try{var O=wt&&wt.require&&wt.require("util").types;return O||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Qt=tt&&tt.isArrayBuffer,Rr=tt&&tt.isDate,mr=tt&&tt.isMap,zr=tt&&tt.isRegExp,In=tt&&tt.isSet,Ni=tt&&tt.isTypedArray;function Mt(O,L,N){switch(N.length){case 0:return O.call(L);case 1:return O.call(L,N[0]);case 2:return O.call(L,N[0],N[1]);case 3:return O.call(L,N[0],N[1],N[2])}return O.apply(L,N)}function Jf(O,L,N,X){for(var ye=-1,$e=O==null?0:O.length;++ye<$e;){var $t=O[ye];L(X,$t,N($t),O)}return X}function _r(O,L){for(var N=-1,X=O==null?0:O.length;++N<X&&L(O[N],N,O)!==!1;);return O}function Qf(O,L){for(var N=O==null?0:O.length;N--&&L(O[N],N,O)!==!1;);return O}function Vc(O,L){for(var N=-1,X=O==null?0:O.length;++N<X;)if(!L(O[N],N,O))return!1;return!0}function pi(O,L){for(var N=-1,X=O==null?0:O.length,ye=0,$e=[];++N<X;){var $t=O[N];L($t,N,O)&&($e[ye++]=$t)}return $e}function Es(O,L){var N=O==null?0:O.length;return!!N&&en(O,L,0)>-1}function Qo(O,L,N){for(var X=-1,ye=O==null?0:O.length;++X<ye;)if(N(L,O[X]))return!0;return!1}function nt(O,L){for(var N=-1,X=O==null?0:O.length,ye=Array(X);++N<X;)ye[N]=L(O[N],N,O);return ye}function di(O,L){for(var N=-1,X=L.length,ye=O.length;++N<X;)O[ye+N]=L[N];return O}function Yo(O,L,N,X){var ye=-1,$e=O==null?0:O.length;for(X&&$e&&(N=O[++ye]);++ye<$e;)N=L(N,O[ye],ye,O);return N}function Yf(O,L,N,X){var ye=O==null?0:O.length;for(X&&ye&&(N=O[--ye]);ye--;)N=L(N,O[ye],ye,O);return N}function Xo(O,L){for(var N=-1,X=O==null?0:O.length;++N<X;)if(L(O[N],N,O))return!0;return!1}var Xf=Zo("length");function Zf(O){return O.split("")}function ep(O){return O.match(Ct)||[]}function Gc(O,L,N){var X;return N(O,function(ye,$e,$t){if(L(ye,$e,$t))return X=$e,!1}),X}function Is(O,L,N,X){for(var ye=O.length,$e=N+(X?1:-1);X?$e--:++$e<ye;)if(L(O[$e],$e,O))return $e;return-1}function en(O,L,N){return L===L?fp(O,L,N):Is(O,Wc,N)}function tp(O,L,N,X){for(var ye=N-1,$e=O.length;++ye<$e;)if(X(O[ye],L))return ye;return-1}function Wc(O){return O!==O}function Jc(O,L){var N=O==null?0:O.length;return N?ta(O,L)/N:B}function Zo(O){return function(L){return L==null?r:L[O]}}function ea(O){return function(L){return O==null?r:O[L]}}function Qc(O,L,N,X,ye){return ye(O,function($e,$t,We){N=X?(X=!1,$e):L(N,$e,$t,We)}),N}function rp(O,L){var N=O.length;for(O.sort(L);N--;)O[N]=O[N].value;return O}function ta(O,L){for(var N,X=-1,ye=O.length;++X<ye;){var $e=L(O[X]);$e!==r&&(N=N===r?$e:N+$e)}return N}function ra(O,L){for(var N=-1,X=Array(O);++N<O;)X[N]=L(N);return X}function ip(O,L){return nt(L,function(N){return[N,O[N]]})}function Yc(O){return O&&O.slice(0,tu(O)+1).replace(gt,"")}function fr(O){return function(L){return O(L)}}function ia(O,L){return nt(L,function(N){return O[N]})}function xn(O,L){return O.has(L)}function Xc(O,L){for(var N=-1,X=O.length;++N<X&&en(L,O[N],0)>-1;);return N}function Zc(O,L){for(var N=O.length;N--&&en(L,O[N],0)>-1;);return N}function np(O,L){for(var N=O.length,X=0;N--;)O[N]===L&&++X;return X}var sp=ea(v),op=ea(P);function ap(O){return"\\"+Q[O]}function cp(O,L){return O==null?r:O[L]}function tn(O){return ws.test(O)}function up(O){return Ti.test(O)}function hp(O){for(var L,N=[];!(L=O.next()).done;)N.push(L.value);return N}function na(O){var L=-1,N=Array(O.size);return O.forEach(function(X,ye){N[++L]=[ye,X]}),N}function eu(O,L){return function(N){return O(L(N))}}function gi(O,L){for(var N=-1,X=O.length,ye=0,$e=[];++N<X;){var $t=O[N];($t===L||$t===b)&&(O[N]=b,$e[ye++]=N)}return $e}function xs(O){var L=-1,N=Array(O.size);return O.forEach(function(X){N[++L]=X}),N}function lp(O){var L=-1,N=Array(O.size);return O.forEach(function(X){N[++L]=[X,X]}),N}function fp(O,L,N){for(var X=N-1,ye=O.length;++X<ye;)if(O[X]===L)return X;return-1}function pp(O,L,N){for(var X=N+1;X--;)if(O[X]===L)return X;return X}function rn(O){return tn(O)?gp(O):Xf(O)}function Cr(O){return tn(O)?yp(O):Zf(O)}function tu(O){for(var L=O.length;L--&&_t.test(O.charAt(L)););return L}var dp=ea(U);function gp(O){for(var L=Zi.lastIndex=0;Zi.test(O);)++L;return L}function yp(O){return O.match(Zi)||[]}function vp(O){return O.match(_s)||[]}var mp=function O(L){L=L==null?Ae:nn.defaults(Ae.Object(),L,nn.pick(Ae,bs));var N=L.Array,X=L.Date,ye=L.Error,$e=L.Function,$t=L.Math,We=L.Object,sa=L.RegExp,_p=L.String,wr=L.TypeError,Ss=N.prototype,wp=$e.prototype,sn=We.prototype,Ps=L["__core-js_shared__"],Os=wp.toString,qe=sn.hasOwnProperty,bp=0,ru=function(){var e=/[^.]+$/.exec(Ps&&Ps.keys&&Ps.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),As=sn.toString,Ep=Os.call(We),Ip=Ae._,xp=sa("^"+Os.call(qe).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rs=ir?L.Buffer:r,yi=L.Symbol,Cs=L.Uint8Array,iu=Rs?Rs.allocUnsafe:r,Ts=eu(We.getPrototypeOf,We),nu=We.create,su=sn.propertyIsEnumerable,Ns=Ss.splice,ou=yi?yi.isConcatSpreadable:r,Sn=yi?yi.iterator:r,Di=yi?yi.toStringTag:r,Ds=function(){try{var e=Mi(We,"defineProperty");return e({},"",{}),e}catch{}}(),Sp=L.clearTimeout!==Ae.clearTimeout&&L.clearTimeout,Pp=X&&X.now!==Ae.Date.now&&X.now,Op=L.setTimeout!==Ae.setTimeout&&L.setTimeout,js=$t.ceil,$s=$t.floor,oa=We.getOwnPropertySymbols,Ap=Rs?Rs.isBuffer:r,au=L.isFinite,Rp=Ss.join,Cp=eu(We.keys,We),Ft=$t.max,Kt=$t.min,Tp=X.now,Np=L.parseInt,cu=$t.random,Dp=Ss.reverse,aa=Mi(L,"DataView"),Pn=Mi(L,"Map"),ca=Mi(L,"Promise"),on=Mi(L,"Set"),On=Mi(L,"WeakMap"),An=Mi(We,"create"),Fs=On&&new On,an={},jp=qi(aa),$p=qi(Pn),Fp=qi(ca),Lp=qi(on),Mp=qi(On),Ls=yi?yi.prototype:r,Rn=Ls?Ls.valueOf:r,uu=Ls?Ls.toString:r;function d(e){if(vt(e)&&!_e(e)&&!(e instanceof Oe)){if(e instanceof br)return e;if(qe.call(e,"__wrapped__"))return hh(e)}return new br(e)}var cn=function(){function e(){}return function(i){if(!ut(i))return{};if(nu)return nu(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function Ms(){}function br(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:ft,evaluate:pt,interpolate:ct,variable:"",imports:{_:d}},d.prototype=Ms.prototype,d.prototype.constructor=d,br.prototype=cn(Ms.prototype),br.prototype.constructor=br;function Oe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=G,this.__views__=[]}function qp(){var e=new Oe(this.__wrapped__);return e.__actions__=nr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nr(this.__views__),e}function Up(){if(this.__filtered__){var e=new Oe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function zp(){var e=this.__wrapped__.value(),i=this.__dir__,o=_e(e),u=i<0,l=o?e.length:0,y=Zd(0,l,this.__views__),w=y.start,E=y.end,A=E-w,M=u?E:w-1,q=this.__iteratees__,H=q.length,J=0,te=Kt(A,this.__takeCount__);if(!o||!u&&l==A&&te==A)return Du(e,this.__actions__);var oe=[];e:for(;A--&&J<te;){M+=i;for(var Ee=-1,ae=e[M];++Ee<H;){var Se=q[Ee],Re=Se.iteratee,gr=Se.type,Zt=Re(ae);if(gr==S)ae=Zt;else if(!Zt){if(gr==m)continue e;break e}}oe[J++]=ae}return oe}Oe.prototype=cn(Ms.prototype),Oe.prototype.constructor=Oe;function ji(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var u=e[i];this.set(u[0],u[1])}}function kp(){this.__data__=An?An(null):{},this.size=0}function Hp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Bp(e){var i=this.__data__;if(An){var o=i[e];return o===_?r:o}return qe.call(i,e)?i[e]:r}function Kp(e){var i=this.__data__;return An?i[e]!==r:qe.call(i,e)}function Vp(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=An&&i===r?_:i,this}ji.prototype.clear=kp,ji.prototype.delete=Hp,ji.prototype.get=Bp,ji.prototype.has=Kp,ji.prototype.set=Vp;function Jr(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var u=e[i];this.set(u[0],u[1])}}function Gp(){this.__data__=[],this.size=0}function Wp(e){var i=this.__data__,o=qs(i,e);if(o<0)return!1;var u=i.length-1;return o==u?i.pop():Ns.call(i,o,1),--this.size,!0}function Jp(e){var i=this.__data__,o=qs(i,e);return o<0?r:i[o][1]}function Qp(e){return qs(this.__data__,e)>-1}function Yp(e,i){var o=this.__data__,u=qs(o,e);return u<0?(++this.size,o.push([e,i])):o[u][1]=i,this}Jr.prototype.clear=Gp,Jr.prototype.delete=Wp,Jr.prototype.get=Jp,Jr.prototype.has=Qp,Jr.prototype.set=Yp;function Qr(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var u=e[i];this.set(u[0],u[1])}}function Xp(){this.size=0,this.__data__={hash:new ji,map:new(Pn||Jr),string:new ji}}function Zp(e){var i=Ys(this,e).delete(e);return this.size-=i?1:0,i}function ed(e){return Ys(this,e).get(e)}function td(e){return Ys(this,e).has(e)}function rd(e,i){var o=Ys(this,e),u=o.size;return o.set(e,i),this.size+=o.size==u?0:1,this}Qr.prototype.clear=Xp,Qr.prototype.delete=Zp,Qr.prototype.get=ed,Qr.prototype.has=td,Qr.prototype.set=rd;function $i(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new Qr;++i<o;)this.add(e[i])}function id(e){return this.__data__.set(e,_),this}function nd(e){return this.__data__.has(e)}$i.prototype.add=$i.prototype.push=id,$i.prototype.has=nd;function Tr(e){var i=this.__data__=new Jr(e);this.size=i.size}function sd(){this.__data__=new Jr,this.size=0}function od(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function ad(e){return this.__data__.get(e)}function cd(e){return this.__data__.has(e)}function ud(e,i){var o=this.__data__;if(o instanceof Jr){var u=o.__data__;if(!Pn||u.length<s-1)return u.push([e,i]),this.size=++o.size,this;o=this.__data__=new Qr(u)}return o.set(e,i),this.size=o.size,this}Tr.prototype.clear=sd,Tr.prototype.delete=od,Tr.prototype.get=ad,Tr.prototype.has=cd,Tr.prototype.set=ud;function hu(e,i){var o=_e(e),u=!o&&Ui(e),l=!o&&!u&&bi(e),y=!o&&!u&&!l&&fn(e),w=o||u||l||y,E=w?ra(e.length,_p):[],A=E.length;for(var M in e)(i||qe.call(e,M))&&!(w&&(M=="length"||l&&(M=="offset"||M=="parent")||y&&(M=="buffer"||M=="byteLength"||M=="byteOffset")||ei(M,A)))&&E.push(M);return E}function lu(e){var i=e.length;return i?e[_a(0,i-1)]:r}function hd(e,i){return Xs(nr(e),Fi(i,0,e.length))}function ld(e){return Xs(nr(e))}function ua(e,i,o){(o!==r&&!Nr(e[i],o)||o===r&&!(i in e))&&Yr(e,i,o)}function Cn(e,i,o){var u=e[i];(!(qe.call(e,i)&&Nr(u,o))||o===r&&!(i in e))&&Yr(e,i,o)}function qs(e,i){for(var o=e.length;o--;)if(Nr(e[o][0],i))return o;return-1}function fd(e,i,o,u){return vi(e,function(l,y,w){i(u,l,o(l),w)}),u}function fu(e,i){return e&&Hr(i,qt(i),e)}function pd(e,i){return e&&Hr(i,or(i),e)}function Yr(e,i,o){i=="__proto__"&&Ds?Ds(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function ha(e,i){for(var o=-1,u=i.length,l=N(u),y=e==null;++o<u;)l[o]=y?r:Ba(e,i[o]);return l}function Fi(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Er(e,i,o,u,l,y){var w,E=i&R,A=i&x,M=i&j;if(o&&(w=l?o(e,u,l,y):o(e)),w!==r)return w;if(!ut(e))return e;var q=_e(e);if(q){if(w=tg(e),!E)return nr(e,w)}else{var H=Vt(e),J=H==ee||H==ge;if(bi(e))return Fu(e,E);if(H==Pe||H==Ie||J&&!l){if(w=A||J?{}:th(e),!E)return A?Bd(e,pd(w,e)):Hd(e,fu(w,e))}else{if(!ke[H])return l?e:{};w=rg(e,H,E)}}y||(y=new Tr);var te=y.get(e);if(te)return te;y.set(e,w),Ch(e)?e.forEach(function(ae){w.add(Er(ae,i,o,ae,e,y))}):Ah(e)&&e.forEach(function(ae,Se){w.set(Se,Er(ae,i,o,Se,e,y))});var oe=M?A?Ca:Ra:A?or:qt,Ee=q?r:oe(e);return _r(Ee||e,function(ae,Se){Ee&&(Se=ae,ae=e[Se]),Cn(w,Se,Er(ae,i,o,Se,e,y))}),w}function dd(e){var i=qt(e);return function(o){return pu(o,e,i)}}function pu(e,i,o){var u=o.length;if(e==null)return!u;for(e=We(e);u--;){var l=o[u],y=i[l],w=e[l];if(w===r&&!(l in e)||!y(w))return!1}return!0}function du(e,i,o){if(typeof e!="function")throw new wr(f);return Ln(function(){e.apply(r,o)},i)}function Tn(e,i,o,u){var l=-1,y=Es,w=!0,E=e.length,A=[],M=i.length;if(!E)return A;o&&(i=nt(i,fr(o))),u?(y=Qo,w=!1):i.length>=s&&(y=xn,w=!1,i=new $i(i));e:for(;++l<E;){var q=e[l],H=o==null?q:o(q);if(q=u||q!==0?q:0,w&&H===H){for(var J=M;J--;)if(i[J]===H)continue e;A.push(q)}else y(i,H,u)||A.push(q)}return A}var vi=zu(kr),gu=zu(fa,!0);function gd(e,i){var o=!0;return vi(e,function(u,l,y){return o=!!i(u,l,y),o}),o}function Us(e,i,o){for(var u=-1,l=e.length;++u<l;){var y=e[u],w=i(y);if(w!=null&&(E===r?w===w&&!dr(w):o(w,E)))var E=w,A=y}return A}function yd(e,i,o,u){var l=e.length;for(o=we(o),o<0&&(o=-o>l?0:l+o),u=u===r||u>l?l:we(u),u<0&&(u+=l),u=o>u?0:Nh(u);o<u;)e[o++]=i;return e}function yu(e,i){var o=[];return vi(e,function(u,l,y){i(u,l,y)&&o.push(u)}),o}function Ht(e,i,o,u,l){var y=-1,w=e.length;for(o||(o=ng),l||(l=[]);++y<w;){var E=e[y];i>0&&o(E)?i>1?Ht(E,i-1,o,u,l):di(l,E):u||(l[l.length]=E)}return l}var la=ku(),vu=ku(!0);function kr(e,i){return e&&la(e,i,qt)}function fa(e,i){return e&&vu(e,i,qt)}function zs(e,i){return pi(i,function(o){return ti(e[o])})}function Li(e,i){i=_i(i,e);for(var o=0,u=i.length;e!=null&&o<u;)e=e[Br(i[o++])];return o&&o==u?e:r}function mu(e,i,o){var u=i(e);return _e(e)?u:di(u,o(e))}function Yt(e){return e==null?e===r?at:je:Di&&Di in We(e)?Xd(e):lg(e)}function pa(e,i){return e>i}function vd(e,i){return e!=null&&qe.call(e,i)}function md(e,i){return e!=null&&i in We(e)}function _d(e,i,o){return e>=Kt(i,o)&&e<Ft(i,o)}function da(e,i,o){for(var u=o?Qo:Es,l=e[0].length,y=e.length,w=y,E=N(y),A=1/0,M=[];w--;){var q=e[w];w&&i&&(q=nt(q,fr(i))),A=Kt(q.length,A),E[w]=!o&&(i||l>=120&&q.length>=120)?new $i(w&&q):r}q=e[0];var H=-1,J=E[0];e:for(;++H<l&&M.length<A;){var te=q[H],oe=i?i(te):te;if(te=o||te!==0?te:0,!(J?xn(J,oe):u(M,oe,o))){for(w=y;--w;){var Ee=E[w];if(!(Ee?xn(Ee,oe):u(e[w],oe,o)))continue e}J&&J.push(oe),M.push(te)}}return M}function wd(e,i,o,u){return kr(e,function(l,y,w){i(u,o(l),y,w)}),u}function Nn(e,i,o){i=_i(i,e),e=sh(e,i);var u=e==null?e:e[Br(xr(i))];return u==null?r:Mt(u,e,o)}function _u(e){return vt(e)&&Yt(e)==Ie}function bd(e){return vt(e)&&Yt(e)==De}function Ed(e){return vt(e)&&Yt(e)==C}function Dn(e,i,o,u,l){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:Id(e,i,o,u,Dn,l)}function Id(e,i,o,u,l,y){var w=_e(e),E=_e(i),A=w?It:Vt(e),M=E?It:Vt(i);A=A==Ie?Pe:A,M=M==Ie?Pe:M;var q=A==Pe,H=M==Pe,J=A==M;if(J&&bi(e)){if(!bi(i))return!1;w=!0,q=!1}if(J&&!q)return y||(y=new Tr),w||fn(e)?Xu(e,i,o,u,l,y):Qd(e,i,A,o,u,l,y);if(!(o&T)){var te=q&&qe.call(e,"__wrapped__"),oe=H&&qe.call(i,"__wrapped__");if(te||oe){var Ee=te?e.value():e,ae=oe?i.value():i;return y||(y=new Tr),l(Ee,ae,o,u,y)}}return J?(y||(y=new Tr),Yd(e,i,o,u,l,y)):!1}function xd(e){return vt(e)&&Vt(e)==be}function ga(e,i,o,u){var l=o.length,y=l,w=!u;if(e==null)return!y;for(e=We(e);l--;){var E=o[l];if(w&&E[2]?E[1]!==e[E[0]]:!(E[0]in e))return!1}for(;++l<y;){E=o[l];var A=E[0],M=e[A],q=E[1];if(w&&E[2]){if(M===r&&!(A in e))return!1}else{var H=new Tr;if(u)var J=u(M,q,A,e,i,H);if(!(J===r?Dn(q,M,T|K,u,H):J))return!1}}return!0}function wu(e){if(!ut(e)||og(e))return!1;var i=ti(e)?xp:jo;return i.test(qi(e))}function Sd(e){return vt(e)&&Yt(e)==ot}function Pd(e){return vt(e)&&Vt(e)==Fe}function Od(e){return vt(e)&&no(e.length)&&!!Ke[Yt(e)]}function bu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?_e(e)?xu(e[0],e[1]):Iu(e):Hh(e)}function ya(e){if(!Fn(e))return Cp(e);var i=[];for(var o in We(e))qe.call(e,o)&&o!="constructor"&&i.push(o);return i}function Ad(e){if(!ut(e))return hg(e);var i=Fn(e),o=[];for(var u in e)u=="constructor"&&(i||!qe.call(e,u))||o.push(u);return o}function va(e,i){return e<i}function Eu(e,i){var o=-1,u=sr(e)?N(e.length):[];return vi(e,function(l,y,w){u[++o]=i(l,y,w)}),u}function Iu(e){var i=Na(e);return i.length==1&&i[0][2]?ih(i[0][0],i[0][1]):function(o){return o===e||ga(o,e,i)}}function xu(e,i){return ja(e)&&rh(i)?ih(Br(e),i):function(o){var u=Ba(o,e);return u===r&&u===i?Ka(o,e):Dn(i,u,T|K)}}function ks(e,i,o,u,l){e!==i&&la(i,function(y,w){if(l||(l=new Tr),ut(y))Rd(e,i,w,o,ks,u,l);else{var E=u?u(Fa(e,w),y,w+"",e,i,l):r;E===r&&(E=y),ua(e,w,E)}},or)}function Rd(e,i,o,u,l,y,w){var E=Fa(e,o),A=Fa(i,o),M=w.get(A);if(M){ua(e,o,M);return}var q=y?y(E,A,o+"",e,i,w):r,H=q===r;if(H){var J=_e(A),te=!J&&bi(A),oe=!J&&!te&&fn(A);q=A,J||te||oe?_e(E)?q=E:bt(E)?q=nr(E):te?(H=!1,q=Fu(A,!0)):oe?(H=!1,q=Lu(A,!0)):q=[]:Mn(A)||Ui(A)?(q=E,Ui(E)?q=Dh(E):(!ut(E)||ti(E))&&(q=th(A))):H=!1}H&&(w.set(A,q),l(q,A,u,y,w),w.delete(A)),ua(e,o,q)}function Su(e,i){var o=e.length;if(o)return i+=i<0?o:0,ei(i,o)?e[i]:r}function Pu(e,i,o){i.length?i=nt(i,function(y){return _e(y)?function(w){return Li(w,y.length===1?y[0]:y)}:y}):i=[ar];var u=-1;i=nt(i,fr(se()));var l=Eu(e,function(y,w,E){var A=nt(i,function(M){return M(y)});return{criteria:A,index:++u,value:y}});return rp(l,function(y,w){return kd(y,w,o)})}function Cd(e,i){return Ou(e,i,function(o,u){return Ka(e,u)})}function Ou(e,i,o){for(var u=-1,l=i.length,y={};++u<l;){var w=i[u],E=Li(e,w);o(E,w)&&jn(y,_i(w,e),E)}return y}function Td(e){return function(i){return Li(i,e)}}function ma(e,i,o,u){var l=u?tp:en,y=-1,w=i.length,E=e;for(e===i&&(i=nr(i)),o&&(E=nt(e,fr(o)));++y<w;)for(var A=0,M=i[y],q=o?o(M):M;(A=l(E,q,A,u))>-1;)E!==e&&Ns.call(E,A,1),Ns.call(e,A,1);return e}function Au(e,i){for(var o=e?i.length:0,u=o-1;o--;){var l=i[o];if(o==u||l!==y){var y=l;ei(l)?Ns.call(e,l,1):Ea(e,l)}}return e}function _a(e,i){return e+$s(cu()*(i-e+1))}function Nd(e,i,o,u){for(var l=-1,y=Ft(js((i-e)/(o||1)),0),w=N(y);y--;)w[u?y:++l]=e,e+=o;return w}function wa(e,i){var o="";if(!e||i<1||i>V)return o;do i%2&&(o+=e),i=$s(i/2),i&&(e+=e);while(i);return o}function xe(e,i){return La(nh(e,i,ar),e+"")}function Dd(e){return lu(pn(e))}function jd(e,i){var o=pn(e);return Xs(o,Fi(i,0,o.length))}function jn(e,i,o,u){if(!ut(e))return e;i=_i(i,e);for(var l=-1,y=i.length,w=y-1,E=e;E!=null&&++l<y;){var A=Br(i[l]),M=o;if(A==="__proto__"||A==="constructor"||A==="prototype")return e;if(l!=w){var q=E[A];M=u?u(q,A,E):r,M===r&&(M=ut(q)?q:ei(i[l+1])?[]:{})}Cn(E,A,M),E=E[A]}return e}var Ru=Fs?function(e,i){return Fs.set(e,i),e}:ar,$d=Ds?function(e,i){return Ds(e,"toString",{configurable:!0,enumerable:!1,value:Ga(i),writable:!0})}:ar;function Fd(e){return Xs(pn(e))}function Ir(e,i,o){var u=-1,l=e.length;i<0&&(i=-i>l?0:l+i),o=o>l?l:o,o<0&&(o+=l),l=i>o?0:o-i>>>0,i>>>=0;for(var y=N(l);++u<l;)y[u]=e[u+i];return y}function Ld(e,i){var o;return vi(e,function(u,l,y){return o=i(u,l,y),!o}),!!o}function Hs(e,i,o){var u=0,l=e==null?u:e.length;if(typeof i=="number"&&i===i&&l<=He){for(;u<l;){var y=u+l>>>1,w=e[y];w!==null&&!dr(w)&&(o?w<=i:w<i)?u=y+1:l=y}return l}return ba(e,i,ar,o)}function ba(e,i,o,u){var l=0,y=e==null?0:e.length;if(y===0)return 0;i=o(i);for(var w=i!==i,E=i===null,A=dr(i),M=i===r;l<y;){var q=$s((l+y)/2),H=o(e[q]),J=H!==r,te=H===null,oe=H===H,Ee=dr(H);if(w)var ae=u||oe;else M?ae=oe&&(u||J):E?ae=oe&&J&&(u||!te):A?ae=oe&&J&&!te&&(u||!Ee):te||Ee?ae=!1:ae=u?H<=i:H<i;ae?l=q+1:y=q}return Kt(y,Je)}function Cu(e,i){for(var o=-1,u=e.length,l=0,y=[];++o<u;){var w=e[o],E=i?i(w):w;if(!o||!Nr(E,A)){var A=E;y[l++]=w===0?0:w}}return y}function Tu(e){return typeof e=="number"?e:dr(e)?B:+e}function pr(e){if(typeof e=="string")return e;if(_e(e))return nt(e,pr)+"";if(dr(e))return uu?uu.call(e):"";var i=e+"";return i=="0"&&1/e==-ce?"-0":i}function mi(e,i,o){var u=-1,l=Es,y=e.length,w=!0,E=[],A=E;if(o)w=!1,l=Qo;else if(y>=s){var M=i?null:Wd(e);if(M)return xs(M);w=!1,l=xn,A=new $i}else A=i?[]:E;e:for(;++u<y;){var q=e[u],H=i?i(q):q;if(q=o||q!==0?q:0,w&&H===H){for(var J=A.length;J--;)if(A[J]===H)continue e;i&&A.push(H),E.push(q)}else l(A,H,o)||(A!==E&&A.push(H),E.push(q))}return E}function Ea(e,i){return i=_i(i,e),e=sh(e,i),e==null||delete e[Br(xr(i))]}function Nu(e,i,o,u){return jn(e,i,o(Li(e,i)),u)}function Bs(e,i,o,u){for(var l=e.length,y=u?l:-1;(u?y--:++y<l)&&i(e[y],y,e););return o?Ir(e,u?0:y,u?y+1:l):Ir(e,u?y+1:0,u?l:y)}function Du(e,i){var o=e;return o instanceof Oe&&(o=o.value()),Yo(i,function(u,l){return l.func.apply(l.thisArg,di([u],l.args))},o)}function Ia(e,i,o){var u=e.length;if(u<2)return u?mi(e[0]):[];for(var l=-1,y=N(u);++l<u;)for(var w=e[l],E=-1;++E<u;)E!=l&&(y[l]=Tn(y[l]||w,e[E],i,o));return mi(Ht(y,1),i,o)}function ju(e,i,o){for(var u=-1,l=e.length,y=i.length,w={};++u<l;){var E=u<y?i[u]:r;o(w,e[u],E)}return w}function xa(e){return bt(e)?e:[]}function Sa(e){return typeof e=="function"?e:ar}function _i(e,i){return _e(e)?e:ja(e,i)?[e]:uh(Le(e))}var Md=xe;function wi(e,i,o){var u=e.length;return o=o===r?u:o,!i&&o>=u?e:Ir(e,i,o)}var $u=Sp||function(e){return Ae.clearTimeout(e)};function Fu(e,i){if(i)return e.slice();var o=e.length,u=iu?iu(o):new e.constructor(o);return e.copy(u),u}function Pa(e){var i=new e.constructor(e.byteLength);return new Cs(i).set(new Cs(e)),i}function qd(e,i){var o=i?Pa(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function Ud(e){var i=new e.constructor(e.source,vr.exec(e));return i.lastIndex=e.lastIndex,i}function zd(e){return Rn?We(Rn.call(e)):{}}function Lu(e,i){var o=i?Pa(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function Mu(e,i){if(e!==i){var o=e!==r,u=e===null,l=e===e,y=dr(e),w=i!==r,E=i===null,A=i===i,M=dr(i);if(!E&&!M&&!y&&e>i||y&&w&&A&&!E&&!M||u&&w&&A||!o&&A||!l)return 1;if(!u&&!y&&!M&&e<i||M&&o&&l&&!u&&!y||E&&o&&l||!w&&l||!A)return-1}return 0}function kd(e,i,o){for(var u=-1,l=e.criteria,y=i.criteria,w=l.length,E=o.length;++u<w;){var A=Mu(l[u],y[u]);if(A){if(u>=E)return A;var M=o[u];return A*(M=="desc"?-1:1)}}return e.index-i.index}function qu(e,i,o,u){for(var l=-1,y=e.length,w=o.length,E=-1,A=i.length,M=Ft(y-w,0),q=N(A+M),H=!u;++E<A;)q[E]=i[E];for(;++l<w;)(H||l<y)&&(q[o[l]]=e[l]);for(;M--;)q[E++]=e[l++];return q}function Uu(e,i,o,u){for(var l=-1,y=e.length,w=-1,E=o.length,A=-1,M=i.length,q=Ft(y-E,0),H=N(q+M),J=!u;++l<q;)H[l]=e[l];for(var te=l;++A<M;)H[te+A]=i[A];for(;++w<E;)(J||l<y)&&(H[te+o[w]]=e[l++]);return H}function nr(e,i){var o=-1,u=e.length;for(i||(i=N(u));++o<u;)i[o]=e[o];return i}function Hr(e,i,o,u){var l=!o;o||(o={});for(var y=-1,w=i.length;++y<w;){var E=i[y],A=u?u(o[E],e[E],E,o,e):r;A===r&&(A=e[E]),l?Yr(o,E,A):Cn(o,E,A)}return o}function Hd(e,i){return Hr(e,Da(e),i)}function Bd(e,i){return Hr(e,Zu(e),i)}function Ks(e,i){return function(o,u){var l=_e(o)?Jf:fd,y=i?i():{};return l(o,e,se(u,2),y)}}function un(e){return xe(function(i,o){var u=-1,l=o.length,y=l>1?o[l-1]:r,w=l>2?o[2]:r;for(y=e.length>3&&typeof y=="function"?(l--,y):r,w&&Xt(o[0],o[1],w)&&(y=l<3?r:y,l=1),i=We(i);++u<l;){var E=o[u];E&&e(i,E,u,y)}return i})}function zu(e,i){return function(o,u){if(o==null)return o;if(!sr(o))return e(o,u);for(var l=o.length,y=i?l:-1,w=We(o);(i?y--:++y<l)&&u(w[y],y,w)!==!1;);return o}}function ku(e){return function(i,o,u){for(var l=-1,y=We(i),w=u(i),E=w.length;E--;){var A=w[e?E:++l];if(o(y[A],A,y)===!1)break}return i}}function Kd(e,i,o){var u=i&re,l=$n(e);function y(){var w=this&&this!==Ae&&this instanceof y?l:e;return w.apply(u?o:this,arguments)}return y}function Hu(e){return function(i){i=Le(i);var o=tn(i)?Cr(i):r,u=o?o[0]:i.charAt(0),l=o?wi(o,1).join(""):i.slice(1);return u[e]()+l}}function hn(e){return function(i){return Yo(zh(Uh(i).replace(En,"")),e,"")}}function $n(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=cn(e.prototype),u=e.apply(o,i);return ut(u)?u:o}}function Vd(e,i,o){var u=$n(e);function l(){for(var y=arguments.length,w=N(y),E=y,A=ln(l);E--;)w[E]=arguments[E];var M=y<3&&w[0]!==A&&w[y-1]!==A?[]:gi(w,A);if(y-=M.length,y<o)return Wu(e,i,Vs,l.placeholder,r,w,M,r,r,o-y);var q=this&&this!==Ae&&this instanceof l?u:e;return Mt(q,this,w)}return l}function Bu(e){return function(i,o,u){var l=We(i);if(!sr(i)){var y=se(o,3);i=qt(i),o=function(E){return y(l[E],E,l)}}var w=e(i,o,u);return w>-1?l[y?i[w]:w]:r}}function Ku(e){return Zr(function(i){var o=i.length,u=o,l=br.prototype.thru;for(e&&i.reverse();u--;){var y=i[u];if(typeof y!="function")throw new wr(f);if(l&&!w&&Qs(y)=="wrapper")var w=new br([],!0)}for(u=w?u:o;++u<o;){y=i[u];var E=Qs(y),A=E=="wrapper"?Ta(y):r;A&&$a(A[0])&&A[1]==(z|fe|de|W)&&!A[4].length&&A[9]==1?w=w[Qs(A[0])].apply(w,A[3]):w=y.length==1&&$a(y)?w[E]():w.thru(y)}return function(){var M=arguments,q=M[0];if(w&&M.length==1&&_e(q))return w.plant(q).value();for(var H=0,J=o?i[H].apply(this,M):q;++H<o;)J=i[H].call(this,J);return J}})}function Vs(e,i,o,u,l,y,w,E,A,M){var q=i&z,H=i&re,J=i&he,te=i&(fe|pe),oe=i&ve,Ee=J?r:$n(e);function ae(){for(var Se=arguments.length,Re=N(Se),gr=Se;gr--;)Re[gr]=arguments[gr];if(te)var Zt=ln(ae),yr=np(Re,Zt);if(u&&(Re=qu(Re,u,l,te)),y&&(Re=Uu(Re,y,w,te)),Se-=yr,te&&Se<M){var Et=gi(Re,Zt);return Wu(e,i,Vs,ae.placeholder,o,Re,Et,E,A,M-Se)}var Dr=H?o:this,ii=J?Dr[e]:e;return Se=Re.length,E?Re=fg(Re,E):oe&&Se>1&&Re.reverse(),q&&A<Se&&(Re.length=A),this&&this!==Ae&&this instanceof ae&&(ii=Ee||$n(ii)),ii.apply(Dr,Re)}return ae}function Vu(e,i){return function(o,u){return wd(o,e,i(u),{})}}function Gs(e,i){return function(o,u){var l;if(o===r&&u===r)return i;if(o!==r&&(l=o),u!==r){if(l===r)return u;typeof o=="string"||typeof u=="string"?(o=pr(o),u=pr(u)):(o=Tu(o),u=Tu(u)),l=e(o,u)}return l}}function Oa(e){return Zr(function(i){return i=nt(i,fr(se())),xe(function(o){var u=this;return e(i,function(l){return Mt(l,u,o)})})})}function Ws(e,i){i=i===r?" ":pr(i);var o=i.length;if(o<2)return o?wa(i,e):i;var u=wa(i,js(e/rn(i)));return tn(i)?wi(Cr(u),0,e).join(""):u.slice(0,e)}function Gd(e,i,o,u){var l=i&re,y=$n(e);function w(){for(var E=-1,A=arguments.length,M=-1,q=u.length,H=N(q+A),J=this&&this!==Ae&&this instanceof w?y:e;++M<q;)H[M]=u[M];for(;A--;)H[M++]=arguments[++E];return Mt(J,l?o:this,H)}return w}function Gu(e){return function(i,o,u){return u&&typeof u!="number"&&Xt(i,o,u)&&(o=u=r),i=ri(i),o===r?(o=i,i=0):o=ri(o),u=u===r?i<o?1:-1:ri(u),Nd(i,o,u,e)}}function Js(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Sr(i),o=Sr(o)),e(i,o)}}function Wu(e,i,o,u,l,y,w,E,A,M){var q=i&fe,H=q?w:r,J=q?r:w,te=q?y:r,oe=q?r:y;i|=q?de:F,i&=~(q?F:de),i&le||(i&=~(re|he));var Ee=[e,i,l,te,H,oe,J,E,A,M],ae=o.apply(r,Ee);return $a(e)&&oh(ae,Ee),ae.placeholder=u,ah(ae,e,i)}function Aa(e){var i=$t[e];return function(o,u){if(o=Sr(o),u=u==null?0:Kt(we(u),292),u&&au(o)){var l=(Le(o)+"e").split("e"),y=i(l[0]+"e"+(+l[1]+u));return l=(Le(y)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return i(o)}}var Wd=on&&1/xs(new on([,-0]))[1]==ce?function(e){return new on(e)}:Qa;function Ju(e){return function(i){var o=Vt(i);return o==be?na(i):o==Fe?lp(i):ip(i,e(i))}}function Xr(e,i,o,u,l,y,w,E){var A=i&he;if(!A&&typeof e!="function")throw new wr(f);var M=u?u.length:0;if(M||(i&=~(de|F),u=l=r),w=w===r?w:Ft(we(w),0),E=E===r?E:we(E),M-=l?l.length:0,i&F){var q=u,H=l;u=l=r}var J=A?r:Ta(e),te=[e,i,o,u,l,q,H,y,w,E];if(J&&ug(te,J),e=te[0],i=te[1],o=te[2],u=te[3],l=te[4],E=te[9]=te[9]===r?A?0:e.length:Ft(te[9]-M,0),!E&&i&(fe|pe)&&(i&=~(fe|pe)),!i||i==re)var oe=Kd(e,i,o);else i==fe||i==pe?oe=Vd(e,i,E):(i==de||i==(re|de))&&!l.length?oe=Gd(e,i,o,u):oe=Vs.apply(r,te);var Ee=J?Ru:oh;return ah(Ee(oe,te),e,i)}function Qu(e,i,o,u){return e===r||Nr(e,sn[o])&&!qe.call(u,o)?i:e}function Yu(e,i,o,u,l,y){return ut(e)&&ut(i)&&(y.set(i,e),ks(e,i,r,Yu,y),y.delete(i)),e}function Jd(e){return Mn(e)?r:e}function Xu(e,i,o,u,l,y){var w=o&T,E=e.length,A=i.length;if(E!=A&&!(w&&A>E))return!1;var M=y.get(e),q=y.get(i);if(M&&q)return M==i&&q==e;var H=-1,J=!0,te=o&K?new $i:r;for(y.set(e,i),y.set(i,e);++H<E;){var oe=e[H],Ee=i[H];if(u)var ae=w?u(Ee,oe,H,i,e,y):u(oe,Ee,H,e,i,y);if(ae!==r){if(ae)continue;J=!1;break}if(te){if(!Xo(i,function(Se,Re){if(!xn(te,Re)&&(oe===Se||l(oe,Se,o,u,y)))return te.push(Re)})){J=!1;break}}else if(!(oe===Ee||l(oe,Ee,o,u,y))){J=!1;break}}return y.delete(e),y.delete(i),J}function Qd(e,i,o,u,l,y,w){switch(o){case Be:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case De:return!(e.byteLength!=i.byteLength||!y(new Cs(e),new Cs(i)));case D:case C:case Ne:return Nr(+e,+i);case I:return e.name==i.name&&e.message==i.message;case ot:case Ye:return e==i+"";case be:var E=na;case Fe:var A=u&T;if(E||(E=xs),e.size!=i.size&&!A)return!1;var M=w.get(e);if(M)return M==i;u|=K,w.set(e,i);var q=Xu(E(e),E(i),u,l,y,w);return w.delete(e),q;case Xe:if(Rn)return Rn.call(e)==Rn.call(i)}return!1}function Yd(e,i,o,u,l,y){var w=o&T,E=Ra(e),A=E.length,M=Ra(i),q=M.length;if(A!=q&&!w)return!1;for(var H=A;H--;){var J=E[H];if(!(w?J in i:qe.call(i,J)))return!1}var te=y.get(e),oe=y.get(i);if(te&&oe)return te==i&&oe==e;var Ee=!0;y.set(e,i),y.set(i,e);for(var ae=w;++H<A;){J=E[H];var Se=e[J],Re=i[J];if(u)var gr=w?u(Re,Se,J,i,e,y):u(Se,Re,J,e,i,y);if(!(gr===r?Se===Re||l(Se,Re,o,u,y):gr)){Ee=!1;break}ae||(ae=J=="constructor")}if(Ee&&!ae){var Zt=e.constructor,yr=i.constructor;Zt!=yr&&"constructor"in e&&"constructor"in i&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof yr=="function"&&yr instanceof yr)&&(Ee=!1)}return y.delete(e),y.delete(i),Ee}function Zr(e){return La(nh(e,r,ph),e+"")}function Ra(e){return mu(e,qt,Da)}function Ca(e){return mu(e,or,Zu)}var Ta=Fs?function(e){return Fs.get(e)}:Qa;function Qs(e){for(var i=e.name+"",o=an[i],u=qe.call(an,i)?o.length:0;u--;){var l=o[u],y=l.func;if(y==null||y==e)return l.name}return i}function ln(e){var i=qe.call(d,"placeholder")?d:e;return i.placeholder}function se(){var e=d.iteratee||Wa;return e=e===Wa?bu:e,arguments.length?e(arguments[0],arguments[1]):e}function Ys(e,i){var o=e.__data__;return sg(i)?o[typeof i=="string"?"string":"hash"]:o.map}function Na(e){for(var i=qt(e),o=i.length;o--;){var u=i[o],l=e[u];i[o]=[u,l,rh(l)]}return i}function Mi(e,i){var o=cp(e,i);return wu(o)?o:r}function Xd(e){var i=qe.call(e,Di),o=e[Di];try{e[Di]=r;var u=!0}catch{}var l=As.call(e);return u&&(i?e[Di]=o:delete e[Di]),l}var Da=oa?function(e){return e==null?[]:(e=We(e),pi(oa(e),function(i){return su.call(e,i)}))}:Ya,Zu=oa?function(e){for(var i=[];e;)di(i,Da(e)),e=Ts(e);return i}:Ya,Vt=Yt;(aa&&Vt(new aa(new ArrayBuffer(1)))!=Be||Pn&&Vt(new Pn)!=be||ca&&Vt(ca.resolve())!=xt||on&&Vt(new on)!=Fe||On&&Vt(new On)!=ze)&&(Vt=function(e){var i=Yt(e),o=i==Pe?e.constructor:r,u=o?qi(o):"";if(u)switch(u){case jp:return Be;case $p:return be;case Fp:return xt;case Lp:return Fe;case Mp:return ze}return i});function Zd(e,i,o){for(var u=-1,l=o.length;++u<l;){var y=o[u],w=y.size;switch(y.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Kt(i,e+w);break;case"takeRight":e=Ft(e,i-w);break}}return{start:e,end:i}}function eg(e){var i=e.match(Qe);return i?i[1].split(Rt):[]}function eh(e,i,o){i=_i(i,e);for(var u=-1,l=i.length,y=!1;++u<l;){var w=Br(i[u]);if(!(y=e!=null&&o(e,w)))break;e=e[w]}return y||++u!=l?y:(l=e==null?0:e.length,!!l&&no(l)&&ei(w,l)&&(_e(e)||Ui(e)))}function tg(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&qe.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function th(e){return typeof e.constructor=="function"&&!Fn(e)?cn(Ts(e)):{}}function rg(e,i,o){var u=e.constructor;switch(i){case De:return Pa(e);case D:case C:return new u(+e);case Be:return qd(e,o);case ht:case Me:case St:case jt:case zt:case kt:case Lt:case Wt:case rr:return Lu(e,o);case be:return new u;case Ne:case Ye:return new u(e);case ot:return Ud(e);case Fe:return new u;case Xe:return zd(e)}}function ig(e,i){var o=i.length;if(!o)return e;var u=o-1;return i[u]=(o>1?"& ":"")+i[u],i=i.join(o>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function ng(e){return _e(e)||Ui(e)||!!(ou&&e&&e[ou])}function ei(e,i){var o=typeof e;return i=i??V,!!i&&(o=="number"||o!="symbol"&&Fo.test(e))&&e>-1&&e%1==0&&e<i}function Xt(e,i,o){if(!ut(o))return!1;var u=typeof i;return(u=="number"?sr(o)&&ei(i,o.length):u=="string"&&i in o)?Nr(o[i],e):!1}function ja(e,i){if(_e(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||dr(e)?!0:Pt.test(e)||!it.test(e)||i!=null&&e in We(i)}function sg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function $a(e){var i=Qs(e),o=d[i];if(typeof o!="function"||!(i in Oe.prototype))return!1;if(e===o)return!0;var u=Ta(o);return!!u&&e===u[0]}function og(e){return!!ru&&ru in e}var ag=Ps?ti:Xa;function Fn(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||sn;return e===o}function rh(e){return e===e&&!ut(e)}function ih(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in We(o))}}function cg(e){var i=ro(e,function(u){return o.size===p&&o.clear(),u}),o=i.cache;return i}function ug(e,i){var o=e[1],u=i[1],l=o|u,y=l<(re|he|z),w=u==z&&o==fe||u==z&&o==W&&e[7].length<=i[8]||u==(z|W)&&i[7].length<=i[8]&&o==fe;if(!(y||w))return e;u&re&&(e[2]=i[2],l|=o&re?0:le);var E=i[3];if(E){var A=e[3];e[3]=A?qu(A,E,i[4]):E,e[4]=A?gi(e[3],b):i[4]}return E=i[5],E&&(A=e[5],e[5]=A?Uu(A,E,i[6]):E,e[6]=A?gi(e[5],b):i[6]),E=i[7],E&&(e[7]=E),u&z&&(e[8]=e[8]==null?i[8]:Kt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function hg(e){var i=[];if(e!=null)for(var o in We(e))i.push(o);return i}function lg(e){return As.call(e)}function nh(e,i,o){return i=Ft(i===r?e.length-1:i,0),function(){for(var u=arguments,l=-1,y=Ft(u.length-i,0),w=N(y);++l<y;)w[l]=u[i+l];l=-1;for(var E=N(i+1);++l<i;)E[l]=u[l];return E[i]=o(w),Mt(e,this,E)}}function sh(e,i){return i.length<2?e:Li(e,Ir(i,0,-1))}function fg(e,i){for(var o=e.length,u=Kt(i.length,o),l=nr(e);u--;){var y=i[u];e[u]=ei(y,o)?l[y]:r}return e}function Fa(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var oh=ch(Ru),Ln=Op||function(e,i){return Ae.setTimeout(e,i)},La=ch($d);function ah(e,i,o){var u=i+"";return La(e,ig(u,pg(eg(u),o)))}function ch(e){var i=0,o=0;return function(){var u=Tp(),l=Ue-(u-o);if(o=u,l>0){if(++i>=Te)return arguments[0]}else i=0;return e.apply(r,arguments)}}function Xs(e,i){var o=-1,u=e.length,l=u-1;for(i=i===r?u:i;++o<i;){var y=_a(o,l),w=e[y];e[y]=e[o],e[o]=w}return e.length=i,e}var uh=cg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Ot,function(o,u,l,y){i.push(l?y.replace(Co,"$1"):u||o)}),i});function Br(e){if(typeof e=="string"||dr(e))return e;var i=e+"";return i=="0"&&1/e==-ce?"-0":i}function qi(e){if(e!=null){try{return Os.call(e)}catch{}try{return e+""}catch{}}return""}function pg(e,i){return _r(Mr,function(o){var u="_."+o[0];i&o[1]&&!Es(e,u)&&e.push(u)}),e.sort()}function hh(e){if(e instanceof Oe)return e.clone();var i=new br(e.__wrapped__,e.__chain__);return i.__actions__=nr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function dg(e,i,o){(o?Xt(e,i,o):i===r)?i=1:i=Ft(we(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var l=0,y=0,w=N(js(u/i));l<u;)w[y++]=Ir(e,l,l+=i);return w}function gg(e){for(var i=-1,o=e==null?0:e.length,u=0,l=[];++i<o;){var y=e[i];y&&(l[u++]=y)}return l}function yg(){var e=arguments.length;if(!e)return[];for(var i=N(e-1),o=arguments[0],u=e;u--;)i[u-1]=arguments[u];return di(_e(o)?nr(o):[o],Ht(i,1))}var vg=xe(function(e,i){return bt(e)?Tn(e,Ht(i,1,bt,!0)):[]}),mg=xe(function(e,i){var o=xr(i);return bt(o)&&(o=r),bt(e)?Tn(e,Ht(i,1,bt,!0),se(o,2)):[]}),_g=xe(function(e,i){var o=xr(i);return bt(o)&&(o=r),bt(e)?Tn(e,Ht(i,1,bt,!0),r,o):[]});function wg(e,i,o){var u=e==null?0:e.length;return u?(i=o||i===r?1:we(i),Ir(e,i<0?0:i,u)):[]}function bg(e,i,o){var u=e==null?0:e.length;return u?(i=o||i===r?1:we(i),i=u-i,Ir(e,0,i<0?0:i)):[]}function Eg(e,i){return e&&e.length?Bs(e,se(i,3),!0,!0):[]}function Ig(e,i){return e&&e.length?Bs(e,se(i,3),!0):[]}function xg(e,i,o,u){var l=e==null?0:e.length;return l?(o&&typeof o!="number"&&Xt(e,i,o)&&(o=0,u=l),yd(e,i,o,u)):[]}function lh(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var l=o==null?0:we(o);return l<0&&(l=Ft(u+l,0)),Is(e,se(i,3),l)}function fh(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return o!==r&&(l=we(o),l=o<0?Ft(u+l,0):Kt(l,u-1)),Is(e,se(i,3),l,!0)}function ph(e){var i=e==null?0:e.length;return i?Ht(e,1):[]}function Sg(e){var i=e==null?0:e.length;return i?Ht(e,ce):[]}function Pg(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:we(i),Ht(e,i)):[]}function Og(e){for(var i=-1,o=e==null?0:e.length,u={};++i<o;){var l=e[i];u[l[0]]=l[1]}return u}function dh(e){return e&&e.length?e[0]:r}function Ag(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var l=o==null?0:we(o);return l<0&&(l=Ft(u+l,0)),en(e,i,l)}function Rg(e){var i=e==null?0:e.length;return i?Ir(e,0,-1):[]}var Cg=xe(function(e){var i=nt(e,xa);return i.length&&i[0]===e[0]?da(i):[]}),Tg=xe(function(e){var i=xr(e),o=nt(e,xa);return i===xr(o)?i=r:o.pop(),o.length&&o[0]===e[0]?da(o,se(i,2)):[]}),Ng=xe(function(e){var i=xr(e),o=nt(e,xa);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?da(o,r,i):[]});function Dg(e,i){return e==null?"":Rp.call(e,i)}function xr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function jg(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var l=u;return o!==r&&(l=we(o),l=l<0?Ft(u+l,0):Kt(l,u-1)),i===i?pp(e,i,l):Is(e,Wc,l,!0)}function $g(e,i){return e&&e.length?Su(e,we(i)):r}var Fg=xe(gh);function gh(e,i){return e&&e.length&&i&&i.length?ma(e,i):e}function Lg(e,i,o){return e&&e.length&&i&&i.length?ma(e,i,se(o,2)):e}function Mg(e,i,o){return e&&e.length&&i&&i.length?ma(e,i,r,o):e}var qg=Zr(function(e,i){var o=e==null?0:e.length,u=ha(e,i);return Au(e,nt(i,function(l){return ei(l,o)?+l:l}).sort(Mu)),u});function Ug(e,i){var o=[];if(!(e&&e.length))return o;var u=-1,l=[],y=e.length;for(i=se(i,3);++u<y;){var w=e[u];i(w,u,e)&&(o.push(w),l.push(u))}return Au(e,l),o}function Ma(e){return e==null?e:Dp.call(e)}function zg(e,i,o){var u=e==null?0:e.length;return u?(o&&typeof o!="number"&&Xt(e,i,o)?(i=0,o=u):(i=i==null?0:we(i),o=o===r?u:we(o)),Ir(e,i,o)):[]}function kg(e,i){return Hs(e,i)}function Hg(e,i,o){return ba(e,i,se(o,2))}function Bg(e,i){var o=e==null?0:e.length;if(o){var u=Hs(e,i);if(u<o&&Nr(e[u],i))return u}return-1}function Kg(e,i){return Hs(e,i,!0)}function Vg(e,i,o){return ba(e,i,se(o,2),!0)}function Gg(e,i){var o=e==null?0:e.length;if(o){var u=Hs(e,i,!0)-1;if(Nr(e[u],i))return u}return-1}function Wg(e){return e&&e.length?Cu(e):[]}function Jg(e,i){return e&&e.length?Cu(e,se(i,2)):[]}function Qg(e){var i=e==null?0:e.length;return i?Ir(e,1,i):[]}function Yg(e,i,o){return e&&e.length?(i=o||i===r?1:we(i),Ir(e,0,i<0?0:i)):[]}function Xg(e,i,o){var u=e==null?0:e.length;return u?(i=o||i===r?1:we(i),i=u-i,Ir(e,i<0?0:i,u)):[]}function Zg(e,i){return e&&e.length?Bs(e,se(i,3),!1,!0):[]}function ey(e,i){return e&&e.length?Bs(e,se(i,3)):[]}var ty=xe(function(e){return mi(Ht(e,1,bt,!0))}),ry=xe(function(e){var i=xr(e);return bt(i)&&(i=r),mi(Ht(e,1,bt,!0),se(i,2))}),iy=xe(function(e){var i=xr(e);return i=typeof i=="function"?i:r,mi(Ht(e,1,bt,!0),r,i)});function ny(e){return e&&e.length?mi(e):[]}function sy(e,i){return e&&e.length?mi(e,se(i,2)):[]}function oy(e,i){return i=typeof i=="function"?i:r,e&&e.length?mi(e,r,i):[]}function qa(e){if(!(e&&e.length))return[];var i=0;return e=pi(e,function(o){if(bt(o))return i=Ft(o.length,i),!0}),ra(i,function(o){return nt(e,Zo(o))})}function yh(e,i){if(!(e&&e.length))return[];var o=qa(e);return i==null?o:nt(o,function(u){return Mt(i,r,u)})}var ay=xe(function(e,i){return bt(e)?Tn(e,i):[]}),cy=xe(function(e){return Ia(pi(e,bt))}),uy=xe(function(e){var i=xr(e);return bt(i)&&(i=r),Ia(pi(e,bt),se(i,2))}),hy=xe(function(e){var i=xr(e);return i=typeof i=="function"?i:r,Ia(pi(e,bt),r,i)}),ly=xe(qa);function fy(e,i){return ju(e||[],i||[],Cn)}function py(e,i){return ju(e||[],i||[],jn)}var dy=xe(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,yh(e,o)});function vh(e){var i=d(e);return i.__chain__=!0,i}function gy(e,i){return i(e),e}function Zs(e,i){return i(e)}var yy=Zr(function(e){var i=e.length,o=i?e[0]:0,u=this.__wrapped__,l=function(y){return ha(y,e)};return i>1||this.__actions__.length||!(u instanceof Oe)||!ei(o)?this.thru(l):(u=u.slice(o,+o+(i?1:0)),u.__actions__.push({func:Zs,args:[l],thisArg:r}),new br(u,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function vy(){return vh(this)}function my(){return new br(this.value(),this.__chain__)}function _y(){this.__values__===r&&(this.__values__=Th(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function wy(){return this}function by(e){for(var i,o=this;o instanceof Ms;){var u=hh(o);u.__index__=0,u.__values__=r,i?l.__wrapped__=u:i=u;var l=u;o=o.__wrapped__}return l.__wrapped__=e,i}function Ey(){var e=this.__wrapped__;if(e instanceof Oe){var i=e;return this.__actions__.length&&(i=new Oe(this)),i=i.reverse(),i.__actions__.push({func:Zs,args:[Ma],thisArg:r}),new br(i,this.__chain__)}return this.thru(Ma)}function Iy(){return Du(this.__wrapped__,this.__actions__)}var xy=Ks(function(e,i,o){qe.call(e,o)?++e[o]:Yr(e,o,1)});function Sy(e,i,o){var u=_e(e)?Vc:gd;return o&&Xt(e,i,o)&&(i=r),u(e,se(i,3))}function Py(e,i){var o=_e(e)?pi:yu;return o(e,se(i,3))}var Oy=Bu(lh),Ay=Bu(fh);function Ry(e,i){return Ht(eo(e,i),1)}function Cy(e,i){return Ht(eo(e,i),ce)}function Ty(e,i,o){return o=o===r?1:we(o),Ht(eo(e,i),o)}function mh(e,i){var o=_e(e)?_r:vi;return o(e,se(i,3))}function _h(e,i){var o=_e(e)?Qf:gu;return o(e,se(i,3))}var Ny=Ks(function(e,i,o){qe.call(e,o)?e[o].push(i):Yr(e,o,[i])});function Dy(e,i,o,u){e=sr(e)?e:pn(e),o=o&&!u?we(o):0;var l=e.length;return o<0&&(o=Ft(l+o,0)),so(e)?o<=l&&e.indexOf(i,o)>-1:!!l&&en(e,i,o)>-1}var jy=xe(function(e,i,o){var u=-1,l=typeof i=="function",y=sr(e)?N(e.length):[];return vi(e,function(w){y[++u]=l?Mt(i,w,o):Nn(w,i,o)}),y}),$y=Ks(function(e,i,o){Yr(e,o,i)});function eo(e,i){var o=_e(e)?nt:Eu;return o(e,se(i,3))}function Fy(e,i,o,u){return e==null?[]:(_e(i)||(i=i==null?[]:[i]),o=u?r:o,_e(o)||(o=o==null?[]:[o]),Pu(e,i,o))}var Ly=Ks(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function My(e,i,o){var u=_e(e)?Yo:Qc,l=arguments.length<3;return u(e,se(i,4),o,l,vi)}function qy(e,i,o){var u=_e(e)?Yf:Qc,l=arguments.length<3;return u(e,se(i,4),o,l,gu)}function Uy(e,i){var o=_e(e)?pi:yu;return o(e,io(se(i,3)))}function zy(e){var i=_e(e)?lu:Dd;return i(e)}function ky(e,i,o){(o?Xt(e,i,o):i===r)?i=1:i=we(i);var u=_e(e)?hd:jd;return u(e,i)}function Hy(e){var i=_e(e)?ld:Fd;return i(e)}function By(e){if(e==null)return 0;if(sr(e))return so(e)?rn(e):e.length;var i=Vt(e);return i==be||i==Fe?e.size:ya(e).length}function Ky(e,i,o){var u=_e(e)?Xo:Ld;return o&&Xt(e,i,o)&&(i=r),u(e,se(i,3))}var Vy=xe(function(e,i){if(e==null)return[];var o=i.length;return o>1&&Xt(e,i[0],i[1])?i=[]:o>2&&Xt(i[0],i[1],i[2])&&(i=[i[0]]),Pu(e,Ht(i,1),[])}),to=Pp||function(){return Ae.Date.now()};function Gy(e,i){if(typeof i!="function")throw new wr(f);return e=we(e),function(){if(--e<1)return i.apply(this,arguments)}}function wh(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,Xr(e,z,r,r,r,r,i)}function bh(e,i){var o;if(typeof i!="function")throw new wr(f);return e=we(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var Ua=xe(function(e,i,o){var u=re;if(o.length){var l=gi(o,ln(Ua));u|=de}return Xr(e,u,i,o,l)}),Eh=xe(function(e,i,o){var u=re|he;if(o.length){var l=gi(o,ln(Eh));u|=de}return Xr(i,u,e,o,l)});function Ih(e,i,o){i=o?r:i;var u=Xr(e,fe,r,r,r,r,r,i);return u.placeholder=Ih.placeholder,u}function xh(e,i,o){i=o?r:i;var u=Xr(e,pe,r,r,r,r,r,i);return u.placeholder=xh.placeholder,u}function Sh(e,i,o){var u,l,y,w,E,A,M=0,q=!1,H=!1,J=!0;if(typeof e!="function")throw new wr(f);i=Sr(i)||0,ut(o)&&(q=!!o.leading,H="maxWait"in o,y=H?Ft(Sr(o.maxWait)||0,i):y,J="trailing"in o?!!o.trailing:J);function te(Et){var Dr=u,ii=l;return u=l=r,M=Et,w=e.apply(ii,Dr),w}function oe(Et){return M=Et,E=Ln(Se,i),q?te(Et):w}function Ee(Et){var Dr=Et-A,ii=Et-M,Bh=i-Dr;return H?Kt(Bh,y-ii):Bh}function ae(Et){var Dr=Et-A,ii=Et-M;return A===r||Dr>=i||Dr<0||H&&ii>=y}function Se(){var Et=to();if(ae(Et))return Re(Et);E=Ln(Se,Ee(Et))}function Re(Et){return E=r,J&&u?te(Et):(u=l=r,w)}function gr(){E!==r&&$u(E),M=0,u=A=l=E=r}function Zt(){return E===r?w:Re(to())}function yr(){var Et=to(),Dr=ae(Et);if(u=arguments,l=this,A=Et,Dr){if(E===r)return oe(A);if(H)return $u(E),E=Ln(Se,i),te(A)}return E===r&&(E=Ln(Se,i)),w}return yr.cancel=gr,yr.flush=Zt,yr}var Wy=xe(function(e,i){return du(e,1,i)}),Jy=xe(function(e,i,o){return du(e,Sr(i)||0,o)});function Qy(e){return Xr(e,ve)}function ro(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new wr(f);var o=function(){var u=arguments,l=i?i.apply(this,u):u[0],y=o.cache;if(y.has(l))return y.get(l);var w=e.apply(this,u);return o.cache=y.set(l,w)||y,w};return o.cache=new(ro.Cache||Qr),o}ro.Cache=Qr;function io(e){if(typeof e!="function")throw new wr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Yy(e){return bh(2,e)}var Xy=Md(function(e,i){i=i.length==1&&_e(i[0])?nt(i[0],fr(se())):nt(Ht(i,1),fr(se()));var o=i.length;return xe(function(u){for(var l=-1,y=Kt(u.length,o);++l<y;)u[l]=i[l].call(this,u[l]);return Mt(e,this,u)})}),za=xe(function(e,i){var o=gi(i,ln(za));return Xr(e,de,r,i,o)}),Ph=xe(function(e,i){var o=gi(i,ln(Ph));return Xr(e,F,r,i,o)}),Zy=Zr(function(e,i){return Xr(e,W,r,r,r,i)});function ev(e,i){if(typeof e!="function")throw new wr(f);return i=i===r?i:we(i),xe(e,i)}function tv(e,i){if(typeof e!="function")throw new wr(f);return i=i==null?0:Ft(we(i),0),xe(function(o){var u=o[i],l=wi(o,0,i);return u&&di(l,u),Mt(e,this,l)})}function rv(e,i,o){var u=!0,l=!0;if(typeof e!="function")throw new wr(f);return ut(o)&&(u="leading"in o?!!o.leading:u,l="trailing"in o?!!o.trailing:l),Sh(e,i,{leading:u,maxWait:i,trailing:l})}function iv(e){return wh(e,1)}function nv(e,i){return za(Sa(i),e)}function sv(){if(!arguments.length)return[];var e=arguments[0];return _e(e)?e:[e]}function ov(e){return Er(e,j)}function av(e,i){return i=typeof i=="function"?i:r,Er(e,j,i)}function cv(e){return Er(e,R|j)}function uv(e,i){return i=typeof i=="function"?i:r,Er(e,R|j,i)}function hv(e,i){return i==null||pu(e,i,qt(i))}function Nr(e,i){return e===i||e!==e&&i!==i}var lv=Js(pa),fv=Js(function(e,i){return e>=i}),Ui=_u(function(){return arguments}())?_u:function(e){return vt(e)&&qe.call(e,"callee")&&!su.call(e,"callee")},_e=N.isArray,pv=Qt?fr(Qt):bd;function sr(e){return e!=null&&no(e.length)&&!ti(e)}function bt(e){return vt(e)&&sr(e)}function dv(e){return e===!0||e===!1||vt(e)&&Yt(e)==D}var bi=Ap||Xa,gv=Rr?fr(Rr):Ed;function yv(e){return vt(e)&&e.nodeType===1&&!Mn(e)}function vv(e){if(e==null)return!0;if(sr(e)&&(_e(e)||typeof e=="string"||typeof e.splice=="function"||bi(e)||fn(e)||Ui(e)))return!e.length;var i=Vt(e);if(i==be||i==Fe)return!e.size;if(Fn(e))return!ya(e).length;for(var o in e)if(qe.call(e,o))return!1;return!0}function mv(e,i){return Dn(e,i)}function _v(e,i,o){o=typeof o=="function"?o:r;var u=o?o(e,i):r;return u===r?Dn(e,i,r,o):!!u}function ka(e){if(!vt(e))return!1;var i=Yt(e);return i==I||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Mn(e)}function wv(e){return typeof e=="number"&&au(e)}function ti(e){if(!ut(e))return!1;var i=Yt(e);return i==ee||i==ge||i==$||i==mt}function Oh(e){return typeof e=="number"&&e==we(e)}function no(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=V}function ut(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var Ah=mr?fr(mr):xd;function bv(e,i){return e===i||ga(e,i,Na(i))}function Ev(e,i,o){return o=typeof o=="function"?o:r,ga(e,i,Na(i),o)}function Iv(e){return Rh(e)&&e!=+e}function xv(e){if(ag(e))throw new ye(c);return wu(e)}function Sv(e){return e===null}function Pv(e){return e==null}function Rh(e){return typeof e=="number"||vt(e)&&Yt(e)==Ne}function Mn(e){if(!vt(e)||Yt(e)!=Pe)return!1;var i=Ts(e);if(i===null)return!0;var o=qe.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Os.call(o)==Ep}var Ha=zr?fr(zr):Sd;function Ov(e){return Oh(e)&&e>=-V&&e<=V}var Ch=In?fr(In):Pd;function so(e){return typeof e=="string"||!_e(e)&&vt(e)&&Yt(e)==Ye}function dr(e){return typeof e=="symbol"||vt(e)&&Yt(e)==Xe}var fn=Ni?fr(Ni):Od;function Av(e){return e===r}function Rv(e){return vt(e)&&Vt(e)==ze}function Cv(e){return vt(e)&&Yt(e)==Ze}var Tv=Js(va),Nv=Js(function(e,i){return e<=i});function Th(e){if(!e)return[];if(sr(e))return so(e)?Cr(e):nr(e);if(Sn&&e[Sn])return hp(e[Sn]());var i=Vt(e),o=i==be?na:i==Fe?xs:pn;return o(e)}function ri(e){if(!e)return e===0?e:0;if(e=Sr(e),e===ce||e===-ce){var i=e<0?-1:1;return i*k}return e===e?e:0}function we(e){var i=ri(e),o=i%1;return i===i?o?i-o:i:0}function Nh(e){return e?Fi(we(e),0,G):0}function Sr(e){if(typeof e=="number")return e;if(dr(e))return B;if(ut(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ut(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Yc(e);var o=Do.test(e);return o||$o.test(e)?me(e.slice(2),o?2:8):No.test(e)?B:+e}function Dh(e){return Hr(e,or(e))}function Dv(e){return e?Fi(we(e),-V,V):e===0?e:0}function Le(e){return e==null?"":pr(e)}var jv=un(function(e,i){if(Fn(i)||sr(i)){Hr(i,qt(i),e);return}for(var o in i)qe.call(i,o)&&Cn(e,o,i[o])}),jh=un(function(e,i){Hr(i,or(i),e)}),oo=un(function(e,i,o,u){Hr(i,or(i),e,u)}),$v=un(function(e,i,o,u){Hr(i,qt(i),e,u)}),Fv=Zr(ha);function Lv(e,i){var o=cn(e);return i==null?o:fu(o,i)}var Mv=xe(function(e,i){e=We(e);var o=-1,u=i.length,l=u>2?i[2]:r;for(l&&Xt(i[0],i[1],l)&&(u=1);++o<u;)for(var y=i[o],w=or(y),E=-1,A=w.length;++E<A;){var M=w[E],q=e[M];(q===r||Nr(q,sn[M])&&!qe.call(e,M))&&(e[M]=y[M])}return e}),qv=xe(function(e){return e.push(r,Yu),Mt($h,r,e)});function Uv(e,i){return Gc(e,se(i,3),kr)}function zv(e,i){return Gc(e,se(i,3),fa)}function kv(e,i){return e==null?e:la(e,se(i,3),or)}function Hv(e,i){return e==null?e:vu(e,se(i,3),or)}function Bv(e,i){return e&&kr(e,se(i,3))}function Kv(e,i){return e&&fa(e,se(i,3))}function Vv(e){return e==null?[]:zs(e,qt(e))}function Gv(e){return e==null?[]:zs(e,or(e))}function Ba(e,i,o){var u=e==null?r:Li(e,i);return u===r?o:u}function Wv(e,i){return e!=null&&eh(e,i,vd)}function Ka(e,i){return e!=null&&eh(e,i,md)}var Jv=Vu(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=As.call(i)),e[i]=o},Ga(ar)),Qv=Vu(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=As.call(i)),qe.call(e,i)?e[i].push(o):e[i]=[o]},se),Yv=xe(Nn);function qt(e){return sr(e)?hu(e):ya(e)}function or(e){return sr(e)?hu(e,!0):Ad(e)}function Xv(e,i){var o={};return i=se(i,3),kr(e,function(u,l,y){Yr(o,i(u,l,y),u)}),o}function Zv(e,i){var o={};return i=se(i,3),kr(e,function(u,l,y){Yr(o,l,i(u,l,y))}),o}var em=un(function(e,i,o){ks(e,i,o)}),$h=un(function(e,i,o,u){ks(e,i,o,u)}),tm=Zr(function(e,i){var o={};if(e==null)return o;var u=!1;i=nt(i,function(y){return y=_i(y,e),u||(u=y.length>1),y}),Hr(e,Ca(e),o),u&&(o=Er(o,R|x|j,Jd));for(var l=i.length;l--;)Ea(o,i[l]);return o});function rm(e,i){return Fh(e,io(se(i)))}var im=Zr(function(e,i){return e==null?{}:Cd(e,i)});function Fh(e,i){if(e==null)return{};var o=nt(Ca(e),function(u){return[u]});return i=se(i),Ou(e,o,function(u,l){return i(u,l[0])})}function nm(e,i,o){i=_i(i,e);var u=-1,l=i.length;for(l||(l=1,e=r);++u<l;){var y=e==null?r:e[Br(i[u])];y===r&&(u=l,y=o),e=ti(y)?y.call(e):y}return e}function sm(e,i,o){return e==null?e:jn(e,i,o)}function om(e,i,o,u){return u=typeof u=="function"?u:r,e==null?e:jn(e,i,o,u)}var Lh=Ju(qt),Mh=Ju(or);function am(e,i,o){var u=_e(e),l=u||bi(e)||fn(e);if(i=se(i,4),o==null){var y=e&&e.constructor;l?o=u?new y:[]:ut(e)?o=ti(y)?cn(Ts(e)):{}:o={}}return(l?_r:kr)(e,function(w,E,A){return i(o,w,E,A)}),o}function cm(e,i){return e==null?!0:Ea(e,i)}function um(e,i,o){return e==null?e:Nu(e,i,Sa(o))}function hm(e,i,o,u){return u=typeof u=="function"?u:r,e==null?e:Nu(e,i,Sa(o),u)}function pn(e){return e==null?[]:ia(e,qt(e))}function lm(e){return e==null?[]:ia(e,or(e))}function fm(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Sr(o),o=o===o?o:0),i!==r&&(i=Sr(i),i=i===i?i:0),Fi(Sr(e),i,o)}function pm(e,i,o){return i=ri(i),o===r?(o=i,i=0):o=ri(o),e=Sr(e),_d(e,i,o)}function dm(e,i,o){if(o&&typeof o!="boolean"&&Xt(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ri(e),i===r?(i=e,e=0):i=ri(i)),e>i){var u=e;e=i,i=u}if(o||e%1||i%1){var l=cu();return Kt(e+l*(i-e+Ve("1e-"+((l+"").length-1))),i)}return _a(e,i)}var gm=hn(function(e,i,o){return i=i.toLowerCase(),e+(o?qh(i):i)});function qh(e){return Va(Le(e).toLowerCase())}function Uh(e){return e=Le(e),e&&e.replace(Gr,sp).replace(Wo,"")}function ym(e,i,o){e=Le(e),i=pr(i);var u=e.length;o=o===r?u:Fi(we(o),0,u);var l=o;return o-=i.length,o>=0&&e.slice(o,l)==i}function vm(e){return e=Le(e),e&&rt.test(e)?e.replace(Oi,op):e}function mm(e){return e=Le(e),e&&At.test(e)?e.replace(dt,"\\$&"):e}var _m=hn(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),wm=hn(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),bm=Hu("toLowerCase");function Em(e,i,o){e=Le(e),i=we(i);var u=i?rn(e):0;if(!i||u>=i)return e;var l=(i-u)/2;return Ws($s(l),o)+e+Ws(js(l),o)}function Im(e,i,o){e=Le(e),i=we(i);var u=i?rn(e):0;return i&&u<i?e+Ws(i-u,o):e}function xm(e,i,o){e=Le(e),i=we(i);var u=i?rn(e):0;return i&&u<i?Ws(i-u,o)+e:e}function Sm(e,i,o){return o||i==null?i=0:i&&(i=+i),Np(Le(e).replace(gt,""),i||0)}function Pm(e,i,o){return(o?Xt(e,i,o):i===r)?i=1:i=we(i),wa(Le(e),i)}function Om(){var e=arguments,i=Le(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Am=hn(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function Rm(e,i,o){return o&&typeof o!="number"&&Xt(e,i,o)&&(i=o=r),o=o===r?G:o>>>0,o?(e=Le(e),e&&(typeof i=="string"||i!=null&&!Ha(i))&&(i=pr(i),!i&&tn(e))?wi(Cr(e),0,o):e.split(i,o)):[]}var Cm=hn(function(e,i,o){return e+(o?" ":"")+Va(i)});function Tm(e,i,o){return e=Le(e),o=o==null?0:Fi(we(o),0,e.length),i=pr(i),e.slice(o,o+i.length)==i}function Nm(e,i,o){var u=d.templateSettings;o&&Xt(e,i,o)&&(i=r),e=Le(e),i=oo({},i,u,Qu);var l=oo({},i.imports,u.imports,Qu),y=qt(l),w=ia(l,y),E,A,M=0,q=i.interpolate||Gi,H="__p += '",J=sa((i.escape||Gi).source+"|"+q.source+"|"+(q===ct?To:Gi).source+"|"+(i.evaluate||Gi).source+"|$","g"),te="//# sourceURL="+(qe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Jo+"]")+`
`;e.replace(J,function(ae,Se,Re,gr,Zt,yr){return Re||(Re=gr),H+=e.slice(M,yr).replace(Lo,ap),Se&&(E=!0,H+=`' +
__e(`+Se+`) +
'`),Zt&&(A=!0,H+=`';
`+Zt+`;
__p += '`),Re&&(H+=`' +
((__t = (`+Re+`)) == null ? '' : __t) +
'`),M=yr+ae.length,ae}),H+=`';
`;var oe=qe.call(i,"variable")&&i.variable;if(!oe)H=`with (obj) {
`+H+`
}
`;else if(Ro.test(oe))throw new ye(g);H=(A?H.replace(qr,""):H).replace(Jt,"$1").replace(Vr,"$1;"),H="function("+(oe||"obj")+`) {
`+(oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(E?", __e = _.escape":"")+(A?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+H+`return __p
}`;var Ee=kh(function(){return $e(y,te+"return "+H).apply(r,w)});if(Ee.source=H,ka(Ee))throw Ee;return Ee}function Dm(e){return Le(e).toLowerCase()}function jm(e){return Le(e).toUpperCase()}function $m(e,i,o){if(e=Le(e),e&&(o||i===r))return Yc(e);if(!e||!(i=pr(i)))return e;var u=Cr(e),l=Cr(i),y=Xc(u,l),w=Zc(u,l)+1;return wi(u,y,w).join("")}function Fm(e,i,o){if(e=Le(e),e&&(o||i===r))return e.slice(0,tu(e)+1);if(!e||!(i=pr(i)))return e;var u=Cr(e),l=Zc(u,Cr(i))+1;return wi(u,0,l).join("")}function Lm(e,i,o){if(e=Le(e),e&&(o||i===r))return e.replace(gt,"");if(!e||!(i=pr(i)))return e;var u=Cr(e),l=Xc(u,Cr(i));return wi(u,l).join("")}function Mm(e,i){var o=ie,u=ue;if(ut(i)){var l="separator"in i?i.separator:l;o="length"in i?we(i.length):o,u="omission"in i?pr(i.omission):u}e=Le(e);var y=e.length;if(tn(e)){var w=Cr(e);y=w.length}if(o>=y)return e;var E=o-rn(u);if(E<1)return u;var A=w?wi(w,0,E).join(""):e.slice(0,E);if(l===r)return A+u;if(w&&(E+=A.length-E),Ha(l)){if(e.slice(E).search(l)){var M,q=A;for(l.global||(l=sa(l.source,Le(vr.exec(l))+"g")),l.lastIndex=0;M=l.exec(q);)var H=M.index;A=A.slice(0,H===r?E:H)}}else if(e.indexOf(pr(l),E)!=E){var J=A.lastIndexOf(l);J>-1&&(A=A.slice(0,J))}return A+u}function qm(e){return e=Le(e),e&&lt.test(e)?e.replace(li,dp):e}var Um=hn(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),Va=Hu("toUpperCase");function zh(e,i,o){return e=Le(e),i=o?r:i,i===r?up(e)?vp(e):ep(e):e.match(i)||[]}var kh=xe(function(e,i){try{return Mt(e,r,i)}catch(o){return ka(o)?o:new ye(o)}}),zm=Zr(function(e,i){return _r(i,function(o){o=Br(o),Yr(e,o,Ua(e[o],e))}),e});function km(e){var i=e==null?0:e.length,o=se();return e=i?nt(e,function(u){if(typeof u[1]!="function")throw new wr(f);return[o(u[0]),u[1]]}):[],xe(function(u){for(var l=-1;++l<i;){var y=e[l];if(Mt(y[0],this,u))return Mt(y[1],this,u)}})}function Hm(e){return dd(Er(e,R))}function Ga(e){return function(){return e}}function Bm(e,i){return e==null||e!==e?i:e}var Km=Ku(),Vm=Ku(!0);function ar(e){return e}function Wa(e){return bu(typeof e=="function"?e:Er(e,R))}function Gm(e){return Iu(Er(e,R))}function Wm(e,i){return xu(e,Er(i,R))}var Jm=xe(function(e,i){return function(o){return Nn(o,e,i)}}),Qm=xe(function(e,i){return function(o){return Nn(e,o,i)}});function Ja(e,i,o){var u=qt(i),l=zs(i,u);o==null&&!(ut(i)&&(l.length||!u.length))&&(o=i,i=e,e=this,l=zs(i,qt(i)));var y=!(ut(o)&&"chain"in o)||!!o.chain,w=ti(e);return _r(l,function(E){var A=i[E];e[E]=A,w&&(e.prototype[E]=function(){var M=this.__chain__;if(y||M){var q=e(this.__wrapped__),H=q.__actions__=nr(this.__actions__);return H.push({func:A,args:arguments,thisArg:e}),q.__chain__=M,q}return A.apply(e,di([this.value()],arguments))})}),e}function Ym(){return Ae._===this&&(Ae._=Ip),this}function Qa(){}function Xm(e){return e=we(e),xe(function(i){return Su(i,e)})}var Zm=Oa(nt),e0=Oa(Vc),t0=Oa(Xo);function Hh(e){return ja(e)?Zo(Br(e)):Td(e)}function r0(e){return function(i){return e==null?r:Li(e,i)}}var i0=Gu(),n0=Gu(!0);function Ya(){return[]}function Xa(){return!1}function s0(){return{}}function o0(){return""}function a0(){return!0}function c0(e,i){if(e=we(e),e<1||e>V)return[];var o=G,u=Kt(e,G);i=se(i),e-=G;for(var l=ra(u,i);++o<e;)i(o);return l}function u0(e){return _e(e)?nt(e,Br):dr(e)?[e]:nr(uh(Le(e)))}function h0(e){var i=++bp;return Le(e)+i}var l0=Gs(function(e,i){return e+i},0),f0=Aa("ceil"),p0=Gs(function(e,i){return e/i},1),d0=Aa("floor");function g0(e){return e&&e.length?Us(e,ar,pa):r}function y0(e,i){return e&&e.length?Us(e,se(i,2),pa):r}function v0(e){return Jc(e,ar)}function m0(e,i){return Jc(e,se(i,2))}function _0(e){return e&&e.length?Us(e,ar,va):r}function w0(e,i){return e&&e.length?Us(e,se(i,2),va):r}var b0=Gs(function(e,i){return e*i},1),E0=Aa("round"),I0=Gs(function(e,i){return e-i},0);function x0(e){return e&&e.length?ta(e,ar):0}function S0(e,i){return e&&e.length?ta(e,se(i,2)):0}return d.after=Gy,d.ary=wh,d.assign=jv,d.assignIn=jh,d.assignInWith=oo,d.assignWith=$v,d.at=Fv,d.before=bh,d.bind=Ua,d.bindAll=zm,d.bindKey=Eh,d.castArray=sv,d.chain=vh,d.chunk=dg,d.compact=gg,d.concat=yg,d.cond=km,d.conforms=Hm,d.constant=Ga,d.countBy=xy,d.create=Lv,d.curry=Ih,d.curryRight=xh,d.debounce=Sh,d.defaults=Mv,d.defaultsDeep=qv,d.defer=Wy,d.delay=Jy,d.difference=vg,d.differenceBy=mg,d.differenceWith=_g,d.drop=wg,d.dropRight=bg,d.dropRightWhile=Eg,d.dropWhile=Ig,d.fill=xg,d.filter=Py,d.flatMap=Ry,d.flatMapDeep=Cy,d.flatMapDepth=Ty,d.flatten=ph,d.flattenDeep=Sg,d.flattenDepth=Pg,d.flip=Qy,d.flow=Km,d.flowRight=Vm,d.fromPairs=Og,d.functions=Vv,d.functionsIn=Gv,d.groupBy=Ny,d.initial=Rg,d.intersection=Cg,d.intersectionBy=Tg,d.intersectionWith=Ng,d.invert=Jv,d.invertBy=Qv,d.invokeMap=jy,d.iteratee=Wa,d.keyBy=$y,d.keys=qt,d.keysIn=or,d.map=eo,d.mapKeys=Xv,d.mapValues=Zv,d.matches=Gm,d.matchesProperty=Wm,d.memoize=ro,d.merge=em,d.mergeWith=$h,d.method=Jm,d.methodOf=Qm,d.mixin=Ja,d.negate=io,d.nthArg=Xm,d.omit=tm,d.omitBy=rm,d.once=Yy,d.orderBy=Fy,d.over=Zm,d.overArgs=Xy,d.overEvery=e0,d.overSome=t0,d.partial=za,d.partialRight=Ph,d.partition=Ly,d.pick=im,d.pickBy=Fh,d.property=Hh,d.propertyOf=r0,d.pull=Fg,d.pullAll=gh,d.pullAllBy=Lg,d.pullAllWith=Mg,d.pullAt=qg,d.range=i0,d.rangeRight=n0,d.rearg=Zy,d.reject=Uy,d.remove=Ug,d.rest=ev,d.reverse=Ma,d.sampleSize=ky,d.set=sm,d.setWith=om,d.shuffle=Hy,d.slice=zg,d.sortBy=Vy,d.sortedUniq=Wg,d.sortedUniqBy=Jg,d.split=Rm,d.spread=tv,d.tail=Qg,d.take=Yg,d.takeRight=Xg,d.takeRightWhile=Zg,d.takeWhile=ey,d.tap=gy,d.throttle=rv,d.thru=Zs,d.toArray=Th,d.toPairs=Lh,d.toPairsIn=Mh,d.toPath=u0,d.toPlainObject=Dh,d.transform=am,d.unary=iv,d.union=ty,d.unionBy=ry,d.unionWith=iy,d.uniq=ny,d.uniqBy=sy,d.uniqWith=oy,d.unset=cm,d.unzip=qa,d.unzipWith=yh,d.update=um,d.updateWith=hm,d.values=pn,d.valuesIn=lm,d.without=ay,d.words=zh,d.wrap=nv,d.xor=cy,d.xorBy=uy,d.xorWith=hy,d.zip=ly,d.zipObject=fy,d.zipObjectDeep=py,d.zipWith=dy,d.entries=Lh,d.entriesIn=Mh,d.extend=jh,d.extendWith=oo,Ja(d,d),d.add=l0,d.attempt=kh,d.camelCase=gm,d.capitalize=qh,d.ceil=f0,d.clamp=fm,d.clone=ov,d.cloneDeep=cv,d.cloneDeepWith=uv,d.cloneWith=av,d.conformsTo=hv,d.deburr=Uh,d.defaultTo=Bm,d.divide=p0,d.endsWith=ym,d.eq=Nr,d.escape=vm,d.escapeRegExp=mm,d.every=Sy,d.find=Oy,d.findIndex=lh,d.findKey=Uv,d.findLast=Ay,d.findLastIndex=fh,d.findLastKey=zv,d.floor=d0,d.forEach=mh,d.forEachRight=_h,d.forIn=kv,d.forInRight=Hv,d.forOwn=Bv,d.forOwnRight=Kv,d.get=Ba,d.gt=lv,d.gte=fv,d.has=Wv,d.hasIn=Ka,d.head=dh,d.identity=ar,d.includes=Dy,d.indexOf=Ag,d.inRange=pm,d.invoke=Yv,d.isArguments=Ui,d.isArray=_e,d.isArrayBuffer=pv,d.isArrayLike=sr,d.isArrayLikeObject=bt,d.isBoolean=dv,d.isBuffer=bi,d.isDate=gv,d.isElement=yv,d.isEmpty=vv,d.isEqual=mv,d.isEqualWith=_v,d.isError=ka,d.isFinite=wv,d.isFunction=ti,d.isInteger=Oh,d.isLength=no,d.isMap=Ah,d.isMatch=bv,d.isMatchWith=Ev,d.isNaN=Iv,d.isNative=xv,d.isNil=Pv,d.isNull=Sv,d.isNumber=Rh,d.isObject=ut,d.isObjectLike=vt,d.isPlainObject=Mn,d.isRegExp=Ha,d.isSafeInteger=Ov,d.isSet=Ch,d.isString=so,d.isSymbol=dr,d.isTypedArray=fn,d.isUndefined=Av,d.isWeakMap=Rv,d.isWeakSet=Cv,d.join=Dg,d.kebabCase=_m,d.last=xr,d.lastIndexOf=jg,d.lowerCase=wm,d.lowerFirst=bm,d.lt=Tv,d.lte=Nv,d.max=g0,d.maxBy=y0,d.mean=v0,d.meanBy=m0,d.min=_0,d.minBy=w0,d.stubArray=Ya,d.stubFalse=Xa,d.stubObject=s0,d.stubString=o0,d.stubTrue=a0,d.multiply=b0,d.nth=$g,d.noConflict=Ym,d.noop=Qa,d.now=to,d.pad=Em,d.padEnd=Im,d.padStart=xm,d.parseInt=Sm,d.random=dm,d.reduce=My,d.reduceRight=qy,d.repeat=Pm,d.replace=Om,d.result=nm,d.round=E0,d.runInContext=O,d.sample=zy,d.size=By,d.snakeCase=Am,d.some=Ky,d.sortedIndex=kg,d.sortedIndexBy=Hg,d.sortedIndexOf=Bg,d.sortedLastIndex=Kg,d.sortedLastIndexBy=Vg,d.sortedLastIndexOf=Gg,d.startCase=Cm,d.startsWith=Tm,d.subtract=I0,d.sum=x0,d.sumBy=S0,d.template=Nm,d.times=c0,d.toFinite=ri,d.toInteger=we,d.toLength=Nh,d.toLower=Dm,d.toNumber=Sr,d.toSafeInteger=Dv,d.toString=Le,d.toUpper=jm,d.trim=$m,d.trimEnd=Fm,d.trimStart=Lm,d.truncate=Mm,d.unescape=qm,d.uniqueId=h0,d.upperCase=Um,d.upperFirst=Va,d.each=mh,d.eachRight=_h,d.first=dh,Ja(d,function(){var e={};return kr(d,function(i,o){qe.call(d.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),d.VERSION=n,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),_r(["drop","take"],function(e,i){Oe.prototype[e]=function(o){o=o===r?1:Ft(we(o),0);var u=this.__filtered__&&!i?new Oe(this):this.clone();return u.__filtered__?u.__takeCount__=Kt(o,u.__takeCount__):u.__views__.push({size:Kt(o,G),type:e+(u.__dir__<0?"Right":"")}),u},Oe.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),_r(["filter","map","takeWhile"],function(e,i){var o=i+1,u=o==m||o==Y;Oe.prototype[e]=function(l){var y=this.clone();return y.__iteratees__.push({iteratee:se(l,3),type:o}),y.__filtered__=y.__filtered__||u,y}}),_r(["head","last"],function(e,i){var o="take"+(i?"Right":"");Oe.prototype[e]=function(){return this[o](1).value()[0]}}),_r(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");Oe.prototype[e]=function(){return this.__filtered__?new Oe(this):this[o](1)}}),Oe.prototype.compact=function(){return this.filter(ar)},Oe.prototype.find=function(e){return this.filter(e).head()},Oe.prototype.findLast=function(e){return this.reverse().find(e)},Oe.prototype.invokeMap=xe(function(e,i){return typeof e=="function"?new Oe(this):this.map(function(o){return Nn(o,e,i)})}),Oe.prototype.reject=function(e){return this.filter(io(se(e)))},Oe.prototype.slice=function(e,i){e=we(e);var o=this;return o.__filtered__&&(e>0||i<0)?new Oe(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=we(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},Oe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Oe.prototype.toArray=function(){return this.take(G)},kr(Oe.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),l=d[u?"take"+(i=="last"?"Right":""):i],y=u||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,E=u?[1]:arguments,A=w instanceof Oe,M=E[0],q=A||_e(w),H=function(Se){var Re=l.apply(d,di([Se],E));return u&&J?Re[0]:Re};q&&o&&typeof M=="function"&&M.length!=1&&(A=q=!1);var J=this.__chain__,te=!!this.__actions__.length,oe=y&&!J,Ee=A&&!te;if(!y&&q){w=Ee?w:new Oe(this);var ae=e.apply(w,E);return ae.__actions__.push({func:Zs,args:[H],thisArg:r}),new br(ae,J)}return oe&&Ee?e.apply(this,E):(ae=this.thru(H),oe?u?ae.value()[0]:ae.value():ae)})}),_r(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ss[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var y=this.value();return i.apply(_e(y)?y:[],l)}return this[o](function(w){return i.apply(_e(w)?w:[],l)})}}),kr(Oe.prototype,function(e,i){var o=d[i];if(o){var u=o.name+"";qe.call(an,u)||(an[u]=[]),an[u].push({name:i,func:o})}}),an[Vs(r,he).name]=[{name:"wrapper",func:r}],Oe.prototype.clone=qp,Oe.prototype.reverse=Up,Oe.prototype.value=zp,d.prototype.at=yy,d.prototype.chain=vy,d.prototype.commit=my,d.prototype.next=_y,d.prototype.plant=by,d.prototype.reverse=Ey,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Iy,d.prototype.first=d.prototype.head,Sn&&(d.prototype[Sn]=wy),d},nn=mp();wt?((wt.exports=nn)._=nn,Ge._=nn):Ae._=nn}).call(Kn)})(Tc,Tc.exports);var WI=Object.defineProperty,JI=Object.defineProperties,QI=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,YI=Object.prototype.hasOwnProperty,XI=Object.prototype.propertyIsEnumerable,Vl=(a,t,r)=>t in a?WI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,lo=(a,t)=>{for(var r in t||(t={}))YI.call(t,r)&&Vl(a,r,t[r]);if(Kl)for(var r of Kl(t))XI.call(t,r)&&Vl(a,r,t[r]);return a},ZI=(a,t)=>JI(a,QI(t));function Si(a,t,r){var n;const s=h_(a);return((n=t.rpcMap)==null?void 0:n[s.reference])||`${GI}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function Vi(a){return a.includes(":")?a.split(":")[1]:a}function Gf(a){return a.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function ex(a,t){const r=Object.keys(t.namespaces).filter(s=>s.includes(a));if(!r.length)return[];const n=[];return r.forEach(s=>{const c=t.namespaces[s].accounts;n.push(...c)}),n}function tx(a={},t={}){const r=Gl(a),n=Gl(t);return Tc.exports.merge(r,n)}function Gl(a){var t,r,n,s;const c={};if(!go(a))return c;for(const[f,g]of Object.entries(a)){const _=cf(f)?[f]:g.chains,p=g.methods||[],b=g.events||[],R=g.rpcMap||{},x=Vn(f);c[x]=ZI(lo(lo({},c[x]),g),{chains:ec(_,(t=c[x])==null?void 0:t.chains),methods:ec(p,(r=c[x])==null?void 0:r.methods),events:ec(b,(n=c[x])==null?void 0:n.events),rpcMap:lo(lo({},R),(s=c[x])==null?void 0:s.rpcMap)})}return c}function rx(a){return a.includes(":")?a.split(":")[2]:a}function ix(a){const t={};for(const[r,n]of Object.entries(a)){const s=n.methods||[],c=n.events||[],f=n.accounts||[],g=cf(r)?[r]:n.chains?n.chains:Gf(n.accounts);t[r]={chains:g,methods:s,events:c,accounts:f}}return t}function fc(a){return typeof a=="number"?a:a.includes("0x")?parseInt(a,16):a.includes(":")?Number(a.split(":")[1]):Number(a)}const Wf={},st=a=>Wf[a],pc=(a,t)=>{Wf[a]=t};class nx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Vi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}}class sx{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||Si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=parseInt(Vi(r));t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let s=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const c=parseInt(s,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class ox{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Vi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}}class ax{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Vi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}}class cx{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),s=Vi(r);t[s]=this.createHttpProvider(s,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}}class ux{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Vi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}}class hx{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const s=Vi(r);t[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ui(new Pi(n,st("disableProviderPing")))}}class lx{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||Si(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Si(t,this.namespace);return typeof n>"u"?void 0:new ui(new Pi(n,st("disableProviderPing")))}}var fx=Object.defineProperty,px=Object.defineProperties,dx=Object.getOwnPropertyDescriptors,Wl=Object.getOwnPropertySymbols,gx=Object.prototype.hasOwnProperty,yx=Object.prototype.propertyIsEnumerable,Jl=(a,t,r)=>t in a?fx(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,fo=(a,t)=>{for(var r in t||(t={}))gx.call(t,r)&&Jl(a,r,t[r]);if(Wl)for(var r of Wl(t))yx.call(t,r)&&Jl(a,r,t[r]);return a},dc=(a,t)=>px(a,dx(t));class Bc{constructor(t){this.events=new $c,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Hl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Bc(t);return await r.initialize(),r}async request(t,r){const[n,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:fo({},t),chainId:`${n}:${s}`,topic:this.session.topic})}sendAsync(t,r,n){this.request(t,n).then(s=>r(null,s)).catch(s=>r(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:tr("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:s}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await s().then(c=>{this.session=c,this.namespaces||(this.namespaces=ix(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==Kf)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,s]=this.validateChain(t);this.getProvider(n).setDefaultChain(s,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(mn(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await UI.init({logger:this.providerOpts.logger||Hl,relayUrl:this.providerOpts.relayUrl||BI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Vn(r)))];pc("client",this.client),pc("events",this.events),pc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=ex(r,this.session),s=Gf(n),c=tx(this.namespaces,this.optionalNamespaces),f=dc(fo({},c[r]),{accounts:n,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new sx({namespace:f});break;case"solana":this.rpcProviders[r]=new ox({namespace:f});break;case"cosmos":this.rpcProviders[r]=new ax({namespace:f});break;case"polkadot":this.rpcProviders[r]=new nx({namespace:f});break;case"cip34":this.rpcProviders[r]=new cx({namespace:f});break;case"elrond":this.rpcProviders[r]=new ux({namespace:f});break;case"multiversx":this.rpcProviders[r]=new hx({namespace:f});break;case"near":this.rpcProviders[r]=new lx({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const s=n.data;s&&mn(s)&&this.events.emit("accountsChanged",s.map(rx))}else if(n.name==="chainChanged"){const s=r.chainId,c=r.event.data,f=Vn(s),g=fc(s)!==fc(c)?`${f}:${fc(c)}`:s;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:s}=r,c=(n=this.client)==null?void 0:n.session.get(t);this.session=dc(fo({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",dc(fo({},tr("USER_DISCONNECTED")),{data:t.topic}))}),this.on(hi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:s}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=s,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(f=>Vn(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const s=Vn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[s].getDefaultChain();return[s,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[s,c]=this.validateChain(t);r||this.getProvider(s).setDefaultChain(c),((n=this.namespaces[s])!=null?n:this.namespaces[`${s}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Bl}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Bl}/${t}`)}}const vx=Bc,mx="wc",_x="ethereum_provider",wx=`${mx}@2:${_x}:`,bx="https://rpc.walletconnect.com/v1/",Nc=["eth_sendTransaction","personal_sign"],Ex=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Dc=["chainChanged","accountsChanged"],Ix=["chainChanged","accountsChanged","message","disconnect","connect"];var xx=Object.defineProperty,Sx=Object.defineProperties,Px=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,Ox=Object.prototype.hasOwnProperty,Ax=Object.prototype.propertyIsEnumerable,Yl=(a,t,r)=>t in a?xx(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Wn=(a,t)=>{for(var r in t||(t={}))Ox.call(t,r)&&Yl(a,r,t[r]);if(Ql)for(var r of Ql(t))Ax.call(t,r)&&Yl(a,r,t[r]);return a},Xl=(a,t)=>Sx(a,Px(t));function bo(a){return Number(a[0].split(":")[1])}function gc(a){return`0x${a.toString(16)}`}function Rx(a){const{chains:t,optionalChains:r,methods:n,optionalMethods:s,events:c,optionalEvents:f,rpcMap:g}=a;if(!mn(t))throw new Error("Invalid chains");const _={chains:t,methods:n||Nc,events:c||Dc,rpcMap:Wn({},t.length?{[bo(t)]:g[bo(t)]}:{})},p=c==null?void 0:c.filter(j=>!Dc.includes(j)),b=n==null?void 0:n.filter(j=>!Nc.includes(j));if(!r&&!f&&!s&&!(p!=null&&p.length)&&!(b!=null&&b.length))return{required:t.length?_:void 0};const R=(p==null?void 0:p.length)&&(b==null?void 0:b.length)||!r,x={chains:[...new Set(R?_.chains.concat(r||[]):r)],methods:[...new Set(_.methods.concat(s!=null&&s.length?s:Ex))],events:[...new Set(_.events.concat(f!=null&&f.length?f:Ix))],rpcMap:g};return{required:t.length?_:void 0,optional:r.length?x:void 0}}class Kc{constructor(){this.events=new Or.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=wx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Kc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=Rx(this.rpc);try{const s=await new Promise(async(f,g)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(p=>{!p.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Xl(Wn({namespaces:Wn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(p=>{f(p)}).catch(p=>{g(new Error(p.message))})});if(!s)return;const c=l_(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:gc(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",gc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Xl(Wn({},tr("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",gc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,s]=t.split(":");return{chainId:`${r}:${n}`,address:s}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const s=(r=t==null?void 0:t.chains)!=null?r:[],c=(n=t==null?void 0:t.optionalChains)!=null?n:[],f=s.concat(c);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=s.length?(t==null?void 0:t.methods)||Nc:[],_=s.length?(t==null?void 0:t.events)||Dc:[],p=(t==null?void 0:t.optionalMethods)||[],b=(t==null?void 0:t.optionalEvents)||[],R=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),x=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(j=>this.formatChainId(j)),optionalChains:c.map(j=>this.formatChainId(j)),methods:g,events:_,optionalMethods:p,optionalEvents:b,rpcMap:R,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:x,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(s=>{n[s]=this.getRpcUrl(s,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?bo(this.rpc.chains):bo(this.rpc.optionalChains),this.signer=await vx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await f_(()=>import("./index-86306a0e.js").then(s=>s.i),["assets/index-86306a0e.js","assets/index-e040e5d6.js","assets/index-4750024c.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Wn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:s}=t;r&&mn(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)})),n&&mn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(s==null?void 0:s[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${bx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const Hx=Kc;export{Hx as EthereumProvider,Ix as OPTIONAL_EVENTS,Ex as OPTIONAL_METHODS,Dc as REQUIRED_EVENTS,Nc as REQUIRED_METHODS,Kc as default};
